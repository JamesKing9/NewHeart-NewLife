

## 13.4 Replication Statements

- [13.4.1 SQL Statements for Controlling Master Servers](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replication-master-sql)
- [13.4.2 SQL Statements for Controlling Slave Servers](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replication-slave-sql)

​    Replication can be controlled through the SQL interface using the    statements described in this section. One group of statements    controls master servers, the other controls slave servers.

### 13.4.1 SQL Statements for Controlling Master Servers

- [13.4.1.1 PURGE BINARY LOGS Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs)
- [13.4.1.2 RESET MASTER Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master)
- [13.4.1.3 SET sql_log_bin Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-sql-log-bin)

​      This section discusses statements for managing master replication      servers. [Section 13.4.2, “SQL Statements for Controlling Slave Servers”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replication-slave-sql), discusses      statements for managing slave servers.    

​      In addition to the statements described here, the following      [`SHOW`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show) statements are used with      master servers in replication. For information about these      statements, see [Section 13.7.5, “SHOW Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show).

- ​          [`SHOW BINARY LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-binary-logs)        
- ​          [`SHOW BINLOG EVENTS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-binlog-events)        
- ​          [`SHOW MASTER STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-master-status)        
- ​          [`SHOW SLAVE HOSTS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-hosts)

#### 13.4.1.1 PURGE BINARY LOGS Syntax

```
PURGE { BINARY | MASTER } LOGS
    { TO 'log_name' | BEFORE datetime_expr }

```

​        The binary log is a set of files that contain information about        data modifications made by the MySQL server. The log consists of        a set of binary log files, plus an index file (see        [Section 5.4.4, “The Binary Log”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#binary-log)).      

​        The [`PURGE BINARY LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs) statement        deletes all the binary log files listed in the log index file        prior to the specified log file name or date.        `BINARY` and `MASTER` are        synonyms. Deleted log files also are removed from the list        recorded in the index file, so that the given log file becomes        the first in the list.      

​        This statement has no effect if the server was not started with        the [`--log-bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_log-bin) option to enable        binary logging.      

​        Examples:      

```
PURGE BINARY LOGS TO 'mysql-bin.010';
PURGE BINARY LOGS BEFORE '2008-04-02 22:46:26';

```

​        The `BEFORE` variant's        *datetime_expr* argument should        evaluate to a [`DATETIME`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#datetime) value (a        value in `'YYYY-MM-DD hh:mm:ss'` format).      

​        This statement is safe to run while slaves are replicating. You        need not stop them. If you have an active slave that currently        is reading one of the log files you are trying to delete, this        statement does nothing and fails with an error. However, if a        slave is not connected and you happen to purge one of the log        files it has yet to read, the slave will be unable to replicate        after it reconnects.      

​        To safely purge binary log files, follow this procedure:

1. ​            On each slave server, use [`SHOW SLAVE            STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status) to check which log file it is reading.          
2. ​            Obtain a listing of the binary log files on the master            server with [`SHOW BINARY LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-binary-logs).          
3. ​            Determine the earliest log file among all the slaves. This            is the target file. If all the slaves are up to date, this            is the last log file on the list.          
4. ​            Make a backup of all the log files you are about to delete.            (This step is optional, but always advisable.)          
5. ​            Purge all log files up to but not including the target file.

​        You can also set the        [`expire_logs_days`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_expire_logs_days) system        variable to expire binary log files automatically after a given        number of days (see [Section 5.1.5, “Server System Variables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#server-system-variables)).        If you are using replication, you should set the variable no        lower than the maximum number of days your slaves might lag        behind the master.      

​        `PURGE BINARY LOGS TO` and `PURGE        BINARY LOGS BEFORE` both fail with an error when binary        log files listed in the `.index` file had        been removed from the system by some other means (such as using        **rm** on Linux). (Bug #18199, Bug #18453) To        handle such errors, edit the `.index` file        (which is a simple text file) manually to ensure that it lists        only the binary log files that are actually present, then run        again the [`PURGE BINARY LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs)        statement that failed.

#### 13.4.1.2 RESET MASTER Syntax

```
RESET MASTER

```

​        Deletes all binary log files listed in the index file, resets        the binary log index file to be empty, and creates a new binary        log file. This statement is intended to be used only when the        master is started for the first time.

Important

​          The effects of [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master)          differ from those of [`PURGE BINARY          LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs) in 2 key ways:

1. ​              [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master) removes              *all* binary log files that are listed              in the index file, leaving only a single, empty binary log              file with a numeric suffix of `.000001`,              whereas the numbering is not reset by              [`PURGE BINARY LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs).            
2. ​              [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master) is              *not* intended to be used while any              replication slaves are running. The behavior of              [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master) when used              while slaves are running is undefined (and thus              unsupported), whereas [`PURGE BINARY              LOGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs) may be safely used while replication slaves              are running.

​          See also [Section 13.4.1.1, “PURGE BINARY LOGS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#purge-binary-logs).

​        [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master) can prove useful        when you first set up the master and the slave, so that you can        verify the setup as follows:

1. ​            Start the master and slave, and start replication (see            [Section 17.1.1, “How to Set Up Replication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-howto)).          
2. ​            Execute a few test queries on the master.          
3. ​            Check that the queries were replicated to the slave.          
4. ​            When replication is running correctly, issue            [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) followed by            [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) on the slave,            then verify that any unwanted data no longer exists on the            slave.          
5. ​            Issue [`RESET MASTER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-master) on the            master to clean up the test queries.

​        After verifying the setup and getting rid of any unwanted and        log files generated by testing, you can start the slave and        begin replicating.

#### 13.4.1.3 SET sql_log_bin Syntax

```
SET sql_log_bin = {0|1}

```

​        The [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin) variable        controls whether logging to the binary log is done. The default        value is 1 (do logging). To change logging for the current        session, change the session value of this variable. The session        user must have the [`SUPER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_super)        privilege to set this variable. Set this variable to 0 for a        session to temporarily disable binary logging while making        changes to the master which you do not want to replicate to the        slave.      

​        As of MySQL 5.5.41, the global        [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin) variable is read        only and cannot be modified. The global scope is deprecated and        will be removed in a future MySQL release. Prior to 5.5.41,        [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin) can be set as a        global or session variable. Setting        [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin) globally is only        detected when a new session is started. Any sessions previously        running are not impacted when setting        [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin) globally.

Warning

​          Incorrect use of [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin)          with a global scope means any changes made in an already          running session are *still* being recorded          to the binary log and therefore replicated. Exercise extreme          caution using [`sql_log_bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_log_bin)          with a global scope as the above situation could cause          unexpected results including replication failure.

​        It is not possible to set        `@@session.sql_log_bin` within a transaction or        subquery.

### 13.4.2 SQL Statements for Controlling Slave Servers

- [13.4.2.1 CHANGE MASTER TO Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to)
- [13.4.2.2 MASTER_POS_WAIT() Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#master-pos-wait)
- [13.4.2.3 RESET SLAVE Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave)
- [13.4.2.4 SET GLOBAL sql_slave_skip_counter Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-global-sql-slave-skip-counter)
- [13.4.2.5 START SLAVE Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave)
- [13.4.2.6 STOP SLAVE Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave)

​      This section discusses statements for managing slave replication      servers. [Section 13.4.1, “SQL Statements for Controlling Master Servers”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replication-master-sql), discusses      statements for managing master servers.    

​      In addition to the statements described here,      [`SHOW SLAVE STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status) and      [`SHOW RELAYLOG EVENTS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-relaylog-events) are also used      with replication slaves. For information about these statements,      see [Section 13.7.5.35, “SHOW SLAVE STATUS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status), and      [Section 13.7.5.33, “SHOW RELAYLOG EVENTS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-relaylog-events).

#### 13.4.2.1 CHANGE MASTER TO Syntax

```
CHANGE MASTER TO option [, option] ...

option:
    MASTER_BIND = 'interface_name'
  | MASTER_HOST = 'host_name'
  | MASTER_USER = 'user_name'
  | MASTER_PASSWORD = 'password'
  | MASTER_PORT = port_num
  | MASTER_CONNECT_RETRY = interval
  | MASTER_HEARTBEAT_PERIOD = interval
  | MASTER_LOG_FILE = 'master_log_name'
  | MASTER_LOG_POS = master_log_pos
  | RELAY_LOG_FILE = 'relay_log_name'
  | RELAY_LOG_POS = relay_log_pos
  | MASTER_SSL = {0|1}
  | MASTER_SSL_CA = 'ca_file_name'
  | MASTER_SSL_CAPATH = 'ca_directory_name'
  | MASTER_SSL_CERT = 'cert_file_name'
  | MASTER_SSL_KEY = 'key_file_name'
  | MASTER_SSL_CIPHER = 'cipher_list'
  | MASTER_SSL_VERIFY_SERVER_CERT = {0|1}
  | IGNORE_SERVER_IDS = (server_id_list)

server_id_list:
    [server_id [, server_id] ... ]

```

​        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) changes the        parameters that the slave server uses for connecting to the        master server, for reading the master binary log, and reading        the slave relay log. It also updates the contents of the        `master.info` and        `relay-log.info` files.        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) requires the        [`SUPER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_super) privilege.      

​        To use [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to), the        slave replication threads must be stopped (use        [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) if necessary).      

​        Options not specified retain their value, except as indicated in        the following discussion. Thus, in most cases, there is no need        to specify options that do not change. For example, if the        password to connect to your MySQL master has changed, you just        need to issue these statements to tell the slave about the new        password:      

```
STOP SLAVE; -- if replication was running
CHANGE MASTER TO MASTER_PASSWORD='new3cret';
START SLAVE; -- if you want to restart replication

```

​        `MASTER_HOST`, `MASTER_USER`,        `MASTER_PASSWORD`, and        `MASTER_PORT` provide information to the slave        about how to connect to its master:

- ​            `MASTER_HOST` and            `MASTER_PORT` are the host name (or IP            address) of the master host and its TCP/IP port.

  Note

  ​              Replication cannot use Unix socket files. You must be able              to connect to the master MySQL server using TCP/IP.

  ​            If you specify the `MASTER_HOST` or            `MASTER_PORT` option, the slave assumes            that the master server is different from before (even if the            option value is the same as its current value.) In this            case, the old values for the master binary log file name and            position are considered no longer applicable, so if you do            not specify `MASTER_LOG_FILE` and            `MASTER_LOG_POS` in the statement,            `MASTER_LOG_FILE=''` and            `MASTER_LOG_POS=4` are silently appended to            it.          

  ​            Setting `MASTER_HOST=''` (that is, setting            its value explicitly to an empty string) is            *not* the same as not setting            `MASTER_HOST` at all. Beginning with MySQL            5.5, trying to set `MASTER_HOST` to an            empty string fails with an error. Previously, setting            `MASTER_HOST` to an empty string caused            [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) subsequently to            fail. (Bug #28796)          

- ​            `MASTER_USER` and            `MASTER_PASSWORD` are the user name and            password of the account to use for connecting to the master.          

  ​            In MySQL 5.5.20 and later, `MASTER_USER`            cannot be made empty; setting `MASTER_USER =            ''` or leaving it unset when setting a value for            `MASTER_PASSWORD` causes an error (Bug            #13427949).          

  ​            The password used for a MySQL Replication slave account in a            `CHANGE MASTER TO` statement is limited to            32 characters in length; if the password is longer, the            statement succeeds, but any excess characters are silently            truncated. This is an issue specific to MySQL Replication,            which is fixed in MySQL 5.7. (Bug #11752299, Bug #43439)          

  ​            The text of a running [`CHANGE MASTER            TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) statement, including values for            `MASTER_USER` and            `MASTER_PASSWORD`, can be seen in the            output of a concurrent [`SHOW            PROCESSLIST`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-processlist) statement.

​        The `MASTER_SSL_*xxx*`        options provide information about using SSL for the connection.        They correspond to the        `--ssl-*xxx*` options        described in [Section 6.4.2, “Command Options for Encrypted Connections”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#encrypted-connection-options), and        [Section 17.3.7, “Setting Up Replication to Use Encrypted Connections”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-solutions-encrypted-connections).        These options can be changed even on slaves that are compiled        without SSL support. They are saved to the        `master.info` file, but are ignored if the        slave does not have SSL support enabled.      

​        `MASTER_CONNECT_RETRY` specifies how many        seconds to wait between connect retries. The default is 60. The        *number* of reconnection attempts is limited        by the [`--master-retry-count`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_master-retry-count)        server option; for more information, see        [Section 17.1.3, “Replication and Binary Logging Options and Variables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-options).      

​        The `MASTER_BIND` option is available in MySQL        NDB Cluster 7.2 and later, but is not supported in mainline        MySQL 5.5.      

​        `MASTER_BIND` is for use on replication slaves        having multiple network interfaces, and determines which of the        slave's network interfaces is chosen for connecting to the        master.      

​        `MASTER_HEARTBEAT_PERIOD` sets the interval in        seconds between replication heartbeats. Whenever the master's        binary log is updated with an event, the waiting period for the        next heartbeat is reset. *interval* is        a decimal value having the range 0 to 4294967 seconds and a        resolution in milliseconds; the smallest nonzero value is 0.001.        Heartbeats are sent by the master only if there are no unsent        events in the binary log file for a period longer than        *interval*.      

​        Setting *interval* to 0 disables        heartbeats altogether. The default value for        *interval* is equal to the value of        [`slave_net_timeout`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#sysvar_slave_net_timeout) divided by 2.      

​        Setting `@@global.slave_net_timeout` to a value        less than that of the current heartbeat interval results in a        warning being issued. The effect of issuing        [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) on the heartbeat        interval is to reset it to the default value.      

​        `MASTER_LOG_FILE` and        `MASTER_LOG_POS` are the coordinates at which        the slave I/O thread should begin reading from the master the        next time the thread starts. `RELAY_LOG_FILE`        and `RELAY_LOG_POS` are the coordinates at        which the slave SQL thread should begin reading from the relay        log the next time the thread starts. If you specify either of        `MASTER_LOG_FILE` or        `MASTER_LOG_POS`, you cannot specify        `RELAY_LOG_FILE` or        `RELAY_LOG_POS`. If neither of        `MASTER_LOG_FILE` or        `MASTER_LOG_POS` is specified, the slave uses        the last coordinates of the *slave SQL        thread* before [`CHANGE MASTER        TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) was issued. This ensures that there is no        discontinuity in replication, even if the slave SQL thread was        late compared to the slave I/O thread, when you merely want to        change, say, the password to use.      

​        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to)        *deletes all relay log files* and starts a        new one, unless you specify `RELAY_LOG_FILE` or        `RELAY_LOG_POS`. In that case, relay log files        are kept; the [`relay_log_purge`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_relay_log_purge)        global variable is set silently to 0.      

​        Prior to MySQL 5.5, `RELAY_LOG_FILE` required        an absolute path. In MySQL 5.5, the path can be        relative, in which case the path is assumed to be relative to        the slave's data directory. (Bug #12190)      

​        `IGNORE_SERVER_IDS` was added in MySQL 5.5.        This option takes a comma-separated list of 0 or more server        IDs. Events originating from the corresponding servers are        ignored, with the exception of log rotation and deletion events,        which are still recorded in the relay log.      

​        In circular replication, the originating server normally acts as        the terminator of its own events, so that they are not applied        more than once. Thus, this option is useful in circular        replication when one of the servers in the circle is removed.        Suppose that you have a circular replication setup with 4        servers, having server IDs 1, 2, 3, and 4, and server 3 fails.        When bridging the gap by starting replication from server 2 to        server 4, you can include `IGNORE_SERVER_IDS =        (3)` in the `CHANGE MASTER TO`        statement that you issue on server 4 to tell it to use server 2        as its master instead of server 3. Doing so causes it to ignore        and not to propagate any statements that originated with the        server that is no longer in use.      

​        When a `CHANGE MASTER TO` statement is issued        without any `IGNORE_SERVER_IDS` option, any        existing list is preserved. To clear the list of ignored        servers, it is necessary to use the option with an empty list:      

```
CHANGE MASTER TO IGNORE_SERVER_IDS = ();

```

​        [`RESET SLAVE        ALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) has no effect on the server ID list. This issue is        fixed in MySQL 5.7. (Bug #18816897)      

​        If `IGNORE_SERVER_IDS` contains the        server's own ID and the server was started with the        [`--replicate-same-server-id`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_replicate-same-server-id) option        enabled, an error results.      

​        Also beginning with MySQL 5.5, the        `master.info` file and the output of        [`SHOW SLAVE STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status) are extended to        provide the list of servers that are currently ignored. For more        information, see [Section 17.2.2.2, “Slave Status Logs”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#slave-logs-status), and        [Section 13.7.5.35, “SHOW SLAVE STATUS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status).      

​        Beginning with MySQL 5.5.5, invoking [`CHANGE        MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) causes the previous values for        `MASTER_HOST`, `MASTER_PORT`,        `MASTER_LOG_FILE`, and        `MASTER_LOG_POS` to be written to the error        log, along with other information about the slave's state        prior to execution.      

​        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) is useful for        setting up a slave when you have the snapshot of the master and        have recorded the master binary log coordinates corresponding to        the time of the snapshot. After loading the snapshot into the        slave to synchronize it with the master, you can run        `CHANGE MASTER TO        MASTER_LOG_FILE='*log_name*',        MASTER_LOG_POS=*log_pos*` on        the slave to specify the coordinates at which the slave should        begin reading the master binary log.      

​        The following example changes the master server the slave uses        and establishes the master binary log coordinates from which the        slave begins reading. This is used when you want to set up the        slave to replicate the master:      

```
CHANGE MASTER TO
  MASTER_HOST='master2.example.com',
  MASTER_USER='replication',
  MASTER_PASSWORD='bigs3cret',
  MASTER_PORT=3306,
  MASTER_LOG_FILE='master2-bin.001',
  MASTER_LOG_POS=4,
  MASTER_CONNECT_RETRY=10;

```

​        The next example shows an operation that is less frequently        employed. It is used when the slave has relay log files that you        want it to execute again for some reason. To do this, the master        need not be reachable. You need only use        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) and start the        SQL thread (`START SLAVE SQL_THREAD`):      

```
CHANGE MASTER TO
  RELAY_LOG_FILE='slave-relay-bin.006',
  RELAY_LOG_POS=4025;

```

​        You can even use the second operation in a nonreplication setup        with a standalone, nonslave server for recovery following a        crash. Suppose that your server has crashed and you have        restored it from a backup. You want to replay the server's own        binary log files (not relay log files, but regular binary log        files), named (for example) `myhost-bin.*`.        First, make a backup copy of these binary log files in some safe        place, in case you don't exactly follow the procedure below and        accidentally have the server purge the binary log. Use        `SET GLOBAL relay_log_purge=0` for additional        safety. Then start the server without the        [`--log-bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_log-bin) option, Instead, use        the [`--replicate-same-server-id`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_replicate-same-server-id),        [`--relay-log=myhost-bin`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_relay-log) (to make        the server believe that these regular binary log files are relay        log files) and [`--skip-slave-start`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_skip-slave-start)        options. After the server starts, issue these statements:      

```
CHANGE MASTER TO
  RELAY_LOG_FILE='myhost-bin.153',
  RELAY_LOG_POS=410,
  MASTER_HOST='some_dummy_string';
START SLAVE SQL_THREAD;

```

​        The server reads and executes its own binary log files, thus        achieving crash recovery. Once the recovery is finished, run        [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave), shut down the server,        delete the `master.info` and        `relay-log.info` files, and restart the        server with its original options.      

​        Specifying the `MASTER_HOST` option (even with        a dummy value) is required to make the server think it is a        slave.      

​        The following table shows the maximum permissible length for the        string-valued options.

| Option              | Maximum Length |
| ------------------- | -------------- |
| `MASTER_HOST`       | 60             |
| `MASTER_USER`       | 16             |
| `MASTER_PASSWORD`   | 32             |
| `MASTER_LOG_FILE`   | 255            |
| `RELAY_LOG_FILE`    | 255            |
| `MASTER_SSL_CA`     | 255            |
| `MASTER_SSL_CAPATH` | 255            |
| `MASTER_SSL_CERT`   | 255            |
| `MASTER_SSL_KEY`    | 255            |
| `MASTER_SSL_CIPHER` | 511            |

#### 13.4.2.2 MASTER_POS_WAIT() Syntax

```
SELECT MASTER_POS_WAIT('master_log_file', master_log_pos [, timeout])

```

​        This is actually a function, not a statement. It is used to        ensure that the slave has read and executed events up to a given        position in the master's binary log. See        [Section 12.17, “Miscellaneous Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#miscellaneous-functions), for a full        description.

#### 13.4.2.3 RESET SLAVE Syntax

```
RESET SLAVE [ALL]

```

​        [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) makes the slave        forget its replication position in the master's binary log. This        statement is meant to be used for a clean start: It deletes the        `master.info` and        `relay-log.info` files, all the relay log        files, and starts a new relay log file. To use        [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave), the slave        replication threads must be stopped (use        [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) if necessary).

Note

​          All relay log files are deleted, even if they have not been          completely executed by the slave SQL thread. (This is a          condition likely to exist on a replication slave if you have          issued a [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) statement          or if the slave is highly loaded.)

​        In MySQL 5.5 (unlike the case in MySQL 5.1 and        earlier), [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) does not        change any replication connection parameters such as master        host, master port, master user, or master password, which are        retained in memory. This means that [`START        SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) can be issued without requiring a        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) statement        following [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave).      

​        Connection parameters are reset if the slave        [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) is shut down following `RESET        SLAVE`. In MySQL 5.5.16 and later, you can instead use        `RESET SLAVE ALL` to reset these connection        parameters (Bug #11809016).      

​        `RESET SLAVE ALL` does not clear the        `IGNORE_SERVER_IDS` list set by        [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to). This issue is        fixed in MySQL 5.7. (Bug #18816897)      

​        If the slave SQL thread was in the middle of replicating        temporary tables when it was stopped, and        [`RESET SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#reset-slave) is issued, these        replicated temporary tables are deleted on the slave.

Note

​          When used on an NDB Cluster replication slave SQL node,          `RESET SLAVE` clears the          `mysql.ndb_apply_status table`. You should          keep in mind when using this statement that          `ndb_apply_status` uses the          [`NDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/mysql-cluster.html) storage engine and so is          shared by all SQL nodes attached to the slave cluster.

#### 13.4.2.4 SET GLOBAL sql_slave_skip_counter Syntax

```
SET GLOBAL sql_slave_skip_counter = N

```

​        This statement skips the next *N*        events from the master. This is useful for recovering from        replication stops caused by a statement.      

​        This statement is valid only when the slave threads are not        running. Otherwise, it produces an error.      

​        When using this statement, it is important to understand that        the binary log is actually organized as a sequence of groups        known as event groups.        Each event group consists of a sequence of events.

- ​            For transactional tables, an event group corresponds to a            transaction.          
- ​            For nontransactional tables, an event group corresponds to a            single SQL statement.

Note

​          A single transaction can contain changes to both transactional          and nontransactional tables.

​        When you use [`SET GLOBAL        sql_slave_skip_counter`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-global-sql-slave-skip-counter) to skip events and the result        is in the middle of a group, the slave continues to skip events        until it reaches the end of the group. Execution then starts        with the next event group.

#### 13.4.2.5 START SLAVE Syntax

```
START SLAVE [thread_types]

START SLAVE [SQL_THREAD] UNTIL
    MASTER_LOG_FILE = 'log_name', MASTER_LOG_POS = log_pos

START SLAVE [SQL_THREAD] UNTIL
    RELAY_LOG_FILE = 'log_name', RELAY_LOG_POS = log_pos

thread_types:
    [thread_type [, thread_type] ... ]

thread_type: IO_THREAD | SQL_THREAD

```

​        [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) with no        *thread_type* options starts both of        the slave threads. The I/O thread reads events from the master        server and stores them in the relay log. The SQL thread reads        events from the relay log and executes them.        [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) requires the        [`SUPER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_super) privilege.      

​        If [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) succeeds in        starting the slave threads, it returns without any error.        However, even in that case, it might be that the slave threads        start and then later stop (for example, because they do not        manage to connect to the master or read its binary log, or some        other problem). [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) does        not warn you about this. You must check the slave's error log        for error messages generated by the slave threads, or check that        they are running satisfactorily with [`SHOW        SLAVE STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status).      

​        [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) sends an        acknowledgment to the user after both the I/O thread and the SQL        thread have started. However, the I/O thread may not yet have        connected. For this reason, a successful        [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) causes        [`SHOW SLAVE STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status) to show        `Slave_SQL_Running=Yes`, but this does not        guarantee that `Slave_IO_Running=Yes` (because        `Slave_IO_Running=Yes` only if the I/O thread        is running *and connected*). For more        information, see [Section 13.7.5.35, “SHOW SLAVE STATUS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status), and        [Section 17.1.4.1, “Checking Replication Status”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-administration-status).      

​        You can add `IO_THREAD` and        `SQL_THREAD` options to the statement to name        which of the threads to start.      

​        An `UNTIL` clause may be added to specify that        the slave should start and run until the SQL thread reaches a        given point in the master binary log or in the slave relay log.        When the SQL thread reaches that point, it stops. If the        `SQL_THREAD` option is specified in the        statement, it starts only the SQL thread. Otherwise, it starts        both slave threads. If the SQL thread is running, the        `UNTIL` clause is ignored and a warning is        issued.      

​        For an `UNTIL` clause, you must specify both a        log file name and position. Do not mix master and relay log        options.      

​        Any `UNTIL` condition is reset by a subsequent        [`STOP SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) statement, a        [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave) statement that        includes no `UNTIL` clause, or a server        restart.      

​        The `UNTIL` clause can be useful for debugging        replication, or to cause replication to proceed until just        before the point where you want to avoid having the slave        replicate an event. For example, if an unwise        [`DROP TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#drop-table) statement was executed        on the master, you can use `UNTIL` to tell the        slave to execute up to that point but no farther. To find what        the event is, use [**mysqlbinlog**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqlbinlog) with the master        binary log or slave relay log, or by using a        [`SHOW BINLOG EVENTS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-binlog-events) statement.      

​        If you are using `UNTIL` to have the slave        process replicated queries in sections, it is recommended that        you start the slave with the        [`--skip-slave-start`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#option_mysqld_skip-slave-start) option to        prevent the SQL thread from running when the slave server        starts. It is probably best to use this option in an option file        rather than on the command line, so that an unexpected server        restart does not cause it to be forgotten.      

​        The [`SHOW SLAVE STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-slave-status) statement        includes output fields that display the current values of the        `UNTIL` condition.      

​        In old versions of MySQL (before 4.0.5), this statement was        called `SLAVE START`. This usage is still        accepted in MySQL 5.5 for backward compatibility,        but is deprecated and is removed in MySQL 5.6.

#### 13.4.2.6 STOP SLAVE Syntax

```
STOP SLAVE [thread_types]

thread_types:
    [thread_type [, thread_type] ... ]

thread_type: IO_THREAD | SQL_THREAD

```

​        Stops the slave threads. [`STOP        SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#stop-slave) requires the        [`SUPER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_super) privilege. Recommended        best practice is to execute `STOP SLAVE` on the        slave before stopping the slave server (see        [Section 5.1.12, “The Server Shutdown Process”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#server-shutdown), for more        information).      

​        *When using the row-based logging format*:        You should execute `STOP SLAVE` on the slave        prior to shutting down the slave server if you are replicating        any tables that use a nontransactional storage engine (see the        *Note* later in this section). In MySQL        5.5.9 and later, you can also use `STOP SLAVE        SQL_THREAD` for this purpose.      

​        Like [`START SLAVE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#start-slave), this statement        may be used with the `IO_THREAD` and        `SQL_THREAD` options to name the thread or        threads to be stopped.      

​        If the current replication event group has modified one or more        nontransactional tables, STOP SLAVE waits for up to 60 seconds        for the event group to complete, unless you issue a        [`KILL QUERY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#kill) or        [`KILL CONNECTION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#kill)        statement for the slave SQL thread. If the event group remains        incomplete after the timeout, an error message is logged. (Bug        #319, Bug #38205)      

​        In old versions of MySQL (before 4.0.5), this statement was        called `SLAVE STOP`. This usage is still        accepted in MySQL 5.5 for backward compatibility,        but is deprecated and is removed in MySQL 5.6.