

## 13.2 Data Manipulation Statements


### 13.2.1 CALL Syntax

```
CALL sp_name([parameter[,...]])
CALL sp_name[()]

```

​The [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) statement invokes a stored      procedure that was defined previously with      [`CREATE PROCEDURE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-procedure).    

​      Stored procedures that take no arguments can be invoked without      parentheses. That is, `CALL p()` and      `CALL p` are equivalent.    

​      [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) can pass back values to its      caller using parameters that are declared as      `OUT` or `INOUT` parameters.      When the procedure returns, a client program can also obtain the      number of rows affected for the final statement executed within      the routine: At the SQL level, call the      [`ROW_COUNT()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_row-count) function; from the C      API, call the      [`mysql_affected_rows()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-affected-rows) function.    

​      To get back a value from a procedure using an      `OUT` or `INOUT` parameter, pass      the parameter by means of a user variable, and then check the      value of the variable after the procedure returns. (If you are      calling the procedure from within another stored procedure or      function, you can also pass a routine parameter or local routine      variable as an `IN` or `INOUT`      parameter.) For an `INOUT` parameter, initialize      its value before passing it to the procedure. The following      procedure has an `OUT` parameter that the      procedure sets to the current server version, and an      `INOUT` value that the procedure increments by      one from its current value:    

```
CREATE PROCEDURE p (OUT ver_param VARCHAR(25), INOUT incr_param INT)
BEGIN
  # Set value of OUT parameter
  SELECT VERSION() INTO ver_param;
  # Increment value of INOUT parameter
  SET incr_param = incr_param + 1;
END;

```

​      Before calling the procedure, initialize the variable to be passed      as the `INOUT` parameter. After calling the      procedure, the values of the two variables will have been set or      modified:    

```
mysql> SET @increment = 10;
mysql> CALL p(@version, @increment);
mysql> SELECT @version, @increment;
+------------------+------------+
| @version         | @increment |
+------------------+------------+
| 5.5.58-debug-log |         11 |
+------------------+------------+

```

​      In prepared [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) statements used      with [`PREPARE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#prepare) and      [`EXECUTE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#execute), placeholders can be used      for `IN` parameters, `OUT`, and      `INOUT` parameters. These types of parameters can      be used as follows:    

```
mysql> SET @increment = 10;
mysql> PREPARE s FROM 'CALL p(?, ?)';
mysql> EXECUTE s USING @version, @increment;
mysql> SELECT @version, @increment;
+------------------+------------+
| @version         | @increment |
+------------------+------------+
| 5.5.58-debug-log |         11 |
+------------------+------------+

```

​      To write C programs that use the      [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) SQL statement to execute      stored procedures that produce result sets, the      `CLIENT_MULTI_RESULTS` flag must be enabled. This      is because each [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) returns a      result to indicate the call status, in addition to any result sets      that might be returned by statements executed within the      procedure. `CLIENT_MULTI_RESULTS` must also be      enabled if [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) is used to execute      any stored procedure that contains prepared statements. It cannot      be determined when such a procedure is loaded whether those      statements will produce result sets, so it is necessary to assume      that they will.    

​      `CLIENT_MULTI_RESULTS` can be enabled when you      call [`mysql_real_connect()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-real-connect), either      explicitly by passing the `CLIENT_MULTI_RESULTS`      flag itself, or implicitly by passing      `CLIENT_MULTI_STATEMENTS` (which also enables      `CLIENT_MULTI_RESULTS`).      `CLIENT_MULTI_RESULTS` is enabled by default.    

​      To process the result of a [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call)      statement executed using      [`mysql_query()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-query) or      [`mysql_real_query()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-real-query), use a loop      that calls [`mysql_next_result()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-next-result) to      determine whether there are more results. For an example, see      [Section 23.8.16, “C API Multiple Statement Execution Support”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#c-api-multiple-queries).    

​      C programs can use the prepared-statement interface to execute      [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) statements and access      `OUT` and `INOUT` parameters.      This is done by processing the result of a      [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) statement using a loop that      calls [`mysql_stmt_next_result()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-stmt-next-result) to      determine whether there are more results. For an example, see      [Section 23.8.18, “C API Prepared CALL Statement Support”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#c-api-prepared-call-statements). Languages that      provide a MySQL interface can use prepared      [`CALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#call) statements to directly      retrieve `OUT` and `INOUT`      procedure parameters.

### 13.2.2 DELETE Syntax

​      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) is a DML statement that      removes rows from a table.    

​      Single-table syntax:    

```
DELETE [LOW_PRIORITY] [QUICK] [IGNORE] FROM tbl_name
    [WHERE where_condition]
    [ORDER BY ...]
    [LIMIT row_count]

```

​      Multiple-table syntax:    

```
DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
    tbl_name[.*] [, tbl_name[.*]] ...
    FROM table_references
    [WHERE where_condition]

DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
    FROM tbl_name[.*] [, tbl_name[.*]] ...
    USING table_references
    [WHERE where_condition]

```

​      For the single-table syntax, the      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement deletes rows from      *tbl_name* and returns a count of the      number of deleted rows. This count can be obtained by calling the      [`ROW_COUNT()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_row-count) function (see      [Section 12.14, “Information Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#information-functions)). The      `WHERE` clause, if given, specifies the      conditions that identify which rows to delete. With no      `WHERE` clause, all rows are deleted. If the      `ORDER BY` clause is specified, the rows are      deleted in the order that is specified. The      `LIMIT` clause places a limit on the number of      rows that can be deleted.    

​      For the multiple-table syntax,      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) deletes from each      *tbl_name* the rows that satisfy the      conditions. In this case, `ORDER BY` and      `LIMIT` cannot be used.    

​      *where_condition* is an expression that      evaluates to true for each row to be deleted. It is specified as      described in [Section 13.2.9, “SELECT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select).    

​      You cannot delete from a table and select from the same table in a      subquery.    

​      You need the [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_delete) privilege on a      table to delete rows from it. You need only the      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_select) privilege for any columns      that are only read, such as those named in the      `WHERE` clause.    

​      As stated, a [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement with      no `WHERE` clause deletes all rows. A faster way      to do this, when you do not need to know the number of deleted      rows, is to use [`TRUNCATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#truncate-table).      However, within a transaction or if you have a lock on the table,      [`TRUNCATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#truncate-table) cannot be used      whereas [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) can. See      [Section 13.1.33, “TRUNCATE TABLE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#truncate-table), and      [Section 13.3.5, “LOCK TABLES and UNLOCK TABLES Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#lock-tables).    

​      If you delete the row containing the maximum value for an      `AUTO_INCREMENT` column, the value is not reused      for a `MyISAM` or `InnoDB`      table. If you delete all rows in the table with `DELETE      FROM *tbl_name*` (without a      `WHERE` clause) in      [`autocommit`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_autocommit) mode, the sequence      starts over for all storage engines except      `InnoDB` and `MyISAM`. There are      some exceptions to this behavior for `InnoDB`      tables, as discussed in      [Section 14.11.1.5, “AUTO_INCREMENT Handling in InnoDB”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html#innodb-auto-increment-handling).    

​      For `MyISAM` tables, you can specify an      `AUTO_INCREMENT` secondary column in a      multiple-column key. In this case, reuse of values deleted from      the top of the sequence occurs even for `MyISAM`      tables. See [Section 3.6.9, “Using AUTO_INCREMENT”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/tutorial.html#example-auto-increment).    

​      The [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement supports the      following modifiers:

- ​          If you specify `LOW_PRIORITY`, the server          delays execution of the [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete)          until no other clients are reading from the table. This          affects only storage engines that use only table-level locking          (such as `MyISAM`, `MEMORY`,          and `MERGE`).        

  ​

- ​          For `MyISAM` tables, if you use the          `QUICK` modifier, the storage engine does not          merge index leaves during delete, which may speed up some          kinds of delete operations.        

  ​

- ​          The `IGNORE` modifier causes MySQL to ignore          errors during the process of deleting rows. (Errors          encountered during the parsing stage are processed in the          usual manner.) Errors that are ignored due to the use of          `IGNORE` are returned as warnings.

  ​

​      The speed of delete operations may also be affected by factors      discussed in [Section 8.2.4.3, “Optimizing DELETE Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#delete-optimization).    

​      In `MyISAM` tables, deleted rows are maintained      in a linked list and subsequent      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) operations reuse old row      positions. To reclaim unused space and reduce file sizes, use the      [`OPTIMIZE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimize-table) statement or the      [**myisamchk**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#myisamchk) utility to reorganize tables.      [`OPTIMIZE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimize-table) is easier to use,      but [**myisamchk**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#myisamchk) is faster. See      [Section 13.7.2.4, “OPTIMIZE TABLE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimize-table), and [Section 4.6.3, “**myisamchk** — MyISAM Table-Maintenance Utility”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#myisamchk).    

​      The `QUICK` modifier affects whether index leaves      are merged for delete operations. `DELETE QUICK`      is most useful for applications where index values for deleted      rows are replaced by similar index values from rows inserted      later. In this case, the holes left by deleted values are reused.    

​      `DELETE QUICK` is not useful when deleted values      lead to underfilled index blocks spanning a range of index values      for which new inserts occur again. In this case, use of      `QUICK` can lead to wasted space in the index      that remains unreclaimed. Here is an example of such a scenario:

1. ​          Create a table that contains an indexed          `AUTO_INCREMENT` column.        
2. ​          Insert many rows into the table. Each insert results in an          index value that is added to the high end of the index.        
3. ​          Delete a block of rows at the low end of the column range          using `DELETE QUICK`.

​      In this scenario, the index blocks associated with the deleted      index values become underfilled but are not merged with other      index blocks due to the use of `QUICK`. They      remain underfilled when new inserts occur, because new rows do not      have index values in the deleted range. Furthermore, they remain      underfilled even if you later use      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) without      `QUICK`, unless some of the deleted index values      happen to lie in index blocks within or adjacent to the      underfilled blocks. To reclaim unused index space under these      circumstances, use [`OPTIMIZE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimize-table).    

​      If you are going to delete many rows from a table, it might be      faster to use `DELETE QUICK` followed by      [`OPTIMIZE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimize-table). This rebuilds the      index rather than performing many index block merge operations.    

​      The MySQL-specific `LIMIT      *row_count*` option to      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) tells the server the maximum      number of rows to be deleted before control is returned to the      client. This can be used to ensure that a given      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement does not take too      much time. You can simply repeat the      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement until the number      of affected rows is less than the `LIMIT` value.    

​      If the [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement includes an      `ORDER BY` clause, rows are deleted in the order      specified by the clause. This is useful primarily in conjunction      with `LIMIT`. For example, the following      statement finds rows matching the `WHERE` clause,      sorts them by `timestamp_column`, and deletes the      first (oldest) one:    

```
DELETE FROM somelog WHERE user = 'jcole'
ORDER BY timestamp_column LIMIT 1;

```

​      `ORDER BY` may also be useful in some cases to      delete rows in an order required to avoid referential integrity      violations.    

​      If you are deleting many rows from a large table, you may exceed      the lock table size for an `InnoDB` table. To      avoid this problem, or simply to minimize the time that the table      remains locked, the following strategy (which does not use      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) at all) might be helpful:

1. ​          Select the rows *not* to be deleted into an          empty table that has the same structure as the original table:        

   ```
   INSERT INTO t_copy SELECT * FROM t WHERE ... ;

   ```

2. ​          Use [`RENAME TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#rename-table) to atomically          move the original table out of the way and rename the copy to          the original name:        

   ```
   RENAME TABLE t TO t_old, t_copy TO t;

   ```

3. ​          Drop the original table:        

   ```
   DROP TABLE t_old;

   ```

​      No other sessions can access the tables involved while      [`RENAME TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#rename-table) executes, so the      rename operation is not subject to concurrency problems. See      [Section 13.1.32, “RENAME TABLE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#rename-table).    

​      You can specify multiple tables in a      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statement to delete rows      from one or more tables depending on the condition in the      `WHERE` clause. You cannot use `ORDER      BY` or `LIMIT` in a multiple-table      `DELETE`. The      *table_references* clause lists the      tables involved in the join, as described in      [Section 13.2.9.2, “JOIN Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join).    

​      For the first multiple-table syntax, only matching rows from the      tables listed before the `FROM` clause are      deleted. For the second multiple-table syntax, only matching rows      from the tables listed in the `FROM` clause      (before the `USING` clause) are deleted. The      effect is that you can delete rows from many tables at the same      time and have additional tables that are used only for searching:    

```
DELETE t1, t2 FROM t1 INNER JOIN t2 INNER JOIN t3
WHERE t1.id=t2.id AND t2.id=t3.id;

```

​      Or:    

```
DELETE FROM t1, t2 USING t1 INNER JOIN t2 INNER JOIN t3
WHERE t1.id=t2.id AND t2.id=t3.id;

```

​      These statements use all three tables when searching for rows to      delete, but delete matching rows only from tables      `t1` and `t2`.    

​      The preceding examples use `INNER JOIN`, but      multiple-table [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statements      can use other types of join permitted in      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements, such as      `LEFT JOIN`. For example, to delete rows that      exist in `t1` that have no match in      `t2`, use a `LEFT JOIN`:    

```
DELETE t1 FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;

```

​      The syntax permits `.*` after each      *tbl_name* for compatibility with      **Access**.    

​      If you use a multiple-table [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete)      statement involving `InnoDB` tables for which      there are foreign key constraints, the MySQL optimizer might      process tables in an order that differs from that of their      parent/child relationship. In this case, the statement fails and      rolls back. Instead, you should delete from a single table and      rely on the `ON DELETE` capabilities that      `InnoDB` provides to cause the other tables to be      modified accordingly.

Note

​        If you declare an alias for a table, you must use the alias when        referring to the table:      

```
DELETE t1 FROM test AS t1, test2 WHERE ...

```

​      Table aliases in a multiple-table      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) should be declared only in      the *table_references* part of the      statement. Elsewhere, alias references are permitted but not alias      declarations.    

​      Correct:    

```
DELETE a1, a2 FROM t1 AS a1 INNER JOIN t2 AS a2
WHERE a1.id=a2.id;

DELETE FROM a1, a2 USING t1 AS a1 INNER JOIN t2 AS a2
WHERE a1.id=a2.id;

```

​      Incorrect:    

```
DELETE t1 AS a1, t2 AS a2 FROM t1 INNER JOIN t2
WHERE a1.id=a2.id;

DELETE FROM t1 AS a1, t2 AS a2 USING t1 INNER JOIN t2
WHERE a1.id=a2.id;

```

### 13.2.3 DO Syntax

```
DO expr [, expr] ...

```

​      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do) executes the expressions but      does not return any results. In most respects,      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do) is shorthand for `SELECT      *expr*, ...`, but has the      advantage that it is slightly faster when you do not care about      the result.    

​      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do) is useful primarily with      functions that have side effects, such as      [`RELEASE_LOCK()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_release-lock).    

​      Example: This [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement      pauses, but also produces a result set:    

```
mysql> SELECT SLEEP(5);
+----------+
| SLEEP(5) |
+----------+
|        0 |
+----------+
1 row in set (5.02 sec)

```

​      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do), on the other hand, pauses      without producing a result set.:    

```
mysql> DO SLEEP(5);
Query OK, 0 rows affected (4.99 sec)

```

​      This could be useful, for example in a stored function or trigger,      which prohibit statements that produce result sets.    

​      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do) only executes expressions. It      cannot be used in all cases where `SELECT` can be      used. For example, `DO id FROM t1` is invalid      because it references a table.

### 13.2.4 HANDLER Syntax

```
HANDLER tbl_name OPEN [ [AS] alias]

HANDLER tbl_name READ index_name { = | <= | >= | < | > } (value1,value2,...)
    [ WHERE where_condition ] [LIMIT ... ]
HANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST }
    [ WHERE where_condition ] [LIMIT ... ]
HANDLER tbl_name READ { FIRST | NEXT }
    [ WHERE where_condition ] [LIMIT ... ]

HANDLER tbl_name CLOSE

```

​      The `HANDLER` statement provides direct access to      table storage engine interfaces. It is available for      `InnoDB` and `MyISAM` tables.    

​      The `HANDLER ... OPEN` statement opens a table,      making it accessible using subsequent `HANDLER ...      READ` statements. This table object is not shared by      other sessions and is not closed until the session calls      `HANDLER ... CLOSE` or the session terminates.    

​      If you open the table using an alias, further references to the      open table with other `HANDLER` statements must      use the alias rather than the table name. If you do not use an      alias, but open the table using a table name qualified by the      database name, further references must use the unqualified table      name. For example, for a table opened using      `mydb.mytable`, further references must use      `mytable`.    

​      The first `HANDLER ... READ` syntax fetches a row      where the index specified satisfies the given values and the      `WHERE` condition is met. If you have a      multiple-column index, specify the index column values as a      comma-separated list. Either specify values for all the columns in      the index, or specify values for a leftmost prefix of the index      columns. Suppose that an index `my_idx` includes      three columns named `col_a`,      `col_b`, and `col_c`, in that      order. The `HANDLER` statement can specify values      for all three columns in the index, or for the columns in a      leftmost prefix. For example:    

```
HANDLER ... READ my_idx = (col_a_val,col_b_val,col_c_val) ...
HANDLER ... READ my_idx = (col_a_val,col_b_val) ...
HANDLER ... READ my_idx = (col_a_val) ...

```

​      To employ the `HANDLER` interface to refer to a      table's `PRIMARY KEY`, use the quoted identifier      ``PRIMARY``:    

```
HANDLER tbl_name READ `PRIMARY` ...

```

​      The second `HANDLER ... READ` syntax fetches a      row from the table in index order that matches the      `WHERE` condition.    

​      The third `HANDLER ... READ` syntax fetches a row      from the table in natural row order that matches the      `WHERE` condition. It is faster than      `HANDLER *tbl_name* READ      *index_name*` when a full table      scan is desired. Natural row order is the order in which rows are      stored in a `MyISAM` table data file. This      statement works for `InnoDB` tables as well, but      there is no such concept because there is no separate data file.    

​      Without a `LIMIT` clause, all forms of      `HANDLER ... READ` fetch a single row if one is      available. To return a specific number of rows, include a      `LIMIT` clause. It has the same syntax as for the      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement. See      [Section 13.2.9, “SELECT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select).    

​      `HANDLER ... CLOSE` closes a table that was      opened with `HANDLER ... OPEN`.    

​      There are several reasons to use the `HANDLER`      interface instead of normal [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)      statements:

- ​          `HANDLER` is faster than          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select):
  - ​              A designated storage engine handler object is allocated              for the `HANDLER ... OPEN`. The object is              reused for subsequent `HANDLER`              statements for that table; it need not be reinitialized              for each one.            
  - ​              There is less parsing involved.            
  - ​              There is no optimizer or query-checking overhead.            
  - ​              The handler interface does not have to provide a              consistent look of the data (for example,              [dirty reads](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/glossary.html#glos_dirty_read) are              permitted), so the storage engine can use optimizations              that [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) does not              normally permit.
- ​          `HANDLER` makes it easier to port to MySQL          applications that use a low-level `ISAM`-like          interface.        
- ​          `HANDLER` enables you to traverse a database          in a manner that is difficult (or even impossible) to          accomplish with [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select). The          `HANDLER` interface is a more natural way to          look at data when working with applications that provide an          interactive user interface to the database.

​      `HANDLER` is a somewhat low-level statement. For      example, it does not provide consistency. That is,      `HANDLER ... OPEN` does *not*      take a snapshot of the table, and does *not*      lock the table. This means that after a `HANDLER ...      OPEN` statement is issued, table data can be modified (by      the current session or other sessions) and these modifications      might be only partially visible to `HANDLER ...      NEXT` or `HANDLER ... PREV` scans.    

​      An open handler can be closed and marked for reopen, in which case      the handler loses its position in the table. This occurs when both      of the following circumstances are true:

- ​          Any session executes [`FLUSH          TABLES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-tables) or DDL statements on the handler's table.        
- ​          The session in which the handler is open executes          non-`HANDLER` statements that use tables.

​      [`TRUNCATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#truncate-table) for a table closes      all handlers for the table that were opened with      [`HANDLER OPEN`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#handler).    

​      If a table is flushed with      [`FLUSH      TABLES *tbl_name* WITH READ      LOCK`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-tables-with-read-lock-with-list) was opened with `HANDLER`, the      handler is implicitly flushed and loses its position.    

​      `HANDLER` is not supported with partitioned      tables.

### 13.2.5 INSERT Syntax

- [13.2.5.1 INSERT ... SELECT Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select)
- [13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate)
- [13.2.5.3 INSERT DELAYED Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed)

```
INSERT [LOW_PRIORITY | DELAYED | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [(col_name [, col_name] ...)]
    {VALUES | VALUE} (value_list) [, (value_list)] ...
    [ON DUPLICATE KEY UPDATE assignment_list]

INSERT [LOW_PRIORITY | DELAYED | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    SET assignment_list
    [ON DUPLICATE KEY UPDATE assignment_list]

INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [(col_name [, col_name] ...)]
    SELECT ...
    [ON DUPLICATE KEY UPDATE assignment_list]

value:
    {expr | DEFAULT}

value_list:
    value [, value] ...

assignment:
    col_name = value

assignment_list:
    assignment [, assignment] ...

```

​      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) inserts new rows into an      existing table. The [`INSERT      ... VALUES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) and      [`INSERT ... SET`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert)      forms of the statement insert rows based on explicitly specified      values. The [`INSERT      ... SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) form inserts rows selected from another table      or tables. [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) with an      `ON DUPLICATE KEY UPDATE` clause enables existing      rows to be updated if a row to be inserted would cause a duplicate      value in a `UNIQUE` index or `PRIMARY      KEY`.    

​      For additional information about      [`INSERT ...      SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) and      [`INSERT ... ON      DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate), see      [Section 13.2.5.1, “INSERT ... SELECT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select), and      [Section 13.2.5.2, “INSERT ... ON DUPLICATE KEY UPDATE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate).    

​      Inserting into a table requires the      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_insert) privilege for the table. If      the `ON DUPLICATE KEY UPDATE` clause is used and      a duplicate key causes an [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) to      be performed instead, the statement requires the      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_update) privilege for the columns to      be updated. For columns that are read but not modified you need      only the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_select) privilege (such as      for a column referenced only on the right hand side of an      *col_name*=*expr*      assignment in an `ON DUPLICATE KEY UPDATE`      clause).    

​      You can use [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) instead of      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) to overwrite old rows.      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) is the counterpart to      [`INSERT IGNORE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) in      the treatment of new rows that contain unique key values that      duplicate old rows: The new rows replace the old rows rather than      being discarded. See [Section 13.2.8, “REPLACE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace).    

​      *tbl_name* is the table into which rows      should be inserted. Specify the columns for which the statement      provides values as follows:

- ​          Provide a parenthesized list of comma-separated column names          following the table name. In this case, a value for each named          column must be provided by the `VALUES` list          or the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement.        
- ​          If you do not specify a list of column names for          [`INSERT ...          VALUES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) or          [`INSERT ...          SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select), values for every column in the table must be          provided by the `VALUES` list or the          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement. If you do not          know the order of the columns in the table, use          `DESCRIBE          *tbl_name*` to find out.        
- ​          A `SET` clause indicates columns explicitly          by name, together with the value to assign each one.

​      Column values can be given in several ways:

- ​          If strict SQL mode is not enabled, any column not explicitly          given a value is set to its default (explicit or implicit)          value. For example, if you specify a column list that does not          name all the columns in the table, unnamed columns are set to          their default values. Default value assignment is described in          [Section 11.6, “Data Type Default Values”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#data-type-defaults). See also          [Section 1.7.3.3, “Constraints on Invalid Data”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/introduction.html#constraint-invalid-data).        

  ​

  ​          If strict SQL mode is enabled, an          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement generates an          error if it does not specify an explicit value for every          column that has no default value. See          [Section 5.1.8, “Server SQL Modes”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sql-mode).        

- ​          If both the column list and the `VALUES` list          are empty, [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) creates a row          with each column set to its default value:        

  ```
  INSERT INTO tbl_name () VALUES();

  ```

  ​          If strict mode is not enabled, MySQL uses the implicit default          value for any column that has no explicitly defined default.          If strict mode is enabled, an error occurs if any column has          no default value.        

- ​          Use the keyword `DEFAULT` to set a column          explicitly to its default value. This makes it easier to write          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements that assign          values to all but a few columns, because it enables you to          avoid writing an incomplete `VALUES` list          that does not include a value for each column in the table.          Otherwise, you must provide the list of column names          corresponding to each value in the `VALUES`          list.        

- ​          In expressions, you can use          [`DEFAULT(*col_name*)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_default)          to produce the default value for column          *col_name*.        

- ​          Type conversion of an expression          *expr* that provides a column value          might occur if the expression data type does not match the          column data type. Conversion of a given value can result in          different inserted values depending on the column type. For          example, inserting the string `'1999.0e-2'`          into an [`INT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types),          [`FLOAT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#floating-point-types),          [`DECIMAL(10,6)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#fixed-point-types), or          [`YEAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#year) column inserts the value          `1999`, `19.9921`,          `19.992100`, or `1999`,          respectively. The value stored in the          [`INT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types) and          [`YEAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#year) columns is          `1999` because the string-to-number          conversion looks only at as much of the initial part of the          string as may be considered a valid integer or year. For the          [`FLOAT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#floating-point-types) and          [`DECIMAL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#fixed-point-types) columns, the          string-to-number conversion considers the entire string a          valid numeric value.        

- ​          An expression *expr* can refer to any          column that was set earlier in a value list. For example, you          can do this because the value for `col2`          refers to `col1`, which has previously been          assigned:        

  ```
  INSERT INTO tbl_name (col1,col2) VALUES(15,col1*2);

  ```

  ​          But the following is not legal, because the value for          `col1` refers to `col2`,          which is assigned after `col1`:        

  ```
  INSERT INTO tbl_name (col1,col2) VALUES(col2*2,15);

  ```

  ​          An exception occurs for columns that contain          `AUTO_INCREMENT` values. Because          `AUTO_INCREMENT` values are generated after          other value assignments, any reference to an          `AUTO_INCREMENT` column in the assignment          returns a `0`.

​      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements that use      `VALUES` syntax can insert multiple rows. To do      this, include multiple lists of comma-separated column values,      with lists enclosed within parentheses and separated by commas.      Example:    

```
INSERT INTO tbl_name (a,b,c) VALUES(1,2,3),(4,5,6),(7,8,9);

```

​      Each values list must contain exactly as many values as are to be      inserted per row. The following statement is invalid because it      contains one list of nine values, rather than three lists of three      values each:    

```
INSERT INTO tbl_name (a,b,c) VALUES(1,2,3,4,5,6,7,8,9);

```

​      `VALUE` is a synonym for      `VALUES` in this context. Neither implies      anything about the number of values lists, nor about the number of      values per list. Either may be used whether there is a single      values list or multiple lists, and regardless of the number of      values per list.    

​      The affected-rows value for an      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) can be obtained using the      [`ROW_COUNT()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_row-count) SQL function or the      [`mysql_affected_rows()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-affected-rows) C API      function. See [Section 12.14, “Information Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#information-functions), and      [Section 23.8.7.1, “mysql_affected_rows()”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-affected-rows).    

​      If you use an [`INSERT ...      VALUES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement with multiple value lists or      [`INSERT ...      SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select), the statement returns an information string in      this format:    

```
Records: N1 Duplicates: N2 Warnings: N3

```

​      If you are using the C API, the information string can be obtained      by invoking the [`mysql_info()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info)      function. See [Section 23.8.7.35, “mysql_info()”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info).    

​      `Records` indicates the number of rows processed      by the statement. (This is not necessarily the number of rows      actually inserted because `Duplicates` can be      nonzero.) `Duplicates` indicates the number of      rows that could not be inserted because they would duplicate some      existing unique index value. `Warnings` indicates      the number of attempts to insert column values that were      problematic in some way. Warnings can occur under any of the      following conditions:

- ​          Inserting `NULL` into a column that has been          declared `NOT NULL`. For multiple-row          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements or          [`INSERT INTO ...          SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements, the column is set to the implicit          default value for the column data type. This is          `0` for numeric types, the empty string          (`''`) for string types, and the          “zero” value for date and time types.          [`INSERT INTO ...          SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements are handled the same way as          multiple-row inserts because the server does not examine the          result set from the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) to          see whether it returns a single row. (For a single-row          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert), no warning occurs when          `NULL` is inserted into a `NOT          NULL` column. Instead, the statement fails with an          error.)        

- ​          Setting a numeric column to a value that lies outside the          column's range. The value is clipped to the closest endpoint          of the range.        

- ​          Assigning a value such as `'10.34 a'` to a          numeric column. The trailing nonnumeric text is stripped off          and the remaining numeric part is inserted. If the string          value has no leading numeric part, the column is set to          `0`.        

- ​          Inserting a string into a string column          ([`CHAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#char),          [`VARCHAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#char),          [`TEXT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob), or          [`BLOB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob)) that exceeds the column's          maximum length. The value is truncated to the column's maximum          length.        

- ​          Inserting a value into a date or time column that is illegal          for the data type. The column is set to the appropriate zero          value for the type.

  ​

​      If [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) inserts a row into a      table that has an `AUTO_INCREMENT` column, you      can find the value used for that column by using the      [`LAST_INSERT_ID()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_last-insert-id) SQL function or      the [`mysql_insert_id()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-insert-id) C API      function.

Note

​        These two functions do not always behave identically. The        behavior of [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements        with respect to `AUTO_INCREMENT` columns is        discussed further in [Section 12.14, “Information Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#information-functions),        and [Section 23.8.7.37, “mysql_insert_id()”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-insert-id).

​      The [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement supports the      following modifiers:

- ​          If you use the `DELAYED` modifier, the server          puts the row or rows to be inserted into a buffer, and the          client issuing the [`INSERT          DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statement can then continue immediately. If          the table is in use, the server holds the rows. When the table          is free, the server begins inserting rows, checking          periodically to see whether there are any new read requests          for the table. If there are, the delayed row queue is          suspended until the table becomes free again. See          [Section 13.2.5.3, “INSERT DELAYED Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed).        

  ​

  ​

  ​          `DELAYED` is ignored with          [`INSERT ...          SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) or          [`INSERT          ... ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate).        

  ​

  ​

  ​          `DELAYED` is also disregarded for an          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) that uses functions          accessing tables or triggers, or that is called from a          function or a trigger.        

- ​          If you use the `LOW_PRIORITY` modifier,          execution of the [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) is          delayed until no other clients are reading from the table.          This includes other clients that began reading while existing          clients are reading, and while the `INSERT          LOW_PRIORITY` statement is waiting. It is possible,          therefore, for a client that issues an `INSERT          LOW_PRIORITY` statement to wait for a very long time          (or even forever) in a read-heavy environment. (This is in          contrast to [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed),          which lets the client continue at once.)        

  ​          `LOW_PRIORITY` affects only storage engines          that use only table-level locking (such as          `MyISAM`, `MEMORY`, and          `MERGE`).

  Note

  ​            `LOW_PRIORITY` should normally not be used            with `MyISAM` tables because doing so            disables concurrent inserts. See            [Section 8.11.3, “Concurrent Inserts”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#concurrent-inserts).

- ​          If you specify `HIGH_PRIORITY`, it overrides          the effect of the          [`--low-priority-updates`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#option_mysqld_low-priority-updates) option          if the server was started with that option. It also causes          concurrent inserts not to be used. See          [Section 8.11.3, “Concurrent Inserts”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#concurrent-inserts).        

  ​

  ​          `HIGH_PRIORITY` affects only storage engines          that use only table-level locking (such as          `MyISAM`, `MEMORY`, and          `MERGE`).        

- ​          If you use the `IGNORE` modifier, errors that          occur while executing the          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement are ignored.          For example, without `IGNORE`, a row that          duplicates an existing `UNIQUE` index or          `PRIMARY KEY` value in the table causes a          duplicate-key error and the statement is aborted. With          `IGNORE`, the row is discarded and no error          occurs. Ignored errors may generate warnings instead, although          duplicate-key errors do not.        

  ​

  ​                    `IGNORE` has a similar effect on inserts into          partitioned tables where no partition matching a given value          is found. Without `IGNORE`, such          [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements are aborted          with an error. When          [`INSERT          IGNORE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) is used, the insert operation fails silently          for rows containing the unmatched value, but inserts rows that          are matched. For an example, see          [Section 19.2.2, “LIST Partitioning”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-list).        

  ​          Data conversions that would trigger errors abort the statement          if `IGNORE` is not specified. With          `IGNORE`, invalid values are adjusted to the          closest values and inserted; warnings are produced but the          statement does not abort. You can determine with the          [`mysql_info()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info) C API function          how many rows were actually inserted into the table.        

- ​          If you specify `ON DUPLICATE KEY UPDATE`, and          a row is inserted that would cause a duplicate value in a          `UNIQUE` index or `PRIMARY          KEY`, an [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) of the          old row occurs. The affected-rows value per row is 1 if the          row is inserted as a new row, 2 if an existing row is updated,          and 0 if an existing row is set to its current values. If you          specify the `CLIENT_FOUND_ROWS` flag to the          [`mysql_real_connect()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-real-connect) C API          function when connecting to [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld), the          affected-rows value is 1 (not 0) if an existing row is set to          its current values. See [Section 13.2.5.2, “INSERT ... ON DUPLICATE KEY UPDATE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate).

  ​

​      An `INSERT` statement affecting a partitioned      table using a storage engine such as      [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that employs table-level locks      locks all partitions of the table. This does not occur with tables      using storage engines such as [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html)      that employ row-level locking. This issue is resolved in MySQL      5.6. For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

#### 13.2.5.1 INSERT ... SELECT Syntax

```
INSERT [LOW_PRIORITY | HIGH_PRIORITY] [IGNORE]
    [INTO] tbl_name
    [(col_name [, col_name] ...)]
    SELECT ...
    [ON DUPLICATE KEY UPDATE assignment_list]

value:
    {expr | DEFAULT}

assignment:
    col_name = value

assignment_list:
    assignment [, assignment] ...

```

​        With [`INSERT ...        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select), you can quickly insert many rows into a table        from the result of a [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        statement, which can select from one or many tables. For        example:      

```
INSERT INTO tbl_temp2 (fld_id)
  SELECT tbl_temp1.fld_order_id
  FROM tbl_temp1 WHERE tbl_temp1.fld_order_id > 100;

```

​        The following conditions hold for        [`INSERT ...        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements:

- ​            Specify `IGNORE` to ignore rows that would            cause duplicate-key violations.          

- ​            `DELAYED` is ignored with            [`INSERT ...            SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select).          

- ​            The target table of the            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement may appear            in the `FROM` clause of the            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) part of the query.            However, you cannot insert into a table and select from the            same table in a subquery.          

  ​            When selecting from and inserting into the same table, MySQL            creates an internal temporary table to hold the rows from            the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and then inserts            those rows into the target table. However, you cannot use            `INSERT INTO t ... SELECT ... FROM t` when            `t` is a `TEMPORARY`            table, because `TEMPORARY` tables cannot be            referred to twice in the same statement. See            [Section 8.4.4, “Internal Temporary Table Use in MySQL”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#internal-temporary-tables), and            [Section B.5.6.2, “TEMPORARY Table Problems”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/error-handling.html#temporary-table-problems).          

- ​            `AUTO_INCREMENT` columns work as usual.          

- ​            To ensure that the binary log can be used to re-create the            original tables, MySQL does not permit concurrent inserts            for [`INSERT            ... SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements (see            [Section 8.11.3, “Concurrent Inserts”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#concurrent-inserts)).          

- ​            To avoid ambiguous column reference problems when the            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and the            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) refer to the same            table, provide a unique alias for each table used in the            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) part, and qualify            column names in that part with the appropriate alias.

​        For [`INSERT        ... SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statements, see        [Section 13.2.5.2, “INSERT ... ON DUPLICATE KEY UPDATE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) for conditions under which        the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) columns can be        referred to in an `ON DUPLICATE KEY UPDATE`        clause.      

​        The order in which a [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        statement with no `ORDER BY` clause returns        rows is indeterminate. This means that, when using replication,        there is no guarantee that such a        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) returns rows in the same        order on the master and the slave, which can lead to        inconsistencies between them. To prevent this from occurring,        always write `INSERT ... SELECT` statements        that are to be replicated using an `ORDER BY`        clause that produces the same row order on the master and the        slave. See also [Section 17.4.1.16, “Replication and LIMIT”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-features-limit).      

​        Due to this issue, beginning with MySQL 5.5.18,        [`INSERT ...        SELECT ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) and        [`INSERT IGNORE ...        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements are flagged as unsafe for        statement-based replication. Such statements produce a warning        in the error log when using statement-based mode and are written        to the binary log using the row-based format when using        `MIXED` mode. (Bug #11758262, Bug #50439)      

​        See also [Section 17.1.2.1, “Advantages and Disadvantages of Statement-Based and Row-Based        Replication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-sbr-rbr).      

​        An `INSERT ... SELECT` statement affecting        partitioned tables using a storage engine such as        [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that employs table-level        locks locks all partitions of the source and target tables. This        does not occur with tables using storage engines such as        [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html) that employ row-level        locking. This issue is resolved in MySQL 5.6. For more        information, see        [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

#### 13.2.5.2 INSERT ... ON DUPLICATE KEY UPDATE Syntax

​        If you specify an `ON DUPLICATE KEY UPDATE`        clause and a row to be inserted would cause a duplicate value in        a `UNIQUE` index or `PRIMARY        KEY`, an [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) of the        old row occurs. For example, if column `a` is        declared as `UNIQUE` and contains the value        `1`, the following two statements have similar        effect:      

```
INSERT INTO t1 (a,b,c) VALUES (1,2,3)
  ON DUPLICATE KEY UPDATE c=c+1;

UPDATE t1 SET c=c+1 WHERE a=1;

```

​        (The effects are not identical for an `InnoDB`        table where `a` is an auto-increment column.        With an auto-increment column, an `INSERT`        statement increases the auto-increment value but        `UPDATE` does not.)      

​        If column `b` is also unique, the        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) is equivalent to this        [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement instead:      

```
UPDATE t1 SET c=c+1 WHERE a=1 OR b=2 LIMIT 1;

```

​        If `a=1 OR b=2` matches several rows, only        *one* row is updated. In general, you should        try to avoid using an `ON DUPLICATE KEY UPDATE`        clause on tables with multiple unique indexes.      

​        With `ON DUPLICATE KEY UPDATE`, the        affected-rows value per row is 1 if the row is inserted as a new        row, 2 if an existing row is updated, and 0 if an existing row        is set to its current values. If you specify the        `CLIENT_FOUND_ROWS` flag to the        [`mysql_real_connect()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-real-connect) C API        function when connecting to [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld), the        affected-rows value is 1 (not 0) if an existing row is set to        its current values.      

​        If a table contains an `AUTO_INCREMENT` column        and [`INSERT        ... ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) inserts or updates a row,        the [`LAST_INSERT_ID()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_last-insert-id) function        returns the `AUTO_INCREMENT` value.      

​        The `ON DUPLICATE KEY UPDATE` clause can        contain multiple column assignments, separated by commas.      

​        In assignment value expressions in the `ON DUPLICATE KEY        UPDATE` clause, you can use the        [`VALUES(*col_name*)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_values)        function to refer to column values from the        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) portion of the        [`INSERT ...        ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statement. In other words,        [`VALUES(*col_name*)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_values)        in the `ON DUPLICATE KEY UPDATE` clause refers        to the value of *col_name* that would        be inserted, had no duplicate-key conflict occurred. This        function is especially useful in multiple-row inserts. The        [`VALUES()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_values) function is meaningful        only in the `ON DUPLICATE KEY UPDATE` clause or        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements and returns        `NULL` otherwise. Example:      

```
INSERT INTO t1 (a,b,c) VALUES (1,2,3),(4,5,6)
  ON DUPLICATE KEY UPDATE c=VALUES(a)+VALUES(b);

```

​        That statement is identical to the following two statements:      

```
INSERT INTO t1 (a,b,c) VALUES (1,2,3)
  ON DUPLICATE KEY UPDATE c=3;
INSERT INTO t1 (a,b,c) VALUES (4,5,6)
  ON DUPLICATE KEY UPDATE c=9;

```

​        The `DELAYED` option is ignored when you use        `ON DUPLICATE KEY UPDATE`.      

​        For [`INSERT        ... SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statements, these rules apply regarding        acceptable forms of `SELECT` query expressions        that you can refer to in an `ON DUPLICATE KEY        UPDATE` clause:

- ​            References to columns from queries on a single table, which            may be a derived table.          
- ​            References to columns from queries on a join over multiple            tables.          
- ​            References to columns from `DISTINCT`            queries.          
- ​            References to columns in other tables, as long as the            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) does not use            `GROUP BY`. One side effect is that you            must qualify references to nonunique column names.

​        References to columns from a        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) do not work reliably. To        work around this restriction, rewrite the        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) as a derived table so that        its rows can be treated as a single-table result set. For        example, this statement is problematic:      

```
INSERT INTO t1 (a, b)
  SELECT c, d FROM t2
  UNION
  SELECT e, f FROM t3
ON DUPLICATE KEY UPDATE b = b + c;

```

​        Instead, use an equivalent statement that rewrites the        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) as a derived table:      

```
INSERT INTO t1 (a, b)
SELECT * FROM
  (SELECT c, d FROM t2
   UNION
   SELECT e, f FROM t3) AS dt
ON DUPLICATE KEY UPDATE b = b + c;

```

​        The technique of rewriting a query as a derived table also        enables references to columns from `GROUP BY`        queries.      

​        Because the results of        [`INSERT ...        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) statements depend on the ordering of rows from        the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and this order cannot        always be guaranteed, it is possible when logging        [`INSERT ...        SELECT ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statements for the        master and the slave to diverge. Thus, in MySQL 5.5.18 and        later,        [`INSERT ...        SELECT ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statements are flagged        as unsafe for statement-based replication. With this change,        such statements produce a warning in the error log when using        statement-based mode and are written to the binary using the        row-based format when using `MIXED` mode. In        addition, beginning with MySQL 5.5.24, an        [`INSERT ...        ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statement against a table        having more than one unique or primary key is also marked as        unsafe. (Bug #11765650, Bug #58637)      

​        See also [Section 17.1.2.1, “Advantages and Disadvantages of Statement-Based and Row-Based        Replication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-sbr-rbr).      

​        An `INSERT ... ON DUPLICATE KEY UPDATE` on a        partitioned table using a storage engine such as        [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that employs table-level        locks locks all partitions of the table. This does not occur        with tables using storage engines such as        [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html) that employ row-level        locking. This issue is resolved in MySQL 5.6. For more        information, see        [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

#### 13.2.5.3 INSERT DELAYED Syntax

```
INSERT DELAYED ...

```

​        The `DELAYED` option for the        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement is a MySQL        extension to standard SQL that is very useful if you have        clients that cannot or need not wait for the        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) to complete. This is a        common situation when you use MySQL for logging and you also        periodically run [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and        [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statements that take a        long time to complete.      

​        When a client uses [`INSERT        DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed), it gets an okay from the server at once, and        the row is queued to be inserted when the table is not in use by        any other thread.      

​        Another major benefit of using [`INSERT        DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is that inserts from many clients are bundled        together and written in one block. This is much faster than        performing many separate inserts.

Note

​          [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is slower than a          normal [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) if the table is          not otherwise in use. There is also the additional overhead          for the server to handle a separate thread for each table for          which there are delayed rows. This means that you should use          [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) only when you          are really sure that you need it.

​        The queued rows are held only in memory until they are inserted        into the table. This means that if you terminate        [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) forcibly (for example, with        `kill -9`) or if [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) dies        unexpectedly, *any queued rows that have not been        written to disk are lost*.      

​        There are some constraints on the use of        `DELAYED`:

- ​            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) works only            with `MyISAM`, `MEMORY`,            `ARCHIVE`, and `BLACKHOLE`            tables. For engines that do not support            `DELAYED`, an error occurs.          

- ​            An error occurs for [`INSERT            DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) if used with a table that has been locked            with `LOCK TABLES` because the insert must            be handled by a separate thread, not by the session that            holds the lock.          

- ​            For `MyISAM` tables, if there are no free            blocks in the middle of the data file, concurrent            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements are            supported. Under these circumstances, you very seldom need            to use [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) with            `MyISAM`.          

- ​            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) should be used            only for [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements            that specify value lists. The server ignores            `DELAYED` for            [`INSERT ...            SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-select) or            [`INSERT            ... ON DUPLICATE KEY UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate) statements.          

- ​            Because the [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed)            statement returns immediately, before the rows are inserted,            you cannot use            [`LAST_INSERT_ID()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_last-insert-id) to get the            `AUTO_INCREMENT` value that the statement            might generate.          

- ​            `DELAYED` rows are not visible to            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements until they            actually have been inserted.          

- ​            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is handled as            a simple [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) (that is,            without the `DELAYED` option) whenever the            value of [`binlog_format`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#sysvar_binlog_format) is            `STATEMENT` or `MIXED`.            (In the latter case, the statement does not trigger a switch            to row-based logging, and so is logged using the            statement-based format.)          

  ​            This does not apply when using row-based binary logging mode            ([`binlog_format`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#sysvar_binlog_format) set to            `ROW`), in which            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statements are            always executed using the `DELAYED` option            as specified, and logged as row-update events.          

- ​            `DELAYED` is ignored on slave replication            servers, so that [`INSERT            DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is treated as a normal            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) on slaves. This is            because `DELAYED` could cause the slave to            have different data than the master.          

- ​            Pending [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed)            statements are lost if a table is write locked and            [`ALTER TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#alter-table) is used to modify            the table structure.          

- ​            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is not            supported for views.          

- ​            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) is not            supported for partitioned tables.

​        The following describes in detail what happens when you use the        `DELAYED` option to        [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) or        [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace). In this description, the        “thread” is the thread that received an        [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statement and        “handler” is the thread that handles all        [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statements for a        particular table.

- ​            When a thread executes a `DELAYED`            statement for a table, a handler thread is created to            process all `DELAYED` statements for the            table, if no such handler already exists.          

- ​            The thread checks whether the handler has previously            acquired a `DELAYED` lock; if not, it tells            the handler thread to do so. The `DELAYED`            lock can be obtained even if other threads have a            `READ` or `WRITE` lock on            the table. However, the handler waits for all            [`ALTER TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#alter-table) locks or            [`FLUSH TABLES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-tables) statements to            finish, to ensure that the table structure is up to date.          

- ​            The thread executes the            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement, but instead            of writing the row to the table, it puts a copy of the final            row into a queue that is managed by the handler thread. Any            syntax errors are noticed by the thread and reported to the            client program.          

- ​            The client cannot obtain from the server the number of            duplicate rows or the `AUTO_INCREMENT`            value for the resulting row, because the            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) returns before the            insert operation has been completed. (If you use the C API,            the [`mysql_info()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info) function            does not return anything meaningful, for the same reason.)          

- ​            The binary log is updated by the handler thread when the row            is inserted into the table. In case of multiple-row inserts,            the binary log is updated when the first row is inserted.          

- ​                        Each time that            [`delayed_insert_limit`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_delayed_insert_limit) rows            are written, the handler checks whether any            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements are still            pending. If so, it permits these to execute before            continuing.          

- ​                        When the handler has no more rows in its queue, the table is            unlocked. If no new [`INSERT            DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statements are received within            [`delayed_insert_timeout`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_delayed_insert_timeout)            seconds, the handler terminates.          

- ​            If more than            [`delayed_queue_size`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_delayed_queue_size) rows are            pending in a specific handler queue, the thread requesting            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) waits until            there is room in the queue. This is done to ensure that            [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) does not use all memory for the            delayed memory queue.          

- ​            The handler thread shows up in the MySQL process list with            `delayed_insert` in the            `Command` column. It is killed if you            execute a [`FLUSH TABLES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-tables)            statement or kill it with `KILL            *thread_id*`. However,            before exiting, it first stores all queued rows into the            table. During this time it does not accept any new            [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements from other            threads. If you execute an [`INSERT            DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statement after this, a new handler thread            is created.          

  ​            This means that [`INSERT            DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statements have higher priority than            normal [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements if            there is an [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed)            handler running. Other update statements have to wait until            the [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) queue is            empty, someone terminates the handler thread (with            `KILL            *thread_id*`), or someone            executes a [`FLUSH TABLES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-tables).          

- ​            The following status variables provide information about            [`INSERT DELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) statements.

  | Status Variable                          | Meaning                                  |
  | ---------------------------------------- | ---------------------------------------- |
  | [`Delayed_insert_threads`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#statvar_Delayed_insert_threads) | Number of handler threads                |
  | [`Delayed_writes`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#statvar_Delayed_writes) | Number of rows written with [`INSERTDELAYED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-delayed) |
  | [`Not_flushed_delayed_rows`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#statvar_Not_flushed_delayed_rows) | Number of rows waiting to be written     |

  ​            You can view these variables by issuing a            [`SHOW STATUS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-status) statement or by            executing a [**mysqladmin extended-status**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin)            command.

### 13.2.6 LOAD DATA INFILE Syntax

```
LOAD DATA [LOW_PRIORITY | CONCURRENT] [LOCAL] INFILE 'file_name'
    [REPLACE | IGNORE]
    INTO TABLE tbl_name
    [CHARACTER SET charset_name]
    [{FIELDS | COLUMNS}
        [TERMINATED BY 'string']
        [[OPTIONALLY] ENCLOSED BY 'char']
        [ESCAPED BY 'char']
    ]
    [LINES
        [STARTING BY 'string']
        [TERMINATED BY 'string']
    ]
    [IGNORE number {LINES | ROWS}]
    [(col_name_or_user_var
        [, col_name_or_user_var] ...)]
    [SET col_name={expr | DEFAULT},
        [, col_name={expr | DEFAULT}] ...]

```

​      The [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement reads rows from a text file into a      table at a very high speed.      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) is the complement of      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into). (See [Section 13.2.9.1, “SELECT ... INTO Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into).) To write      data from a table to a file, use      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into). To read the file back into a table, use      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data). The syntax of the `FIELDS` and      `LINES` clauses is the same for both statements.      Both clauses are optional, but `FIELDS` must      precede `LINES` if both are specified.    

​      You can also load data files by using the      [**mysqlimport**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqlimport) utility; it operates by sending a      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement to the server. The      [`--local`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysqlimport_local) option causes      [**mysqlimport**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqlimport) to read data files from the client      host. You can specify the      [`--compress`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysqlimport_compress) option to get      better performance over slow networks if the client and server      support the compressed protocol. See      [Section 4.5.5, “**mysqlimport** — A Data Import Program”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqlimport).    

​      For more information about the efficiency of      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) versus      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) and speeding up      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), see [Section 8.2.4.1, “Optimizing INSERT Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#insert-optimization).    

​      The file name must be given as a literal string. On Windows,      specify backslashes in path names as forward slashes or doubled      backslashes. The      [`character_set_filesystem`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_character_set_filesystem) system      variable controls the interpretation of the file name.    

​      The server uses the character set indicated by the      [`character_set_database`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_character_set_database) system      variable to interpret the information in the file.      [`SET NAMES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-names) and the setting of      [`character_set_client`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_character_set_client) do not      affect interpretation of input. If the contents of the input file      use a character set that differs from the default, it is usually      preferable to specify the character set of the file by using the      `CHARACTER SET` clause. A character set of      `binary` specifies “no conversion.”    

​      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) interprets all fields in the file as having the      same character set, regardless of the data types of the columns      into which field values are loaded. For proper interpretation of      file contents, you must ensure that it was written with the      correct character set. For example, if you write a data file with      [**mysqldump -T**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqldump) or by issuing a      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) statement in [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql), be sure      to use a `--default-character-set` option so that      output is written in the character set to be used when the file is      loaded with [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data).

Note

​        It is not possible to load data files that use the        `ucs2`, `utf16`, or        `utf32` character set.

​      If you use `LOW_PRIORITY`, execution of the      [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement is delayed      until no other clients are reading from the table. This affects      only storage engines that use only table-level locking (such as      `MyISAM`, `MEMORY`, and      `MERGE`).    

​      If you specify `CONCURRENT` with a      `MyISAM` table that satisfies the condition for      concurrent inserts (that is, it contains no free blocks in the      middle), other threads can retrieve data from the table while      [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) is executing. This option      affects the performance of [`LOAD      DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) a bit, even if no other thread is using the table      at the same time.    

​      With row-based replication, `CONCURRENT` is      replicated regardless of MySQL version. With statement-based      replication `CONCURRENT` is not replicated prior      to MySQL 5.5.1 (see Bug #34628). For more information, see      [Section 17.4.1.17, “Replication and LOAD DATA INFILE”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-features-load-data).    

​      The `LOCAL` keyword affects expected location of      the file and error handling, as described later.      `LOCAL` works only if your server and your client      both have been configured to permit it. For example, if      [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) was started with the      [`local_infile`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_local_infile) system variable      disabled, `LOCAL` does not work. See      [Section 6.1.6, “Security Issues with LOAD DATA LOCAL”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#load-data-local).    

​      The `LOCAL` keyword affects where the file is      expected to be found:

- ​          If `LOCAL` is specified, the file is read by          the client program on the client host and sent to the server.          The file can be given as a full path name to specify its exact          location. If given as a relative path name, the name is          interpreted relative to the directory in which the client          program was started.        

  ​          When using `LOCAL` with          [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), a copy of the file          is created in the server's temporary directory. This is          *not* the directory determined by the value          of [`tmpdir`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_tmpdir) or          [`slave_load_tmpdir`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#sysvar_slave_load_tmpdir), but rather          the operating system's temporary directory, and is not          configurable in the MySQL Server. (Typically the system          temporary directory is `/tmp` on Linux          systems and `C:\WINDOWS\TEMP` on Windows.)          Lack of sufficient space for the copy in this directory can          cause the [`LOAD DATA          LOCAL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement to fail.        

- ​          If `LOCAL` is not specified, the file must be          located on the server host and is read directly by the server.          The server uses the following rules to locate the file:

  - ​              If the file name is an absolute path name, the server uses              it as given.            
  - ​              If the file name is a relative path name with one or more              leading components, the server searches for the file              relative to the server's data directory.            
  - ​              If a file name with no leading components is given, the              server looks for the file in the database directory of the              default database.

​      In the non-`LOCAL` case, these rules mean that a      file named as `./myfile.txt` is read from the      server's data directory, whereas the file named as      `myfile.txt` is read from the database      directory of the default database. For example, if      `db1` is the default database, the following      [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement reads the file      `data.txt` from the database directory for      `db1`, even though the statement explicitly loads      the file into a table in the `db2` database:    

```
LOAD DATA INFILE 'data.txt' INTO TABLE db2.my_table;

```

​      Non-`LOCAL` load operations read text files      located on the server. For security reasons, such operations      require that you have the [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file)      privilege. See [Section 6.2.1, “Privileges Provided by MySQL”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#privileges-provided). Also,      non-`LOCAL` load operations are subject to the      [`secure_file_priv`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_secure_file_priv) system variable      setting. If the variable value is a nonempty directory name, the      file to be loaded must be located in that directory. If the      variable value is empty (which is insecure), the file need only be      readable by the server.    

​      Using `LOCAL` is a bit slower than letting the      server access the files directly, because the contents of the file      must be sent over the connection by the client to the server. On      the other hand, you do not need the      [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file) privilege to load local files.    

​      `LOCAL` also affects error handling:

- ​          With [`LOAD DATA          INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), data-interpretation and duplicate-key errors          terminate the operation.        
- ​          With [`LOAD DATA          LOCAL INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), data-interpretation and duplicate-key          errors become warnings and the operation continues because the          server has no way to stop transmission of the file in the          middle of the operation. For duplicate-key errors, this is the          same as if `IGNORE` is specified.          `IGNORE` is explained further later in this          section.

​      The `REPLACE` and `IGNORE`      keywords control handling of input rows that duplicate existing      rows on unique key values:

- ​          If you specify `REPLACE`, input rows replace          existing rows. In other words, rows that have the same value          for a primary key or unique index as an existing row. See          [Section 13.2.8, “REPLACE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace).        

- ​          If you specify `IGNORE`, rows that duplicate          an existing row on a unique key value are discarded.        

  ​

- ​          If you do not specify either option, the behavior depends on          whether the `LOCAL` keyword is specified.          Without `LOCAL`, an error occurs when a          duplicate key value is found, and the rest of the text file is          ignored. With `LOCAL`, the default behavior          is the same as if `IGNORE` is specified; this          is because the server has no way to stop transmission of the          file in the middle of the operation.

​      To ignore foreign key constraints during the load operation, issue      a `SET foreign_key_checks = 0` statement before      executing [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data).    

​      If you use [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) on an empty `MyISAM` table, all      nonunique indexes are created in a separate batch (as for      [`REPAIR TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#repair-table)). Normally, this makes      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) much faster when you have many indexes. In some      extreme cases, you can create the indexes even faster by turning      them off with `ALTER TABLE ... DISABLE KEYS`      before loading the file into the table and using `ALTER      TABLE ... ENABLE KEYS` to re-create the indexes after      loading the file. See [Section 8.2.4.1, “Optimizing INSERT Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#insert-optimization).    

​      For both the [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) and      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) statements, the syntax of the      `FIELDS` and `LINES` clauses is      the same. Both clauses are optional, but `FIELDS`      must precede `LINES` if both are specified.    

​      If you specify a `FIELDS` clause, each of its      subclauses (`TERMINATED BY`,      `[OPTIONALLY] ENCLOSED BY`, and `ESCAPED      BY`) is also optional, except that you must specify at      least one of them.    

​      If you specify no `FIELDS` or      `LINES` clause, the defaults are the same as if      you had written this:    

```
FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'
LINES TERMINATED BY '\n' STARTING BY ''

```

​      (Backslash is the MySQL escape character within strings in SQL      statements, so to specify a literal backslash, you must specify      two backslashes for the value to be interpreted as a single      backslash. The escape sequences `'\t'` and      `'\n'` specify tab and newline characters,      respectively.)    

​      In other words, the defaults cause      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) to act as follows when reading input:

- ​          Look for line boundaries at newlines.        
- ​          Do not skip over any line prefix.        
- ​          Break lines into fields at tabs.        
- ​          Do not expect fields to be enclosed within any quoting          characters.        
- ​          Interpret characters preceded by the escape character          `\` as escape sequences. For example,          `\t`, `\n`, and          `\\` signify tab, newline, and backslash,          respectively. See the discussion of `FIELDS ESCAPED          BY` later for the full list of escape sequences.

​      Conversely, the defaults cause      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) to act as follows when writing output:

- ​          Write tabs between fields.        
- ​          Do not enclose fields within any quoting characters.        
- ​          Use `\` to escape instances of tab, newline,          or `\` that occur within field values.        
- ​          Write newlines at the ends of lines.

Note

​        If you have generated the text file on a Windows system, you        might have to use `LINES TERMINATED BY '\r\n'`        to read the file properly, because Windows programs typically        use two characters as a line terminator. Some programs, such as        **WordPad**, might use `\r` as a        line terminator when writing files. To read such files, use        `LINES TERMINATED BY '\r'`.

​      If all the lines you want to read in have a common prefix that you      want to ignore, you can use `LINES STARTING BY      '*prefix_string*'` to skip over      the prefix, *and anything before it*. If a line      does not include the prefix, the entire line is skipped. Suppose      that you issue the following statement:    

```
LOAD DATA INFILE '/tmp/test.txt' INTO TABLE test
  FIELDS TERMINATED BY ','  LINES STARTING BY 'xxx';

```

​      If the data file looks like this:    

```
xxx"abc",1
something xxx"def",2
"ghi",3

```

​      The resulting rows will be `("abc",1)` and      `("def",2)`. The third row in the file is skipped      because it does not contain the prefix.    

​      The `IGNORE *number*      LINES` option can be used to ignore lines at the start of      the file. For example, you can use `IGNORE 1      LINES` to skip over an initial header line containing      column names:    

```
LOAD DATA INFILE '/tmp/test.txt' INTO TABLE test IGNORE 1 LINES;

```

​      When you use [`SELECT      ... INTO OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) in tandem with      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) to write data from a database into a file and      then read the file back into the database later, the field- and      line-handling options for both statements must match. Otherwise,      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) will not interpret the contents of the file      properly. Suppose that you use      [`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) to write a file with fields delimited by commas:    

```
SELECT * INTO OUTFILE 'data.txt'
  FIELDS TERMINATED BY ','
  FROM table2;

```

​      To read the comma-delimited file back in, the correct statement      would be:    

```
LOAD DATA INFILE 'data.txt' INTO TABLE table2
  FIELDS TERMINATED BY ',';

```

​      If instead you tried to read in the file with the statement shown      following, it wouldn't work because it instructs      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) to look for tabs between fields:    

```
LOAD DATA INFILE 'data.txt' INTO TABLE table2
  FIELDS TERMINATED BY '\t';

```

​      The likely result is that each input line would be interpreted as      a single field.    

​      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) can be used to read files obtained from external      sources. For example, many programs can export data in      comma-separated values (CSV) format, such that lines have fields      separated by commas and enclosed within double quotation marks,      with an initial line of column names. If the lines in such a file      are terminated by carriage return/newline pairs, the statement      shown here illustrates the field- and line-handling options you      would use to load the file:    

```
LOAD DATA INFILE 'data.txt' INTO TABLE tbl_name
  FIELDS TERMINATED BY ',' ENCLOSED BY '"'
  LINES TERMINATED BY '\r\n'
  IGNORE 1 LINES;

```

​      If the input values are not necessarily enclosed within quotation      marks, use `OPTIONALLY` before the      `ENCLOSED BY` keywords.    

​      Any of the field- or line-handling options can specify an empty      string (`''`). If not empty, the `FIELDS      [OPTIONALLY] ENCLOSED BY` and `FIELDS ESCAPED      BY` values must be a single character. The      `FIELDS TERMINATED BY`, `LINES STARTING      BY`, and `LINES TERMINATED BY` values      can be more than one character. For example, to write lines that      are terminated by carriage return/linefeed pairs, or to read a      file containing such lines, specify a `LINES TERMINATED BY      '\r\n'` clause.    

​      To read a file containing jokes that are separated by lines      consisting of `%%`, you can do this    

```
CREATE TABLE jokes
  (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  joke TEXT NOT NULL);
LOAD DATA INFILE '/tmp/jokes.txt' INTO TABLE jokes
  FIELDS TERMINATED BY ''
  LINES TERMINATED BY '\n%%\n' (joke);

```

​      `FIELDS [OPTIONALLY] ENCLOSED BY` controls      quoting of fields. For output      ([`SELECT ... INTO      OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into)), if you omit the word      `OPTIONALLY`, all fields are enclosed by the      `ENCLOSED BY` character. An example of such      output (using a comma as the field delimiter) is shown here:    

```
"1","a string","100.20"
"2","a string containing a , comma","102.20"
"3","a string containing a \" quote","102.20"
"4","a string containing a \", quote and comma","102.20"

```

​      If you specify `OPTIONALLY`, the      `ENCLOSED BY` character is used only to enclose      values from columns that have a string data type (such as      [`CHAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#char),      [`BINARY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#binary-varbinary),      [`TEXT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob), or      [`ENUM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#enum)):    

```
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a \" quote",102.20
4,"a string containing a \", quote and comma",102.20

```

​      Occurrences of the `ENCLOSED BY` character within      a field value are escaped by prefixing them with the      `ESCAPED BY` character. Also, if you specify an      empty `ESCAPED BY` value, it is possible to      inadvertently generate output that cannot be read properly by      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data). For example, the preceding output just shown      would appear as follows if the escape character is empty. Observe      that the second field in the fourth line contains a comma      following the quote, which (erroneously) appears to terminate the      field:    

```
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a " quote",102.20
4,"a string containing a ", quote and comma",102.20

```

​      For input, the `ENCLOSED BY` character, if      present, is stripped from the ends of field values. (This is true      regardless of whether `OPTIONALLY` is specified;      `OPTIONALLY` has no effect on input      interpretation.) Occurrences of the `ENCLOSED BY`      character preceded by the `ESCAPED BY` character      are interpreted as part of the current field value.    

​      If the field begins with the `ENCLOSED BY`      character, instances of that character are recognized as      terminating a field value only if followed by the field or line      `TERMINATED BY` sequence. To avoid ambiguity,      occurrences of the `ENCLOSED BY` character within      a field value can be doubled and are interpreted as a single      instance of the character. For example, if `ENCLOSED BY      '"'` is specified, quotation marks are handled as shown      here:    

```
"The ""BIG"" boss"  -> The "BIG" boss
The "BIG" boss      -> The "BIG" boss
The ""BIG"" boss    -> The ""BIG"" boss

```

​      `FIELDS ESCAPED BY` controls how to read or write      special characters:

- ​          For input, if the `FIELDS ESCAPED BY`          character is not empty, occurrences of that character are          stripped and the following character is taken literally as          part of a field value. Some two-character sequences that are          exceptions, where the first character is the escape character.          These sequences are shown in the following table (using          `\` for the escape character). The rules for          `NULL` handling are described later in this          section.

  | Character | Escape Sequence                  |
  | --------- | -------------------------------- |
  | `\0`      | An ASCII NUL (`X'00'`) character |
  | `\b`      | A backspace character            |
  | `\n`      | A newline (linefeed) character   |
  | `\r`      | A carriage return character      |
  | `\t`      | A tab character.                 |
  | `\Z`      | ASCII 26 (Control+Z)             |
  | `\N`      | NULL                             |

  ​          For more information about `\`-escape syntax,          see [Section 9.1.1, “String Literals”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/language-structure.html#string-literals).        

  ​          If the `FIELDS ESCAPED BY` character is          empty, escape-sequence interpretation does not occur.        

- ​          For output, if the `FIELDS ESCAPED BY`          character is not empty, it is used to prefix the following          characters on output:

  - ​              The `FIELDS ESCAPED BY` character            
  - ​              The `FIELDS [OPTIONALLY] ENCLOSED BY`              character            
  - ​              The first character of the `FIELDS TERMINATED              BY` and `LINES TERMINATED BY`              values            
  - ​              ASCII `0` (what is actually written              following the escape character is ASCII              `0`, not a zero-valued byte)

  ​          If the `FIELDS ESCAPED BY` character is          empty, no characters are escaped and `NULL`          is output as `NULL`, not          `\N`. It is probably not a good idea to          specify an empty escape character, particularly if field          values in your data contain any of the characters in the list          just given.

​      In certain cases, field- and line-handling options interact:

- ​          If `LINES TERMINATED BY` is an empty string          and `FIELDS TERMINATED BY` is nonempty, lines          are also terminated with `FIELDS TERMINATED          BY`.        

- ​          If the `FIELDS TERMINATED BY` and          `FIELDS ENCLOSED BY` values are both empty          (`''`), a fixed-row (nondelimited) format is          used. With fixed-row format, no delimiters are used between          fields (but you can still have a line terminator). Instead,          column values are read and written using a field width wide          enough to hold all values in the field. For          [`TINYINT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types),          [`SMALLINT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types),          [`MEDIUMINT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types),          [`INT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types), and          [`BIGINT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#integer-types), the field widths are 4,          6, 8, 11, and 20, respectively, no matter what the declared          display width is.        

  ​          `LINES TERMINATED BY` is still used to          separate lines. If a line does not contain all fields, the          rest of the columns are set to their default values. If you do          not have a line terminator, you should set this to          `''`. In this case, the text file must          contain all fields for each row.        

  ​          Fixed-row format also affects handling of          `NULL` values, as described later.

  Note

  ​            Fixed-size format does not work if you are using a multibyte            character set.

​      Handling of `NULL` values varies according to the      `FIELDS` and `LINES` options in      use:

- ​          For the default `FIELDS` and          `LINES` values, `NULL` is          written as a field value of `\N` for output,          and a field value of `\N` is read as          `NULL` for input (assuming that the          `ESCAPED BY` character is          `\`).        
- ​          If `FIELDS ENCLOSED BY` is not empty, a field          containing the literal word `NULL` as its          value is read as a `NULL` value. This differs          from the word `NULL` enclosed within          `FIELDS ENCLOSED BY` characters, which is          read as the string `'NULL'`.        
- ​          If `FIELDS ESCAPED BY` is empty,          `NULL` is written as the word          `NULL`.        
- ​          With fixed-row format (which is used when `FIELDS          TERMINATED BY` and `FIELDS ENCLOSED          BY` are both empty), `NULL` is          written as an empty string. This causes both          `NULL` values and empty strings in the table          to be indistinguishable when written to the file because both          are written as empty strings. If you need to be able to tell          the two apart when reading the file back in, you should not          use fixed-row format.

​      An attempt to load `NULL` into a `NOT      NULL` column causes assignment of the implicit default      value for the column's data type and a warning, or an error in      strict SQL mode. Implicit default values are discussed in      [Section 11.6, “Data Type Default Values”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#data-type-defaults).    

​      Some cases are not supported by      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data):

- ​          Fixed-size rows (`FIELDS TERMINATED BY` and          `FIELDS ENCLOSED BY` both empty) and          [`BLOB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob) or          [`TEXT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob) columns.        

- ​          If you specify one separator that is the same as or a prefix          of another, [`LOAD          DATA INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) cannot interpret the input properly. For          example, the following `FIELDS` clause would          cause problems:        

  ```
  FIELDS TERMINATED BY '"' ENCLOSED BY '"'

  ```

- ​          If `FIELDS ESCAPED BY` is empty, a field          value that contains an occurrence of `FIELDS ENCLOSED          BY` or `LINES TERMINATED BY`          followed by the `FIELDS TERMINATED BY` value          causes [`LOAD DATA          INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) to stop reading a field or line too early.          This happens because          [`LOAD DATA          INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) cannot properly determine where the field or          line value ends.

​      The following example loads all columns of the      `persondata` table:    

```
LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata;

```

​      By default, when no column list is provided at the end of the      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement, input lines are expected to contain a      field for each table column. If you want to load only some of a      table's columns, specify a column list:    

```
LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata (col1,col2,...);

```

​      You must also specify a column list if the order of the fields in      the input file differs from the order of the columns in the table.      Otherwise, MySQL cannot tell how to match input fields with table      columns.    

​      The column list can contain either column names or user variables.      With user variables, the `SET` clause enables you      to perform transformations on their values before assigning the      result to columns.    

​      User variables in the `SET` clause can be used in      several ways. The following example uses the first input column      directly for the value of `t1.column1`, and      assigns the second input column to a user variable that is      subjected to a division operation before being used for the value      of `t1.column2`:    

```
LOAD DATA INFILE 'file.txt'
  INTO TABLE t1
  (column1, @var1)
  SET column2 = @var1/100;

```

​      The `SET` clause can be used to supply values not      derived from the input file. The following statement sets      `column3` to the current date and time:    

```
LOAD DATA INFILE 'file.txt'
  INTO TABLE t1
  (column1, column2)
  SET column3 = CURRENT_TIMESTAMP;

```

​      You can also discard an input value by assigning it to a user      variable and not assigning the variable to a table column:    

```
LOAD DATA INFILE 'file.txt'
  INTO TABLE t1
  (column1, @dummy, column2, @dummy, column3);

```

​      Use of the column/variable list and `SET` clause      is subject to the following restrictions:

- ​          Assignments in the `SET` clause should have          only column names on the left hand side of assignment          operators.        
- ​          You can use subqueries in the right hand side of          `SET` assignments. A subquery that returns a          value to be assigned to a column may be a scalar subquery          only. Also, you cannot use a subquery to select from the table          that is being loaded.        
- ​          Lines ignored by an `IGNORE` clause are not          processed for the column/variable list or          `SET` clause.        
- ​          User variables cannot be used when loading data with fixed-row          format because user variables do not have a display width.

​      When processing an input line, [`LOAD      DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) splits it into fields and uses the values according      to the column/variable list and the `SET` clause,      if they are present. Then the resulting row is inserted into the      table. If there are `BEFORE INSERT` or      `AFTER INSERT` triggers for the table, they are      activated before or after inserting the row, respectively.    

​      If an input line has too many fields, the extra fields are ignored      and the number of warnings is incremented.    

​      If an input line has too few fields, the table columns for which      input fields are missing are set to their default values. Default      value assignment is described in      [Section 11.6, “Data Type Default Values”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#data-type-defaults).    

​      An empty field value is interpreted different from a missing      field:

- ​          For string types, the column is set to the empty string.        
- ​          For numeric types, the column is set to `0`.        
- ​          For date and time types, the column is set to the appropriate          “zero” value for the type. See          [Section 11.3, “Date and Time Types”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#date-and-time-types).

​      These are the same values that result if you assign an empty      string explicitly to a string, numeric, or date or time type      explicitly in an [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) or      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement.    

​      Treatment of empty or incorrect field values differs from that      just described if the SQL mode is set to a restrictive value. For      example, if [`sql_mode`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_mode) is set to      [`TRADITIONAL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sqlmode_traditional), conversion of an      empty value or a value such as `'x'` for a      numeric column results in an error, not conversion to 0. (With      `LOCAL` or `IGNORE`, warnings      occur rather than errors, even with a restrictive      [`sql_mode`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_sql_mode) value, and the row is      inserted using the same closest-value behavior used for      nonrestrictive SQL modes. This occurs because the server has no      way to stop transmission of the file in the middle of the      operation.)    

​      [`TIMESTAMP`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#datetime) columns are set to the      current date and time only if there is a `NULL`      value for the column (that is, `\N`) and the      column is not declared to permit `NULL` values,      or if the [`TIMESTAMP`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#datetime) column's      default value is the current timestamp and it is omitted from the      field list when a field list is specified.    

​      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) regards all input as strings, so you cannot use      numeric values for [`ENUM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#enum) or      [`SET`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#set) columns the way you can with      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statements. All      [`ENUM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#enum) and      [`SET`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#set) values must be specified as      strings.    

​      [`BIT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#bit-type) values cannot be loaded      directly using binary notation (for example,      `b'011010'`). To work around this, use the      `SET` clause to strip off the leading      `b'` and trailing `'` and      perform a base-2 to base-10 conversion so that MySQL loads the      values into the [`BIT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#bit-type) column      properly:    

```
shell> cat /tmp/bit_test.txt
b'10'
b'1111111'
shell> mysql test
mysql> LOAD DATA INFILE '/tmp/bit_test.txt'
       INTO TABLE bit_test (@var1)
       SET b = CAST(CONV(MID(@var1, 3, LENGTH(@var1)-3), 2, 10) AS UNSIGNED);
Query OK, 2 rows affected (0.00 sec)
Records: 2  Deleted: 0  Skipped: 0  Warnings: 0

mysql> SELECT BIN(b+0) FROM bit_test;
+----------+
| BIN(b+0) |
+----------+
| 10       |
| 1111111  |
+----------+
2 rows in set (0.00 sec)

```

​      For [`BIT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#bit-type) values in      `0b` binary notation (for example,      `0b011010`), use this `SET`      clause instead to strip off the leading `0b`:    

```
SET b = CAST(CONV(MID(@var1, 3, LENGTH(@var1)-2), 2, 10) AS UNSIGNED)

```

​      On Unix, if you need [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) to      read from a pipe, you can use the following technique (the example      loads a listing of the `/` directory into the      table `db1.t1`):    

```
mkfifo /mysql/data/db1/ls.dat
chmod 666 /mysql/data/db1/ls.dat
find / -ls > /mysql/data/db1/ls.dat &
mysql -e "LOAD DATA INFILE 'ls.dat' INTO TABLE t1" db1

```

​      Here you must run the command that generates the data to be loaded      and the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) commands either on separate      terminals, or run the data generation process in the background      (as shown in the preceding example). If you do not do this, the      pipe will block until data is read by the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql)      process.    

​      When the [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement finishes, it returns an information      string in the following format:    

```
Records: 1  Deleted: 0  Skipped: 0  Warnings: 0

```

​      Warnings occur under the same circumstances as when values are      inserted using the [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert) statement      (see [Section 13.2.5, “INSERT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert)), except that      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) also generates warnings when there are too few or      too many fields in the input row.    

​      You can use [`SHOW WARNINGS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-warnings) to get a      list of the first [`max_error_count`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_error_count)      warnings as information about what went wrong. See      [Section 13.7.5.41, “SHOW WARNINGS Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-warnings).    

​      If you are using the C API, you can get information about the      statement by calling the      [`mysql_info()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info) function. See      [Section 23.8.7.35, “mysql_info()”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info).    

​      For partitioned tables using storage engines that employ table      locks, such as [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine), any locks      caused by `LOAD DATA` perform locks on all      partitions of the table. This does not apply to tables using      storage engines which employ row-level locking, such as      [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html). For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

### 13.2.7 LOAD XML Syntax

```
LOAD XML [LOW_PRIORITY | CONCURRENT] [LOCAL] INFILE 'file_name'
    [REPLACE | IGNORE]
    INTO TABLE [db_name.]tbl_name
    [CHARACTER SET charset_name]
    [ROWS IDENTIFIED BY '<tagname>']
    [IGNORE number {LINES | ROWS}]
    [(field_name_or_user_var
        [, field_name_or_user_var] ...)]
    [SET col_name={expr | DEFAULT},
        [, col_name={expr | DEFAULT}] ...]

```

​      The [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) statement reads data      from an XML file into a table. The      *file_name* must be given as a literal      string. The *tagname* in the optional      `ROWS IDENTIFIED BY` clause must also be given as      a literal string, and must be surrounded by angle brackets      (`<` and `>`).    

​      [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) acts as the complement of      running the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) client in XML output mode      (that is, starting the client with the      [`--xml`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_xml) option). To write data from a      table to an XML file, you can invoke the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql)      client with the [`--xml`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_xml) and      [`-e`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_execute) options from      the system shell, as shown here:    

```
shell> mysql --xml -e 'SELECT * FROM mydb.mytable' > file.xml

```

​      To read the file back into a table, use      [`LOAD XML      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml). By default, the `<row>`      element is considered to be the equivalent of a database table      row; this can be changed using the `ROWS IDENTIFIED      BY` clause.    

​      This statement supports three different XML formats:

- ​          Column names as attributes and column values as attribute          values:        

  ```
  <row column1="value1" column2="value2" .../>

  ```

- ​          Column names as tags and column values as the content of these          tags:        

  ```
  <row>
    <column1>value1</column1>
    <column2>value2</column2>
  </row>

  ```

- ​          Column names are the `name` attributes of          `<field>` tags, and values are the          contents of these tags:        

  ```
  <row>
    <field name='column1'>value1</field>
    <field name='column2'>value2</field>
  </row>

  ```

  ​          This is the format used by other MySQL tools, such as          [**mysqldump**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqldump).

​      All three formats can be used in the same XML file; the import      routine automatically detects the format for each row and      interprets it correctly. Tags are matched based on the tag or      attribute name and the column name.    

​      Prior to MySQL 5.5.46, `LOAD XML` did not handle      empty XML elements in the form `<element/>`      correctly. (Bug #67542, Bug #16171518)    

​      The following clauses work essentially the same way for      [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) as they do for      [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data):

- ​          `LOW_PRIORITY` or          `CONCURRENT`        
- ​          `LOCAL`        
- ​          `REPLACE` or `IGNORE`        
- ​          `CHARACTER SET`        
- ​          `SET`

​      See [Section 13.2.6, “LOAD DATA INFILE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), for more information about these      clauses.    

​      `(*field_name_or_user_var*,      ...)` is a list of one or more comma-separated XML fields      or user variables. The name of a user variable used for this      purpose must match the name of a field from the XML file, prefixed      with `@`. You can use field names to select only      desired fields. User variables can be employed to store the      corresponding field values for subsequent re-use.    

​      The `IGNORE *number*      LINES` or `IGNORE      *number* ROWS` clause causes the      first *number* rows in the XML file to be      skipped. It is analogous to the [`LOAD      DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement's `IGNORE ... LINES`      clause.    

​      Suppose that we have a table named `person`,      created as shown here:    

```
USE test;

CREATE TABLE person (
    person_id INT NOT NULL PRIMARY KEY,
    fname VARCHAR(40) NULL,
    lname VARCHAR(40) NULL,
    created TIMESTAMP
);

```

​      Suppose further that this table is initially empty.    

​      Now suppose that we have a simple XML file      `person.xml`, whose contents are as shown here:    

```
<list>
  <person person_id="1" fname="Kapek" lname="Sainnouine"/>
  <person person_id="2" fname="Sajon" lname="Rondela"/>
  <person person_id="3"><fname>Likame</fname><lname>Örrtmons</lname></person>
  <person person_id="4"><fname>Slar</fname><lname>Manlanth</lname></person>
  <person><field name="person_id">5</field><field name="fname">Stoma</field>
    <field name="lname">Milu</field></person>
  <person><field name="person_id">6</field><field name="fname">Nirtam</field>
    <field name="lname">Sklöd</field></person>
  <person person_id="7"><fname>Sungam</fname><lname>Dulbåd</lname></person>
  <person person_id="8" fname="Sraref" lname="Encmelt"/>
</list>

```

​      Each of the permissible XML formats discussed previously is      represented in this example file.    

​      To import the data in `person.xml` into the      `person` table, you can use this statement:    

```
mysql> LOAD XML LOCAL INFILE 'person.xml'
    ->   INTO TABLE person
    ->   ROWS IDENTIFIED BY '<person>';

Query OK, 8 rows affected (0.00 sec)
Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

```

​      Here, we assume that `person.xml` is located in      the MySQL data directory. If the file cannot be found, the      following error results:    

```
ERROR 2 (HY000): File '/person.xml' not found (Errcode: 2)

```

​      The `ROWS IDENTIFIED BY '<person>'` clause      means that each `<person>` element in the      XML file is considered equivalent to a row in the table into which      the data is to be imported. In this case, this is the      `person` table in the `test`      database.    

​      As can be seen by the response from the server, 8 rows were      imported into the `test.person` table. This can      be verified by a simple [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)      statement:    

```
mysql> SELECT * FROM person;
+-----------+--------+------------+---------------------+
| person_id | fname  | lname      | created             |
+-----------+--------+------------+---------------------+
|         1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
|         2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
|         3 | Likame | Örrtmons   | 2007-07-13 16:18:47 |
|         4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
|         5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
|         6 | Nirtam | Sklöd      | 2007-07-13 16:18:47 |
|         7 | Sungam | Dulbåd     | 2007-07-13 16:18:47 |
|         8 | Sreraf | Encmelt    | 2007-07-13 16:18:47 |
+-----------+--------+------------+---------------------+
8 rows in set (0.00 sec)

```

​      This shows, as stated earlier in this section, that any or all of      the 3 permitted XML formats may appear in a single file and be      read in using [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml).    

​      The inverse of the import operation just shown—that is,      dumping MySQL table data into an XML file—can be      accomplished using the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) client from the      system shell, as shown here:    

```
shell> mysql --xml -e "SELECT * FROM test.person" > person-dump.xml
shell> cat person-dump.xml
<?xml version="1.0"?>

<resultset statement="SELECT * FROM test.person" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <row>
	<field name="person_id">1</field>
	<field name="fname">Kapek</field>
	<field name="lname">Sainnouine</field>
  </row>

  <row>
	<field name="person_id">2</field>
	<field name="fname">Sajon</field>
	<field name="lname">Rondela</field>
  </row>

  <row>
	<field name="person_id">3</field>
	<field name="fname">Likema</field>
	<field name="lname">Örrtmons</field>
  </row>

  <row>
	<field name="person_id">4</field>
	<field name="fname">Slar</field>
	<field name="lname">Manlanth</field>
  </row>

  <row>
	<field name="person_id">5</field>
	<field name="fname">Stoma</field>
	<field name="lname">Nilu</field>
  </row>

  <row>
	<field name="person_id">6</field>
	<field name="fname">Nirtam</field>
	<field name="lname">Sklöd</field>
  </row>

  <row>
	<field name="person_id">7</field>
	<field name="fname">Sungam</field>
	<field name="lname">Dulbåd</field>
  </row>

  <row>
	<field name="person_id">8</field>
	<field name="fname">Sreraf</field>
	<field name="lname">Encmelt</field>
  </row>
</resultset>

```

Note

​        The [`--xml`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_xml) option causes the        [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) client to use XML formatting for its        output; the [`-e`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_execute)        option causes the client to execute the SQL statement        immediately following the option. See [Section 4.5.1, “**mysql** — The MySQL Command-Line Tool”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql).

​      You can verify that the dump is valid by creating a copy of the      `person` table and importing the dump file into      the new table, like this:    

```
mysql> USE test;
mysql> CREATE TABLE person2 LIKE person;
Query OK, 0 rows affected (0.00 sec)

mysql> LOAD XML LOCAL INFILE 'person-dump.xml'
    ->   INTO TABLE person2;
Query OK, 8 rows affected (0.01 sec)
Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

mysql> SELECT * FROM person2;
+-----------+--------+------------+---------------------+
| person_id | fname  | lname      | created             |
+-----------+--------+------------+---------------------+
|         1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
|         2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
|         3 | Likema | Örrtmons   | 2007-07-13 16:18:47 |
|         4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
|         5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
|         6 | Nirtam | Sklöd      | 2007-07-13 16:18:47 |
|         7 | Sungam | Dulbåd     | 2007-07-13 16:18:47 |
|         8 | Sreraf | Encmelt    | 2007-07-13 16:18:47 |
+-----------+--------+------------+---------------------+
8 rows in set (0.00 sec)

```

​      There is no requirement that every field in the XML file be      matched with a column in the corresponding table. Fields which      have no corresponding columns are skipped. You can see this by      first emptying the `person2` table and dropping      the `created` column, then using the same      `LOAD XML` statement we just employed previously,      like this:    

```
mysql> TRUNCATE person2;
Query OK, 8 rows affected (0.26 sec)

mysql> ALTER TABLE person2 DROP COLUMN created;
Query OK, 0 rows affected (0.52 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql> SHOW CREATE TABLE person2\G
*************************** 1. row ***************************
       Table: person2
Create Table: CREATE TABLE `person2` (
  `person_id` int(11) NOT NULL,
  `fname` varchar(40) DEFAULT NULL,
  `lname` varchar(40) DEFAULT NULL,
  PRIMARY KEY (`person_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
1 row in set (0.00 sec)

mysql> LOAD XML LOCAL INFILE 'person-dump.xml'
    ->   INTO TABLE person2;
Query OK, 8 rows affected (0.01 sec)
Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

mysql> SELECT * FROM person2;
+-----------+--------+------------+
| person_id | fname  | lname      |
+-----------+--------+------------+
|         1 | Kapek  | Sainnouine |
|         2 | Sajon  | Rondela    |
|         3 | Likema | Örrtmons   |
|         4 | Slar   | Manlanth   |
|         5 | Stoma  | Nilu       |
|         6 | Nirtam | Sklöd      |
|         7 | Sungam | Dulbåd     |
|         8 | Sreraf | Encmelt    |
+-----------+--------+------------+
8 rows in set (0.00 sec)

```

​      The order in which the fields are given within each row of the XML      file does not affect the operation of `LOAD XML`;      the field order can vary from row to row, and is not required to      be in the same order as the corresponding columns in the table.    

​      As mentioned previously, you can use a      `(*field_name_or_user_var*,      ...)` list of one or more XML fields (to select desired      fields only) or user variables (to store the corresponding field      values for later use). User variables can be especially useful      when you want to insert data from an XML file into table columns      whose names do not match those of the XML fields. To see how this      works, we first create a table named `individual`      whose structure matches that of the `person`      table, but whose columns are named differently:    

```
mysql> CREATE TABLE individual (
    ->     individual_id INT NOT NULL PRIMARY KEY,
    ->     name1 VARCHAR(40) NULL,
    ->     name2 VARCHAR(40) NULL,
    ->     made TIMESTAMP
    -> );
Query OK, 0 rows affected (0.42 sec)

```

​      In this case, you cannot simply load the XML file directly into      the table, because the field and column names do not match:    

```
mysql> LOAD XML INFILE '../bin/person-dump.xml' INTO TABLE test.individual;
ERROR 1263 (22004): Column set to default value; NULL supplied to NOT NULL column 'individual_id' at row 1

```

​      This happens because the MySQL server looks for field names      matching the column names of the target table. You can work around      this problem by selecting the field values into user variables,      then setting the target table's columns equal to the values      of those variables using `SET`. You can perform      both of these operations in a single statement, as shown here:    

```
mysql> LOAD XML INFILE '../bin/person-dump.xml'
    ->     INTO TABLE test.individual (@person_id, @fname, @lname, @created)
    ->     SET individual_id=@person_id, name1=@fname, name2=@lname, made=@created;
Query OK, 8 rows affected (0.05 sec)
Records: 8  Deleted: 0  Skipped: 0  Warnings: 0

mysql> SELECT * FROM individual;
+---------------+--------+------------+---------------------+
| individual_id | name1  | name2      | made                |
+---------------+--------+------------+---------------------+
|             1 | Kapek  | Sainnouine | 2007-07-13 16:18:47 |
|             2 | Sajon  | Rondela    | 2007-07-13 16:18:47 |
|             3 | Likema | Örrtmons   | 2007-07-13 16:18:47 |
|             4 | Slar   | Manlanth   | 2007-07-13 16:18:47 |
|             5 | Stoma  | Nilu       | 2007-07-13 16:18:47 |
|             6 | Nirtam | Sklöd      | 2007-07-13 16:18:47 |
|             7 | Sungam | Dulbåd     | 2007-07-13 16:18:47 |
|             8 | Srraf  | Encmelt    | 2007-07-13 16:18:47 |
+---------------+--------+------------+---------------------+
8 rows in set (0.00 sec)

```

​      The names of the user variables *must* match      those of the corresponding fields from the XML file, with the      addition of the required `@` prefix to indicate      that they are variables. The user variables need not be listed or      assigned in the same order as the corresponding fields.    

​      Using a `ROWS IDENTIFIED BY      '<*tagname*>'` clause, it      is possible to import data from the same XML file into database      tables with different definitions. For this example, suppose that      you have a file named `address.xml` which      contains the following XML:    

```
<?xml version="1.0"?>

<list>
  <person person_id="1">
    <fname>Robert</fname>
    <lname>Jones</lname>
    <address address_id="1" street="Mill Creek Road" zip="45365" city="Sidney"/>
    <address address_id="2" street="Main Street" zip="28681" city="Taylorsville"/>
  </person>

  <person person_id="2">
    <fname>Mary</fname>
    <lname>Smith</lname>
    <address address_id="3" street="River Road" zip="80239" city="Denver"/>
    <!-- <address address_id="4" street="North Street" zip="37920" city="Knoxville"/> -->
  </person>

</list>

```

​      You can again use the `test.person` table as      defined previously in this section, after clearing all the      existing records from the table and then showing its structure as      shown here:    

```
mysql< TRUNCATE person;
Query OK, 0 rows affected (0.04 sec)

mysql< SHOW CREATE TABLE person\G
*************************** 1. row ***************************
       Table: person
Create Table: CREATE TABLE `person` (
  `person_id` int(11) NOT NULL,
  `fname` varchar(40) DEFAULT NULL,
  `lname` varchar(40) DEFAULT NULL,
  `created` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`person_id`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
1 row in set (0.00 sec)

```

​      Now create an `address` table in the      `test` database using the following      [`CREATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-table) statement:    

```
CREATE TABLE address (
    address_id INT NOT NULL PRIMARY KEY,
    person_id INT NULL,
    street VARCHAR(40) NULL,
    zip INT NULL,
    city VARCHAR(40) NULL,
    created TIMESTAMP
);

```

​      To import the data from the XML file into the      `person` table, execute the following      [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) statement, which specifies      that rows are to be specified by the      `<person>` element, as shown here;    

```
mysql> LOAD XML LOCAL INFILE 'address.xml'
    ->   INTO TABLE person
    ->   ROWS IDENTIFIED BY '<person>';
Query OK, 2 rows affected (0.00 sec)
Records: 2  Deleted: 0  Skipped: 0  Warnings: 0

```

​      You can verify that the records were imported using a      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement:    

```
mysql> SELECT * FROM person;
+-----------+--------+-------+---------------------+
| person_id | fname  | lname | created             |
+-----------+--------+-------+---------------------+
|         1 | Robert | Jones | 2007-07-24 17:37:06 |
|         2 | Mary   | Smith | 2007-07-24 17:37:06 |
+-----------+--------+-------+---------------------+
2 rows in set (0.00 sec)

```

​      Since the `<address>` elements in the XML      file have no corresponding columns in the      `person` table, they are skipped.    

​      To import the data from the `<address>`      elements into the `address` table, use the      [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) statement shown here:    

```
mysql> LOAD XML LOCAL INFILE 'address.xml'
    ->   INTO TABLE address
    ->   ROWS IDENTIFIED BY '<address>';
Query OK, 3 rows affected (0.00 sec)
Records: 3  Deleted: 0  Skipped: 0  Warnings: 0

```

​      You can see that the data was imported using a      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement such as this one:    

```
mysql> SELECT * FROM address;
+------------+-----------+-----------------+-------+--------------+---------------------+
| address_id | person_id | street          | zip   | city         | created             |
+------------+-----------+-----------------+-------+--------------+---------------------+
|          1 |         1 | Mill Creek Road | 45365 | Sidney       | 2007-07-24 17:37:37 |
|          2 |         1 | Main Street     | 28681 | Taylorsville | 2007-07-24 17:37:37 |
|          3 |         2 | River Road      | 80239 | Denver       | 2007-07-24 17:37:37 |
+------------+-----------+-----------------+-------+--------------+---------------------+
3 rows in set (0.00 sec)

```

​      The data from the `<address>` element that      is enclosed in XML comments is not imported. However, since there      is a `person_id` column in the      `address` table, the value of the      `person_id` attribute from the parent      `<person>` element for each      `<address>` *is*      imported into the `address` table.    

**Security Considerations. **        As with the [`LOAD DATA`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement,        the transfer of the XML file from the client host to the server        host is initiated by the MySQL server. In theory, a patched        server could be built that would tell the client program to        transfer a file of the server's choosing rather than the file        named by the client in the [`LOAD        XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) statement. Such a server could access any file on        the client host to which the client user has read access.      

​      In a Web environment, clients usually connect to MySQL from a Web      server. A user that can run any command against the MySQL server      can use [`LOAD XML      LOCAL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) to read any files to which the Web server process      has read access. In this environment, the client with respect to      the MySQL server is actually the Web server, not the remote      program being run by the user who connects to the Web server.    

​      You can disable loading of XML files from clients by starting the      server with [`--local-infile=0`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_local_infile) or      [`--local-infile=OFF`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_local_infile). This option      can also be used when starting the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) client      to disable [`LOAD XML`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) for the      duration of the client session.    

​      To prevent a client from loading XML files from the server, do not      grant the [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file) privilege to the      corresponding MySQL user account, or revoke this privilege if the      client user account already has it.

Important

​        Revoking the [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file) privilege (or        not granting it in the first place) keeps the user only from        executing the [`LOAD XML        INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml) statement (as well as the        [`LOAD_FILE()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_load-file) function; it does        *not* prevent the user from executing        [`LOAD XML LOCAL        INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-xml). To disallow this statement, you must start the        server or the client with `--local-infile=OFF`.      

​        In other words, the [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file)        privilege affects only whether the client can read files on the        server; it has no bearing on whether the client can read files        on the local file system.

​      For partitioned tables using storage engines that employ table      locks, such as [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine), any locks      caused by `LOAD XML` perform locks on all      partitions of the table. This does not apply to tables using      storage engines which employ row-level locking, such as      [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html). For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

### 13.2.8 REPLACE Syntax

```
REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] tbl_name
    [(col_name [, col_name] ...)]
    {VALUES | VALUE} (value_list) [, (value_list)] ...

REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] tbl_name
    SET assignment_list

REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] tbl_name
    [(col_name [, col_name] ...)]
    SELECT ...

value:
    {expr | DEFAULT}

value_list:
    value [, value] ...

assignment:
    col_name = value

assignment_list:
    assignment [, assignment] ...

```

​      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) works exactly like      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert), except that if an old row      in the table has the same value as a new row for a      `PRIMARY KEY` or a `UNIQUE`      index, the old row is deleted before the new row is inserted. See      [Section 13.2.5, “INSERT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert).    

​      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) is a MySQL extension to the      SQL standard. It either inserts, or *deletes*      and inserts. For another MySQL extension to standard      SQL—that either inserts or      *updates*—see      [Section 13.2.5.2, “INSERT ... ON DUPLICATE KEY UPDATE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert-on-duplicate).

Note

​        [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) makes sense only if a        table has a `PRIMARY KEY` or        `UNIQUE` index. Otherwise, it becomes        equivalent to [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert), because        there is no index to be used to determine whether a new row        duplicates another.

​      Values for all columns are taken from the values specified in the      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) statement. Any missing      columns are set to their default values, just as happens for      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert). You cannot refer to values      from the current row and use them in the new row. If you use an      assignment such as `SET      *col_name* =      *col_name* + 1`, the reference      to the column name on the right hand side is treated as      [`DEFAULT(*col_name*)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_default),      so the assignment is equivalent to `SET      *col_name* =      DEFAULT(*col_name*) + 1`.    

​      To use [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace), you must have both      the [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_insert) and      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_delete) privileges for the table.    

​      The [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) statement returns a      count to indicate the number of rows affected. This is the sum of      the rows deleted and inserted. If the count is 1 for a single-row      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace), a row was inserted and no      rows were deleted. If the count is greater than 1, one or more old      rows were deleted before the new row was inserted. It is possible      for a single row to replace more than one old row if the table      contains multiple unique indexes and the new row duplicates values      for different old rows in different unique indexes.    

​      The affected-rows count makes it easy to determine whether      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) only added a row or whether      it also replaced any rows: Check whether the count is 1 (added) or      greater (replaced).    

​      If you are using the C API, the affected-rows count can be      obtained using the      [`mysql_affected_rows()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-affected-rows) function.    

​      You cannot replace into a table and select from the same table in      a subquery.    

​      MySQL uses the following algorithm for      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace) (and `LOAD DATA ...      REPLACE`):

1. ​          Try to insert the new row into the table        
2. ​          While the insertion fails because a duplicate-key error occurs          for a primary key or unique index:
   1. ​              Delete from the table the conflicting row that has the              duplicate key value            
   2. ​              Try again to insert the new row into the table

​      It is possible that in the case of a duplicate-key error, a      storage engine may perform the `REPLACE` as an      update rather than a delete plus insert, but the semantics are the      same. There are no user-visible effects other than a possible      difference in how the storage engine increments      `Handler_*xxx*` status      variables.    

​      Because the results of `REPLACE ... SELECT`      statements depend on the ordering of rows from the      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) and this order cannot always      be guaranteed, it is possible when logging these statements for      the master and the slave to diverge. For this reason, in MySQL      5.5.18 and later, `REPLACE ... SELECT` statements      are flagged as unsafe for statement-based replication. With this      change, such statements produce a warning in the error log when      using statement-based mode, and are written to the binary log      using the row-based format when using `MIXED`      mode. See also [Section 17.1.2.1, “Advantages and Disadvantages of Statement-Based and Row-Based        Replication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-sbr-rbr).    

​      When modifying an existing table that is not partitioned to      accommodate partitioning, or, when modifying the partitioning of      an already partitioned table, you may consider altering the      table's primary key (see      [Section 19.5.1, “Partitioning Keys, Primary Keys, and Unique Keys”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-partitioning-keys-unique-keys)).      You should be aware that, if you do this, the results of      `REPLACE` statements may be affected, just as      they would be if you modified the primary key of a nonpartitioned      table. Consider the table created by the following      [`CREATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-table) statement:    

```
CREATE TABLE test (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  data VARCHAR(64) DEFAULT NULL,
  ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id)
);

```

​      When we create this table and run the statements shown in the      mysql client, the result is as follows:    

```
mysql> REPLACE INTO test VALUES (1, 'Old', '2014-08-20 18:47:00');
Query OK, 1 row affected (0.04 sec)

mysql> REPLACE INTO test VALUES (1, 'New', '2014-08-20 18:47:42');
Query OK, 2 rows affected (0.04 sec)

mysql> SELECT * FROM test;
+----+------+---------------------+
| id | data | ts                  |
+----+------+---------------------+
|  1 | New  | 2014-08-20 18:47:42 |
+----+------+---------------------+
1 row in set (0.00 sec)

```

​      Now we create a second table almost identical to the first, except      that the primary key now covers 2 columns, as shown here      (emphasized text):    

```
CREATE TABLE test2 (
  id INT UNSIGNED NOT NULL AUTO_INCREMENT,
  data VARCHAR(64) DEFAULT NULL,
  ts TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id, ts)
);

```

​      When we run on `test2` the same two      `REPLACE` statements as we did on the original      `test` table, we obtain a different result:    

```
mysql> REPLACE INTO test2 VALUES (1, 'Old', '2014-08-20 18:47:00');
Query OK, 1 row affected (0.05 sec)

mysql> REPLACE INTO test2 VALUES (1, 'New', '2014-08-20 18:47:42');
Query OK, 1 row affected (0.06 sec)

mysql> SELECT * FROM test2;
+----+------+---------------------+
| id | data | ts                  |
+----+------+---------------------+
|  1 | Old  | 2014-08-20 18:47:00 |
|  1 | New  | 2014-08-20 18:47:42 |
+----+------+---------------------+
2 rows in set (0.00 sec)

```

​      This is due to the fact that, when run on      `test2`, both the `id` and      `ts` column values must match those of an      existing row for the row to be replaced; otherwise, a row is      inserted.    

​      A `REPLACE` statement affecting a partitioned      table using a storage engine such as      [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that employs table-level locks      locks all partitions of the table. This does not occur with tables      using storage engines such as [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html)      that employ row-level locking. This issue is resolved in MySQL      5.6. For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

### 13.2.9 SELECT Syntax

- [13.2.9.1 SELECT ... INTO Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into)
- [13.2.9.2 JOIN Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join)
- [13.2.9.3 UNION Syntax](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union)

```
SELECT
    [ALL | DISTINCT | DISTINCTROW ]
      [HIGH_PRIORITY]
      [STRAIGHT_JOIN]
      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]
    select_expr [, select_expr ...]
    [FROM table_references
    [WHERE where_condition]
    [GROUP BY {col_name | expr | position}
      [ASC | DESC], ... [WITH ROLLUP]]
    [HAVING where_condition]
    [ORDER BY {col_name | expr | position}
      [ASC | DESC], ...]
    [LIMIT {[offset,] row_count | row_count OFFSET offset}]
    [PROCEDURE procedure_name(argument_list)]
    [INTO OUTFILE 'file_name'
        [CHARACTER SET charset_name]
        export_options
      | INTO DUMPFILE 'file_name'
      | INTO var_name [, var_name]]
    [FOR UPDATE | LOCK IN SHARE MODE]]

```

​      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) is used to retrieve rows      selected from one or more tables, and can include      [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) statements and subqueries.      See [Section 13.2.9.3, “UNION Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union), and [Section 13.2.10, “Subquery Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#subqueries).    

​      The most commonly used clauses of      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements are these:

- ​          Each *select_expr* indicates a column          that you want to retrieve. There must be at least one          *select_expr*.        

- ​          *table_references* indicates the          table or tables from which to retrieve rows. Its syntax is          described in [Section 13.2.9.2, “JOIN Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join).        

- ​          The `WHERE` clause, if given, indicates the          condition or conditions that rows must satisfy to be selected.          *where_condition* is an expression          that evaluates to true for each row to be selected. The          statement selects all rows if there is no          `WHERE` clause.        

  ​          In the `WHERE` expression, you can use any of          the functions and operators that MySQL supports, except for          aggregate (summary) functions. See          [Section 9.5, “Expression Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/language-structure.html#expressions), and          [Chapter 12, *Functions and Operators*](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html).

​      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) can also be used to retrieve      rows computed without reference to any table.    

​      For example:    

```
mysql> SELECT 1 + 1;
        -> 2

```

​            You are permitted to specify `DUAL` as a dummy      table name in situations where no tables are referenced:    

```
mysql> SELECT 1 + 1 FROM DUAL;
        -> 2

```

​      `DUAL` is purely for the convenience of people      who require that all [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)      statements should have `FROM` and possibly other      clauses. MySQL may ignore the clauses. MySQL does not require      `FROM DUAL` if no tables are referenced.    

​      In general, clauses used must be given in exactly the order shown      in the syntax description. For example, a      `HAVING` clause must come after any      `GROUP BY` clause and before any `ORDER      BY` clause. The exception is that the      `INTO` clause can appear either as shown in the      syntax description or immediately following the      *select_expr* list. For more information      about `INTO`, see [Section 13.2.9.1, “SELECT ... INTO Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into).    

​      The list of *select_expr* terms comprises      the select list that indicates which columns to retrieve. Terms      specify a column or expression or can use      `*`-shorthand:

- ​          A select list consisting only of a single unqualified          `*` can be used as shorthand to select all          columns from all tables:        

  ```
  SELECT * FROM t1 INNER JOIN t2 ...

  ```

- ​          `*tbl_name*.*` can          be used as a qualified shorthand to select all columns from          the named table:        

  ```
  SELECT t1.*, t2.* FROM t1 INNER JOIN t2 ...

  ```

- ​          Use of an unqualified `*` with other items in          the select list may produce a parse error. To avoid this          problem, use a qualified          `*tbl_name*.*`          reference        

  ```
  SELECT AVG(score), t1.* FROM t1 ...

  ```

​      The following list provides additional information about other      `SELECT` clauses:

- ​                              A *select_expr* can be given an alias          using `AS          *alias_name*`. The alias is          used as the expression's column name and can be used in          `GROUP BY`, `ORDER BY`, or          `HAVING` clauses. For example:        

  ```
  SELECT CONCAT(last_name,', ',first_name) AS full_name
    FROM mytable ORDER BY full_name;

  ```

  ​          The `AS` keyword is optional when aliasing a          *select_expr* with an identifier. The          preceding example could have been written like this:        

  ```
  SELECT CONCAT(last_name,', ',first_name) full_name
    FROM mytable ORDER BY full_name;

  ```

  ​          However, because the `AS` is optional, a          subtle problem can occur if you forget the comma between two          *select_expr* expressions: MySQL          interprets the second as an alias name. For example, in the          following statement, `columnb` is treated as          an alias name:        

  ```
  SELECT columna columnb FROM mytable;

  ```

  ​          For this reason, it is good practice to be in the habit of          using `AS` explicitly when specifying column          aliases.        

  ​          It is not permissible to refer to a column alias in a          `WHERE` clause, because the column value          might not yet be determined when the `WHERE`          clause is executed. See [Section B.5.4.4, “Problems with Column Aliases”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/error-handling.html#problems-with-alias).        

- ​                              The `FROM          *table_references*` clause          indicates the table or tables from which to retrieve rows. If          you name more than one table, you are performing a join. For          information on join syntax, see [Section 13.2.9.2, “JOIN Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join). For          each table specified, you can optionally specify an alias.        

  ```
  tbl_name [[AS] alias] [index_hint]

  ```

  ​

  ​

  ​          The use of index hints provides the optimizer with information          about how to choose indexes during query processing. For a          description of the syntax for specifying these hints, see          [Section 8.9.3, “Index Hints”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#index-hints).        

  ​          You can use `SET          max_seeks_for_key=*value*`          as an alternative way to force MySQL to prefer key scans          instead of table scans. See          [Section 5.1.5, “Server System Variables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#server-system-variables).        

- ​          You can refer to a table within the default database as          *tbl_name*, or as          *db_name*.*tbl_name*          to specify a database explicitly. You can refer to a column as          *col_name*,          *tbl_name*.*col_name*,          or          *db_name*.*tbl_name*.*col_name*.          You need not specify a *tbl_name* or          *db_name*.*tbl_name*          prefix for a column reference unless the reference would be          ambiguous. See [Section 9.2.1, “Identifier Qualifiers”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/language-structure.html#identifier-qualifiers), for          examples of ambiguity that require the more explicit column          reference forms.        

- ​                              A table reference can be aliased using          `*tbl_name* AS          *alias_name*` or          *tbl_name alias_name*:        

  ```
  SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
    WHERE t1.name = t2.name;

  SELECT t1.name, t2.salary FROM employee t1, info t2
    WHERE t1.name = t2.name;

  ```

- ​                    Columns selected for output can be referred to in          `ORDER BY` and `GROUP BY`          clauses using column names, column aliases, or column          positions. Column positions are integers and begin with 1:        

  ```
  SELECT college, region, seed FROM tournament
    ORDER BY region, seed;

  SELECT college, region AS r, seed AS s FROM tournament
    ORDER BY r, s;

  SELECT college, region, seed FROM tournament
    ORDER BY 2, 3;

  ```

  ​          To sort in reverse order, add the `DESC`          (descending) keyword to the name of the column in the          `ORDER BY` clause that you are sorting by.          The default is ascending order; this can be specified          explicitly using the `ASC` keyword.        

  ​          If `ORDER BY` occurs within a subquery and          also is applied in the outer query, the outermost          `ORDER BY` takes precedence. For example,          results for the following statement are sorted in descending          order, not ascending order:        

  ```
  (SELECT ... ORDER BY a) ORDER BY a DESC;

  ```

  ​          Use of column positions is deprecated because the syntax has          been removed from the SQL standard.        

- ​                              If you use `GROUP BY`, output rows are sorted          according to the `GROUP BY` columns as if you          had an `ORDER BY` for the same columns. To          avoid the overhead of sorting that `GROUP BY`          produces, add `ORDER BY NULL`:        

  ```
  SELECT a, COUNT(b) FROM test_table GROUP BY a ORDER BY NULL;

  ```

  ​          Relying on implicit `GROUP BY` sorting (that          is, sorting in the absence of `ASC` or          `DESC` designators) is deprecated. To produce          a given sort order, use explicit `ASC` or          `DESC` designators for `GROUP          BY` columns or provide an `ORDER BY`          clause.        

- ​                              When you use `ORDER BY` or `GROUP          BY` to sort a column in a          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select), the server sorts values          using only the initial number of bytes indicated by the          [`max_sort_length`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_sort_length) system          variable.        

- ​                    MySQL extends the `GROUP BY` clause so that          you can also specify `ASC` and          `DESC` after columns named in the clause:        

  ```
  SELECT a, COUNT(b) FROM test_table GROUP BY a DESC;

  ```

- ​          MySQL extends the use of `GROUP BY` to permit          selecting fields that are not mentioned in the `GROUP          BY` clause. If you are not getting the results that          you expect from your query, please read the description of          `GROUP BY` found in          [Section 12.16, “Aggregate (GROUP BY) Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#group-by-functions-and-modifiers).        

- ​          `GROUP BY` permits a `WITH          ROLLUP` modifier. See          [Section 12.16.2, “GROUP BY Modifiers”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#group-by-modifiers).        

- ​                    The `HAVING` clause is applied nearly last,          just before items are sent to the client, with no          optimization. (`LIMIT` is applied after          `HAVING`.)        

  ​          The SQL standard requires that `HAVING` must          reference only columns in the `GROUP BY`          clause or columns used in aggregate functions. However, MySQL          supports an extension to this behavior, and permits          `HAVING` to refer to columns in the          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) list and columns in          outer subqueries as well.        

  ​          If the `HAVING` clause refers to a column          that is ambiguous, a warning occurs. In the following          statement, `col2` is ambiguous because it is          used as both an alias and a column name:        

  ```
  SELECT COUNT(col1) AS col2 FROM t GROUP BY col2 HAVING col2 = 2;

  ```

  ​          Preference is given to standard SQL behavior, so if a          `HAVING` column name is used both in          `GROUP BY` and as an aliased column in the          output column list, preference is given to the column in the          `GROUP BY` column.        

- ​          Do not use `HAVING` for items that should be          in the `WHERE` clause. For example, do not          write the following:        

  ```
  SELECT col_name FROM tbl_name HAVING col_name > 0;

  ```

  ​          Write this instead:        

  ```
  SELECT col_name FROM tbl_name WHERE col_name > 0;

  ```

- ​          The `HAVING` clause can refer to aggregate          functions, which the `WHERE` clause cannot:        

  ```
  SELECT user, MAX(salary) FROM users
    GROUP BY user HAVING MAX(salary) > 10;

  ```

  ​          (This did not work in some older versions of MySQL.)        

- ​          MySQL permits duplicate column names. That is, there can be          more than one *select_expr* with the          same name. This is an extension to standard SQL. Because MySQL          also permits `GROUP BY` and          `HAVING` to refer to          *select_expr* values, this can result          in an ambiguity:        

  ```
  SELECT 12 AS a, a FROM t GROUP BY a;

  ```

  ​          In that statement, both columns have the name          `a`. To ensure that the correct column is          used for grouping, use different names for each          *select_expr*.        

- ​          MySQL resolves unqualified column or alias references in          `ORDER BY` clauses by searching in the          *select_expr* values, then in the          columns of the tables in the `FROM` clause.          For `GROUP BY` or `HAVING`          clauses, it searches the `FROM` clause before          searching in the *select_expr*          values. (For `GROUP BY` and          `HAVING`, this differs from the pre-MySQL 5.0          behavior that used the same rules as for `ORDER          BY`.)        

- ​                    The `LIMIT` clause can be used to constrain          the number of rows returned by the          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement.          `LIMIT` takes one or two numeric arguments,          which must both be nonnegative integer constants, with these          exceptions:

  - ​              Within prepared statements, `LIMIT`              parameters can be specified using `?`              placeholder markers.            
  - ​              Within stored programs, `LIMIT`              parameters can be specified using integer-valued routine              parameters or local variables as of MySQL 5.5.6.

  ​          With two arguments, the first argument specifies the offset of          the first row to return, and the second specifies the maximum          number of rows to return. The offset of the initial row is 0          (not 1):        

  ```
  SELECT * FROM tbl LIMIT 5,10;  # Retrieve rows 6-15

  ```

  ​          To retrieve all rows from a certain offset up to the end of          the result set, you can use some large number for the second          parameter. This statement retrieves all rows from the 96th row          to the last:        

  ```
  SELECT * FROM tbl LIMIT 95,18446744073709551615;

  ```

  ​          With one argument, the value specifies the number of rows to          return from the beginning of the result set:        

  ```
  SELECT * FROM tbl LIMIT 5;     # Retrieve first 5 rows

  ```

  ​          In other words, `LIMIT          *row_count*` is equivalent          to `LIMIT 0,          *row_count*`.        

  ​          For prepared statements, you can use placeholders. The          following statements will return one row from the          `tbl` table:        

  ```
  SET @a=1;
  PREPARE STMT FROM 'SELECT * FROM tbl LIMIT ?';
  EXECUTE STMT USING @a;

  ```

  ​          The following statements will return the second to sixth row          from the `tbl` table:        

  ```
  SET @skip=1; SET @numrows=5;
  PREPARE STMT FROM 'SELECT * FROM tbl LIMIT ?, ?';
  EXECUTE STMT USING @skip, @numrows;

  ```

  ​          For compatibility with PostgreSQL, MySQL also supports the          `LIMIT *row_count* OFFSET          *offset*` syntax.        

  ​          If `LIMIT` occurs within a subquery and also          is applied in the outer query, the outermost          `LIMIT` takes precedence. For example, the          following statement produces two rows, not one:        

  ```
  (SELECT ... LIMIT 1) LIMIT 2;

  ```

- ​                    A `PROCEDURE` clause names a procedure that          should process the data in the result set. For an example, see          [Section 8.4.2.4, “Using PROCEDURE ANALYSE”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#procedure-analyse), which describes          `ANALYSE`, a procedure that can be used to          obtain suggestions for optimal column data types that may help          reduce table sizes.        

  ​          A `PROCEDURE` clause is not permitted in a          [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) statement.        

- ​          The [`SELECT ...          INTO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) form of [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)          enables the query result to be written to a file or stored in          variables. For more information, see          [Section 13.2.9.1, “SELECT ... INTO Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into).        

- ​                              If you use `FOR UPDATE` with a storage engine          that uses page or row locks, rows examined by the query are          write-locked until the end of the current transaction. Using          `LOCK IN SHARE MODE` sets a shared lock that          permits other transactions to read the examined rows but not          to update or delete them. See          [Section 14.8.2.4, “Locking Reads”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html#innodb-locking-reads).

​      Following the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) keyword, you      can use a number of modifiers that affect the operation of the      statement. `HIGH_PRIORITY`,      `STRAIGHT_JOIN`, and modifiers beginning with      `SQL_` are MySQL extensions to standard SQL.

- ​          The `ALL` and `DISTINCT`          modifiers specify whether duplicate rows should be returned.          `ALL` (the default) specifies that all          matching rows should be returned, including duplicates.          `DISTINCT` specifies removal of duplicate          rows from the result set. It is an error to specify both          modifiers. `DISTINCTROW` is a synonym for          `DISTINCT`.        

  ​

  ​

  ​

- ​          `HIGH_PRIORITY` gives the          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) higher priority than a          statement that updates a table. You should use this only for          queries that are very fast and must be done at once. A          `SELECT HIGH_PRIORITY` query that is issued          while the table is locked for reading runs even if there is an          update statement waiting for the table to be free. This          affects only storage engines that use only table-level locking          (such as `MyISAM`, `MEMORY`,          and `MERGE`).        

  ​

  ​          `HIGH_PRIORITY` cannot be used with          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements that are part          of a [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union).        

- ​          `STRAIGHT_JOIN` forces the optimizer to join          the tables in the order in which they are listed in the          `FROM` clause. You can use this to speed up a          query if the optimizer joins the tables in nonoptimal order.          `STRAIGHT_JOIN` also can be used in the          *table_references* list. See          [Section 13.2.9.2, “JOIN Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join).        

  ​

  ​

  ​

  ​          `STRAIGHT_JOIN` does not apply to any table          that the optimizer treats as a          [`const`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_const) or          [`system`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_system) table. Such a table          produces a single row, is read during the optimization phase          of query execution, and references to its columns are replaced          with the appropriate column values before query execution          proceeds. These tables will appear first in the query plan          displayed by [`EXPLAIN`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain). See          [Section 8.8.1, “Optimizing Queries with EXPLAIN”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#using-explain). This exception may not apply          to [`const`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_const) or          [`system`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_system) tables that are used          on the `NULL`-complemented side of an outer          join (that is, the right-side table of a `LEFT          JOIN` or the left-side table of a `RIGHT          JOIN`.        

- ​          `SQL_BIG_RESULT` or          `SQL_SMALL_RESULT` can be used with          `GROUP BY` or `DISTINCT` to          tell the optimizer that the result set has many rows or is          small, respectively. For `SQL_BIG_RESULT`,          MySQL directly uses disk-based temporary tables if needed, and          prefers sorting to using a temporary table with a key on the          `GROUP BY` elements. For          `SQL_SMALL_RESULT`, MySQL uses fast temporary          tables to store the resulting table instead of using sorting.          This should not normally be needed.        

  ​

  ​

- ​          `SQL_BUFFER_RESULT` forces the result to be          put into a temporary table. This helps MySQL free the table          locks early and helps in cases where it takes a long time to          send the result set to the client. This modifier can be used          only for top-level [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)          statements, not for subqueries or following          [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union).        

  ​

- ​          `SQL_CALC_FOUND_ROWS` tells MySQL to          calculate how many rows there would be in the result set,          disregarding any `LIMIT` clause. The number          of rows can then be retrieved with `SELECT          FOUND_ROWS()`. See          [Section 12.14, “Information Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#information-functions).        

  ​

- ​          The `SQL_CACHE` and          `SQL_NO_CACHE` modifiers affect caching of          query results in the query cache (see          [Section 8.10.3, “The MySQL Query Cache”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#query-cache)). `SQL_CACHE`          tells MySQL to store the result in the query cache if it is          cacheable and the value of the          [`query_cache_type`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_query_cache_type) system          variable is `2` or `DEMAND`.          With `SQL_NO_CACHE`, the server does not use          the query cache. It neither checks the query cache to see          whether the result is already cached, nor does it cache the          query result. (Due to a limitation in the parser, a space          character must precede and follow the          `SQL_NO_CACHE` keyword; a nonspace such as a          newline causes the server to check the query cache to see          whether the result is already cached.)        

  ​

  ​

  ​          For views, `SQL_NO_CACHE` applies if it          appears in any [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) in the          query. For a cacheable query, `SQL_CACHE`          applies if it appears in the first          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) of a view referred to by          the query.        

  ​          As of MySQL 5.5.3, these two modifiers are mutually exclusive          and an error occurs if they are both specified. Also, these          modifiers are not permitted in subqueries (including          subqueries in the `FROM` clause), and          [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements in unions          other than the first [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select).        

  ​          Before MySQL 5.5.3, for a query that uses          [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) or subqueries, the          following rules apply:

  - ​              `SQL_NO_CACHE` applies if it appears in              any [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) in the query.            
  - ​              For a cacheable query, `SQL_CACHE`              applies if it appears in the first              [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) of the query.

​      A `SELECT` from a partitioned table using a      storage engine such as [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that      employs table-level locks locks all partitions of the table. This      does not occur with tables using storage engines such as      [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html) that employ row-level locking.      This issue is resolved in MySQL 5.6. For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).

#### 13.2.9.1 SELECT ... INTO Syntax

​        The [`SELECT ...        INTO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) form of [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        enables a query result to be stored in variables or written to a        file:

- ​            `SELECT ... INTO            *var_list*` selects column            values and stores them into variables.          
- ​            `SELECT ... INTO OUTFILE` writes the            selected rows to a file. Column and line terminators can be            specified to produce a specific output format.          
- ​            `SELECT ... INTO DUMPFILE` writes a single            row to a file without any formatting.

​        The [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) syntax description        (see [Section 13.2.9, “SELECT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)) shows the `INTO`        clause near the end of the statement. It is also possible to use        `INTO` immediately following the        *select_expr* list.      

​        An `INTO` clause should not be used in a nested        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) because such a        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) must return its result to        the outer context.      

​        The `INTO` clause can name a list of one or        more variables, which can be user-defined variables, stored        procedure or function parameters, or stored program local        variables. (Within a prepared `SELECT ... INTO        OUTFILE` statement, only user-defined variables are        permitted;see [Section 13.6.4.2, “Local Variable Scope and Resolution”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#local-variable-scope).)      

​        The selected values are assigned to the variables. The number of        variables must match the number of columns. The query should        return a single row. If the query returns no rows, a warning        with error code 1329 occurs (`No data`), and        the variable values remain unchanged. If the query returns        multiple rows, error 1172 occurs (`Result consisted of        more than one row`). If it is possible that the        statement may retrieve multiple rows, you can use `LIMIT        1` to limit the result set to a single row.      

```
SELECT id, data INTO @x, @y FROM test.t1 LIMIT 1;

```

​        User variable names are not case sensitive. See        [Section 9.4, “User-Defined Variables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/language-structure.html#user-variables).      

​        The [`SELECT ... INTO        OUTFILE '*file_name*'`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) form of        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) writes the selected rows        to a file. The file is created on the server host, so you must        have the [`FILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_file) privilege to use        this syntax. *file_name* cannot be an        existing file, which among other things prevents files such as        `/etc/passwd` and database tables from being        destroyed. The        [`character_set_filesystem`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_character_set_filesystem) system        variable controls the interpretation of the file name.      

​        The [`SELECT ... INTO        OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) statement is intended primarily to let you        very quickly dump a table to a text file on the server machine.        If you want to create the resulting file on some other host than        the server host, you normally cannot use        [`SELECT ... INTO        OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) since there is no way to write a path to the        file relative to the server host's file system.      

​        However, if the MySQL client software is installed on the remote        machine, you can instead use a client command such as        `mysql -e "SELECT ..." >        *file_name*` to generate the        file on the client host.      

​        It is also possible to create the resulting file on a different        host other than the server host, if the location of the file on        the remote host can be accessed using a network-mapped path on        the server's file system. In this case, the presence of        [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) (or some other MySQL client program) is        not required on the target host.      

​        [`SELECT ... INTO        OUTFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) is the complement of        [`LOAD DATA        INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data). Column values are written converted to the        character set specified in the `CHARACTER SET`        clause. If no such clause is present, values are dumped using        the `binary` character set. In effect, there is        no character set conversion. If a result set contains columns in        several character sets, the output data file will as well and        you may not be able to reload the file correctly.      

​        The syntax for the *export_options*        part of the statement consists of the same        `FIELDS` and `LINES` clauses        that are used with the        [`LOAD DATA        INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) statement. See [Section 13.2.6, “LOAD DATA INFILE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data), for        information about the `FIELDS` and        `LINES` clauses, including their default values        and permissible values.      

​        `FIELDS ESCAPED BY` controls how to write        special characters. If the `FIELDS ESCAPED BY`        character is not empty, it is used when necessary to avoid        ambiguity as a prefix that precedes following characters on        output:

- ​            The `FIELDS ESCAPED BY` character          
- ​            The `FIELDS [OPTIONALLY] ENCLOSED BY`            character          
- ​            The first character of the `FIELDS TERMINATED            BY` and `LINES TERMINATED BY`            values          
- ​            ASCII `NUL` (the zero-valued byte; what is            actually written following the escape character is ASCII            `0`, not a zero-valued byte)

​        The `FIELDS TERMINATED BY`, `ENCLOSED        BY`, `ESCAPED BY`, or `LINES        TERMINATED BY` characters *must* be        escaped so that you can read the file back in reliably. ASCII        `NUL` is escaped to make it easier to view with        some pagers.      

​        The resulting file does not have to conform to SQL syntax, so        nothing else need be escaped.      

​        If the `FIELDS ESCAPED BY` character is empty,        no characters are escaped and `NULL` is output        as `NULL`, not `\N`. It is        probably not a good idea to specify an empty escape character,        particularly if field values in your data contain any of the        characters in the list just given.      

​        Here is an example that produces a file in the comma-separated        values (CSV) format used by many programs:      

```
SELECT a,b,a+b INTO OUTFILE '/tmp/result.txt'
  FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
  LINES TERMINATED BY '\n'
  FROM test_table;

```

​        If you use `INTO DUMPFILE` instead of        `INTO OUTFILE`, MySQL writes only one row into        the file, without any column or line termination and without        performing any escape processing. This is useful if you want to        store a [`BLOB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#blob) value in a file.

Note

​          Any file created by `INTO OUTFILE` or          `INTO DUMPFILE` is writable by all users on          the server host. The reason for this is that the MySQL server          cannot create a file that is owned by anyone other than the          user under whose account it is running. (You should          *never* run [**mysqld**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqld) as          `root` for this and other reasons.) The file          thus must be world-writable so that you can manipulate its          contents.        

​          If the [`secure_file_priv`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_secure_file_priv)          system variable is set to a nonempty directory name, the file          to be written must be located in that directory.

​        In the context of        [`SELECT ...        INTO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select-into) statements that occur as part of events executed        by the Event Scheduler, diagnostics messages (not only errors,        but also warnings) are written to the error log, and, on        Windows, to the application event log. For additional        information, see [Section 20.4.5, “Event Scheduler Status”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/stored-programs-views.html#events-status-info).

#### 13.2.9.2 JOIN Syntax

​        MySQL supports the following `JOIN` syntax for        the *table_references* part of        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements and        multiple-table [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) and        [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statements:      

```
table_references:
    escaped_table_reference [, escaped_table_reference] ...

escaped_table_reference:
    table_reference
  | { OJ table_reference }

table_reference:
    table_factor
  | join_table

table_factor:
    tbl_name [[AS] alias] [index_hint_list]
  | table_subquery [AS] alias
  | ( table_references )

join_table:
    table_reference [INNER | CROSS] JOIN table_factor [join_condition]
  | table_reference STRAIGHT_JOIN table_factor
  | table_reference STRAIGHT_JOIN table_factor ON conditional_expr
  | table_reference {LEFT|RIGHT} [OUTER] JOIN table_reference join_condition
  | table_reference NATURAL [{LEFT|RIGHT} [OUTER]] JOIN table_factor

join_condition:
    ON conditional_expr
  | USING (column_list)

index_hint_list:
    index_hint [, index_hint] ...

index_hint:
    USE {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
  | IGNORE {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] (index_list)
  | FORCE {INDEX|KEY}
      [FOR {JOIN|ORDER BY|GROUP BY}] (index_list)

index_list:
    index_name [, index_name] ...

```

​        A table reference is also known as a join expression.      

​        The syntax of *table_factor* is        extended in MySQL in comparison with standard SQL. The standard        accepts only *table_reference*, not a        list of them inside a pair of parentheses.      

​        This is a conservative extension if each comma in a list of        *table_reference* items is considered        as equivalent to an inner join. For example:      

```
SELECT * FROM t1 LEFT JOIN (t2, t3, t4)
                 ON (t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c)

```

​        is equivalent to:      

```
SELECT * FROM t1 LEFT JOIN (t2 CROSS JOIN t3 CROSS JOIN t4)
                 ON (t2.a = t1.a AND t3.b = t1.b AND t4.c = t1.c)

```

​        In MySQL, `JOIN`, `CROSS        JOIN`, and `INNER JOIN` are syntactic        equivalents (they can replace each other). In standard SQL, they        are not equivalent. `INNER JOIN` is used with        an `ON` clause, `CROSS JOIN`        is used otherwise.      

​        In general, parentheses can be ignored in join expressions        containing only inner join operations. MySQL also supports        nested joins. See [Section 8.2.1.6, “Nested Join Optimization”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#nested-join-optimization).      

​        Index hints can be specified to affect how the MySQL optimizer        makes use of indexes. For more information, see        [Section 8.9.3, “Index Hints”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#index-hints). The        `optimizer_switch` system variable is another        way to influence optimizer use of indexes. See        [Section 8.9.2, “Switchable Optimizations”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#switchable-optimizations).      

​        The following list describes general factors to take into        account when writing joins:

- ​            A table reference can be aliased using            `*tbl_name* AS            *alias_name*` or            *tbl_name alias_name*:          

  ```
  SELECT t1.name, t2.salary
    FROM employee AS t1 INNER JOIN info AS t2 ON t1.name = t2.name;

  SELECT t1.name, t2.salary
    FROM employee t1 INNER JOIN info t2 ON t1.name = t2.name;

  ```

- ​            A *table_subquery* is also known as            a derived table or subquery in the `FROM`            clause. See [Section 13.2.10.8, “Derived Tables (Subqueries in the FROM Clause)”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#derived-tables). Such            subqueries *must* include an alias to            give the subquery result a table name. A trivial example            follows:          

  ```
  SELECT * FROM (SELECT 1, 2, 3) AS t1;

  ```

- ​            `INNER JOIN` and `,`            (comma) are semantically equivalent in the absence of a join            condition: both produce a Cartesian product between the            specified tables (that is, each and every row in the first            table is joined to each and every row in the second table).          

  ​            However, the precedence of the comma operator is less than            that of `INNER JOIN`, `CROSS            JOIN`, `LEFT JOIN`, and so on. If            you mix comma joins with the other join types when there is            a join condition, an error of the form `Unknown            column '*col_name*' in 'on            clause'` may occur. Information about dealing with            this problem is given later in this section.          

- ​            The *conditional_expr* used with            `ON` is any conditional expression of the            form that can be used in a `WHERE` clause.            Generally, the `ON` clause serves for            conditions that specify how to join tables, and the            `WHERE` clause restricts which rows to            include in the result set.          

- ​            If there is no matching row for the right table in the            `ON` or `USING` part in a            `LEFT JOIN`, a row with all columns set to            `NULL` is used for the right table. You can            use this fact to find rows in a table that have no            counterpart in another table:          

  ```
  SELECT left_tbl.*
    FROM left_tbl LEFT JOIN right_tbl ON left_tbl.id = right_tbl.id
    WHERE right_tbl.id IS NULL;

  ```

  ​            This example finds all rows in `left_tbl`            with an `id` value that is not present in            `right_tbl` (that is, all rows in            `left_tbl` with no corresponding row in            `right_tbl`). See            [Section 8.2.1.7, “Left Join and Right Join Optimization”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#left-join-optimization).          

- ​            The            `USING(*column_list*)`            clause names a list of columns that must exist in both            tables. If tables `a` and            `b` both contain columns            `c1`, `c2`, and            `c3`, the following join compares            corresponding columns from the two tables:          

  ```
  a LEFT JOIN b USING (c1, c2, c3)

  ```

- ​            The `NATURAL [LEFT] JOIN` of two tables is            defined to be semantically equivalent to an `INNER            JOIN` or a `LEFT JOIN` with a            `USING` clause that names all columns that            exist in both tables.          

- ​            `RIGHT JOIN` works analogously to            `LEFT JOIN`. To keep code portable across            databases, it is recommended that you use `LEFT            JOIN` instead of `RIGHT JOIN`.          

- ​                                    The `{ OJ ... }` syntax shown in the join            syntax description exists only for compatibility with ODBC.            The curly braces in the syntax should be written literally;            they are not metasyntax as used elsewhere in syntax            descriptions.          

  ```
  SELECT left_tbl.*
      FROM { OJ left_tbl LEFT OUTER JOIN right_tbl ON left_tbl.id = right_tbl.id }
      WHERE right_tbl.id IS NULL;

  ```

  ​            You can use other types of joins within `{ OJ ...            }`, such as `INNER JOIN` or            `RIGHT OUTER JOIN`. This helps with            compatibility with some third-party applications, but is not            official ODBC syntax.          

  ​            The parser does not permit nested `{ OJ ...            }` constructs (which are not legal ODBC syntax,            anyway). Queries that use such constructs should be            rewritten.          

- ​            `STRAIGHT_JOIN` is similar to            `JOIN`, except that the left table is            always read before the right table. This can be used for            those (few) cases for which the join optimizer processes the            tables in a suboptimal order.

​        Some join examples:      

```
SELECT * FROM table1, table2;

SELECT * FROM table1 INNER JOIN table2 ON table1.id = table2.id;

SELECT * FROM table1 LEFT JOIN table2 ON table1.id = table2.id;

SELECT * FROM table1 LEFT JOIN table2 USING (id);

SELECT * FROM table1 LEFT JOIN table2 ON table1.id = table2.id
  LEFT JOIN table3 ON table2.id = table3.id;

```

​        Natural joins and joins with `USING`, including        outer join variants, are processed according to the SQL:2003        standard:

- ​            Redundant columns of a `NATURAL` join do            not appear. Consider this set of statements:          

  ```
  CREATE TABLE t1 (i INT, j INT);
  CREATE TABLE t2 (k INT, j INT);
  INSERT INTO t1 VALUES(1, 1);
  INSERT INTO t2 VALUES(1, 1);
  SELECT * FROM t1 NATURAL JOIN t2;
  SELECT * FROM t1 JOIN t2 USING (j);

  ```

  ​            In the first [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)            statement, column `j` appears in both            tables and thus becomes a join column, so, according to            standard SQL, it should appear only once in the output, not            twice. Similarly, in the second SELECT statement, column            `j` is named in the            `USING` clause and should appear only once            in the output, not twice.          

  ​            Thus, the statements produce this output:          

  ```
  +------+------+------+
  | j    | i    | k    |
  +------+------+------+
  |    1 |    1 |    1 |
  +------+------+------+
  +------+------+------+
  | j    | i    | k    |
  +------+------+------+
  |    1 |    1 |    1 |
  +------+------+------+

  ```

  ​            Redundant column elimination and column ordering occurs            according to standard SQL, producing this display order:

  - ​                First, coalesced common columns of the two joined                tables, in the order in which they occur in the first                table              
  - ​                Second, columns unique to the first table, in order in                which they occur in that table              
  - ​                Third, columns unique to the second table, in order in                which they occur in that table

  ​            The single result column that replaces two common columns is            defined using the coalesce operation. That is, for two            `t1.a` and `t2.a` the            resulting single join column `a` is defined            as `a = COALESCE(t1.a, t2.a)`, where:          

  ```
  COALESCE(x, y) = (CASE WHEN x IS NOT NULL THEN x ELSE y END)

  ```

  ​            If the join operation is any other join, the result columns            of the join consist of the concatenation of all columns of            the joined tables.          

  ​            A consequence of the definition of coalesced columns is            that, for outer joins, the coalesced column contains the            value of the non-`NULL` column if one of            the two columns is always `NULL`. If            neither or both columns are `NULL`, both            common columns have the same value, so it doesn't matter            which one is chosen as the value of the coalesced column. A            simple way to interpret this is to consider that a coalesced            column of an outer join is represented by the common column            of the inner table of a `JOIN`. Suppose            that the tables `t1(a, b)` and            `t2(a, c)` have the following contents:          

  ```
  t1    t2
  ----  ----
  1 x   2 z
  2 y   3 w

  ```

  ​            Then, for this join, column `a` contains            the values of `t1.a`:          

  ```
  mysql> SELECT * FROM t1 NATURAL LEFT JOIN t2;
  +------+------+------+
  | a    | b    | c    |
  +------+------+------+
  |    1 | x    | NULL |
  |    2 | y    | z    |
  +------+------+------+

  ```

  ​            By contrast, for this join, column `a`            contains the values of `t2.a`.          

  ```
  mysql> SELECT * FROM t1 NATURAL RIGHT JOIN t2;
  +------+------+------+
  | a    | c    | b    |
  +------+------+------+
  |    2 | z    | y    |
  |    3 | w    | NULL |
  +------+------+------+

  ```

  ​            Compare those results to the otherwise equivalent queries            with `JOIN ... ON`:          

  ```
  mysql> SELECT * FROM t1 LEFT JOIN t2 ON (t1.a = t2.a);
  +------+------+------+------+
  | a    | b    | a    | c    |
  +------+------+------+------+
  |    1 | x    | NULL | NULL |
  |    2 | y    |    2 | z    |
  +------+------+------+------+

  ```

  ```
  mysql> SELECT * FROM t1 RIGHT JOIN t2 ON (t1.a = t2.a);
  +------+------+------+------+
  | a    | b    | a    | c    |
  +------+------+------+------+
  |    2 | y    |    2 | z    |
  | NULL | NULL |    3 | w    |
  +------+------+------+------+

  ```

- ​            A `USING` clause can be rewritten as an            `ON` clause that compares corresponding            columns. However, although `USING` and            `ON` are similar, they are not quite the            same. Consider the following two queries:          

  ​

  ​

  ​

  ```
  a LEFT JOIN b USING (c1, c2, c3)
  a LEFT JOIN b ON a.c1 = b.c1 AND a.c2 = b.c2 AND a.c3 = b.c3

  ```

  ​            With respect to determining which rows satisfy the join            condition, both joins are semantically identical.          

  ​            With respect to determining which columns to display for            `SELECT *` expansion, the two joins are not            semantically identical. The `USING` join            selects the coalesced value of corresponding columns,            whereas the `ON` join selects all columns            from all tables. For the `USING` join,            `SELECT *` selects these values:          

  ```
  COALESCE(a.c1, b.c1), COALESCE(a.c2, b.c2), COALESCE(a.c3, b.c3)

  ```

  ​            For the `ON` join, `SELECT            *` selects these values:          

  ```
  a.c1, a.c2, a.c3, b.c1, b.c2, b.c3

  ```

  ​            With an inner join, [`COALESCE(a.c1,            b.c1)`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_coalesce) is the same as either            `a.c1` or `b.c1` because            both columns will have the same value. With an outer join            (such as `LEFT JOIN`), one of the two            columns can be `NULL`. That column is            omitted from the result.          

- ​            An `ON` clause can refer only to its            operands.          

  ​            Example:          

  ```
  CREATE TABLE t1 (i1 INT);
  CREATE TABLE t2 (i2 INT);
  CREATE TABLE t3 (i3 INT);
  SELECT * FROM t1 JOIN t2 ON (i1 = i3) JOIN t3;

  ```

  ​            The statement fails with an `Unknown column 'i3' in            'on clause'` error because `i3` is            a column in `t3`, which is not an operand            of the `ON` clause. To enable the join to            be processed, rewrite the statement as follows:          

  ​

  ```
  SELECT * FROM t1 JOIN t2 JOIN t3 ON (i1 = i3);

  ```

- ​            `JOIN` has higher precedence than the comma            operator (`,`), so the join expression            `t1, t2 JOIN t3` is interpreted as            `(t1, (t2 JOIN t3))`, not as `((t1,            t2) JOIN t3)`. This affects statements that use an            `ON` clause because that clause can refer            only to columns in the operands of the join, and the            precedence affects interpretation of what those operands            are.          

  ​            Example:          

  ```
  CREATE TABLE t1 (i1 INT, j1 INT);
  CREATE TABLE t2 (i2 INT, j2 INT);
  CREATE TABLE t3 (i3 INT, j3 INT);
  INSERT INTO t1 VALUES(1, 1);
  INSERT INTO t2 VALUES(1, 1);
  INSERT INTO t3 VALUES(1, 1);
  SELECT * FROM t1, t2 JOIN t3 ON (t1.i1 = t3.i3);

  ```

  ​            The `JOIN` takes precedence over the comma            operator, so the operands for the `ON`            clause are `t2` and `t3`.            Because `t1.i1` is not a column in either            of the operands, the result is an `Unknown column            't1.i1' in 'on clause'` error.          

  ​

  ​            To enable the join to be processed, use either of these            strategies:

  - ​                Group the first two tables explicitly with parentheses                so that the operands for the `ON`                clause are `(t1, t2)` and                `t3`:              

    ```
    SELECT * FROM (t1, t2) JOIN t3 ON (t1.i1 = t3.i3);

    ```

  - ​                Avoid the use of the comma operator and use                `JOIN` instead:              

    ```
    SELECT * FROM t1 JOIN t2 JOIN t3 ON (t1.i1 = t3.i3);

    ```

  ​            The same precedence interpretation also applies to            statements that mix the comma operator with `INNER            JOIN`, `CROSS JOIN`, `LEFT            JOIN`, and `RIGHT JOIN`, all of            which have higher precedence than the comma operator.          

- ​            A MySQL extension compared to the SQL:2003 standard is that            MySQL permits you to qualify the common (coalesced) columns            of `NATURAL` or `USING`            joins, whereas the standard disallows that.

#### 13.2.9.3 UNION Syntax

```
SELECT ...
UNION [ALL | DISTINCT] SELECT ...
[UNION [ALL | DISTINCT] SELECT ...]

```

​        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) is used to combine the        result from multiple [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        statements into a single result set.      

​        The column names from the first        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement are used as the        column names for the results returned. Selected columns listed        in corresponding positions of each        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement should have the        same data type. (For example, the first column selected by the        first statement should have the same type as the first column        selected by the other statements.)      

​        If the data types of corresponding        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) columns do not match, the        types and lengths of the columns in the        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) result take into account        the values retrieved by all of the        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements. For example,        consider the following:      

```
mysql> SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
+---------------+
| REPEAT('a',1) |
+---------------+
| a             |
| bbbbbbbbbb    |
+---------------+

```

​        The [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements are normal        select statements, but with the following restrictions:

- ​            Only the last [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)            statement can use `INTO OUTFILE`. (However,            the entire [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) result is            written to the file.)          
- ​            `HIGH_PRIORITY` cannot be used with            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements that are            part of a [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union). If you            specify it for the first            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select), it has no effect. If            you specify it for any subsequent            [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements, a syntax            error results.

​        The default behavior for [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) is        that duplicate rows are removed from the result. The optional        `DISTINCT` keyword has no effect other than the        default because it also specifies duplicate-row removal. With        the optional `ALL` keyword, duplicate-row        removal does not occur and the result includes all matching rows        from all the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements.      

​        You can mix [`UNION        ALL`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) and [`UNION        DISTINCT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) in the same query. Mixed        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) types are treated such that        a `DISTINCT` union overrides any        `ALL` union to its left. A        `DISTINCT` union can be produced explicitly by        using [`UNION        DISTINCT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) or implicitly by using        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) with no following        `DISTINCT` or `ALL` keyword.      

​        To apply `ORDER BY` or `LIMIT`        to an individual [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select), place        the clause inside the parentheses that enclose the        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select):      

```
(SELECT a FROM t1 WHERE a=10 AND B=1 ORDER BY a LIMIT 10)
UNION
(SELECT a FROM t2 WHERE a=11 AND B=2 ORDER BY a LIMIT 10);

```

​        However, use of `ORDER BY` for individual        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements implies nothing        about the order in which the rows appear in the final result        because [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) by default produces        an unordered set of rows. Therefore, the use of `ORDER        BY` in this context is typically in conjunction with        `LIMIT`, so that it is used to determine the        subset of the selected rows to retrieve for the        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select), even though it does not        necessarily affect the order of those rows in the final        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) result. If `ORDER        BY` appears without `LIMIT` in a        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select), it is optimized away        because it will have no effect anyway.      

​        To use an `ORDER BY` or        `LIMIT` clause to sort or limit the entire        [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) result, parenthesize the        individual [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements and        place the `ORDER BY` or        `LIMIT` after the last one. The following        example uses both clauses:      

```
(SELECT a FROM t1 WHERE a=10 AND B=1)
UNION
(SELECT a FROM t2 WHERE a=11 AND B=2)
ORDER BY a LIMIT 10;

```

​        A statement without parentheses is equivalent to one        parenthesized as just shown.      

​        This kind of `ORDER BY` cannot use column        references that include a table name (that is, names in        *tbl_name*.*col_name*        format). Instead, provide a column alias in the first        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement and refer to the        alias in the `ORDER BY`. (Alternatively, refer        to the column in the `ORDER BY` using its        column position. However, use of column positions is        deprecated.)      

​        Also, if a column to be sorted is aliased, the `ORDER        BY` clause *must* refer to the        alias, not the column name. The first of the following        statements will work, but the second will fail with an        `Unknown column 'a' in 'order clause'` error:      

```
(SELECT a AS b FROM t) UNION (SELECT ...) ORDER BY b;
(SELECT a AS b FROM t) UNION (SELECT ...) ORDER BY a;

```

​        To cause rows in a [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) result        to consist of the sets of rows retrieved by each        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) one after the other,        select an additional column in each        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) to use as a sort column        and add an `ORDER BY` following the last        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select):      

```
(SELECT 1 AS sort_col, col1a, col1b, ... FROM t1)
UNION
(SELECT 2, col2a, col2b, ... FROM t2) ORDER BY sort_col;

```

​        To additionally maintain sort order within individual        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) results, add a secondary        column to the `ORDER BY` clause:      

```
(SELECT 1 AS sort_col, col1a, col1b, ... FROM t1)
UNION
(SELECT 2, col2a, col2b, ... FROM t2) ORDER BY sort_col, col1a;

```

​        Use of an additional column also enables you to determine which        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) each row comes from. Extra        columns can provide other identifying information as well, such        as a string that indicates a table name.

### 13.2.10 Subquery Syntax

- [13.2.10.1 The Subquery as Scalar Operand](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#scalar-subqueries)
- [13.2.10.2 Comparisons Using Subqueries](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#comparisons-using-subqueries)
- [13.2.10.3 Subqueries with ANY, IN, or SOME](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#any-in-some-subqueries)
- [13.2.10.4 Subqueries with ALL](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#all-subqueries)
- [13.2.10.5 Row Subqueries](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#row-subqueries)
- [13.2.10.6 Subqueries with EXISTS or NOT EXISTS](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#exists-and-not-exists-subqueries)
- [13.2.10.7 Correlated Subqueries](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#correlated-subqueries)
- [13.2.10.8 Derived Tables (Subqueries in the FROM Clause)](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#derived-tables)
- [13.2.10.9 Subquery Errors](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#subquery-errors)
- [13.2.10.10 Optimizing Subqueries](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#optimizing-subqueries)
- [13.2.10.11 Rewriting Subqueries as Joins](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#rewriting-subqueries)

​      A subquery is a [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement      within another statement.    

​      All subquery forms and operations that the SQL standard requires      are supported, as well as a few features that are MySQL-specific.    

​      Here is an example of a subquery:    

```
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);

```

​      In this example, `SELECT * FROM t1 ...` is the      *outer query* (or *outer      statement*), and `(SELECT column1 FROM      t2)` is the *subquery*. We say that      the subquery is *nested* within the outer      query, and in fact it is possible to nest subqueries within other      subqueries, to a considerable depth. A subquery must always appear      within parentheses.    

​      The main advantages of subqueries are:

- ​          They allow queries that are *structured* so          that it is possible to isolate each part of a statement.        
- ​          They provide alternative ways to perform operations that would          otherwise require complex joins and unions.        
- ​          Many people find subqueries more readable than complex joins          or unions. Indeed, it was the innovation of subqueries that          gave people the original idea of calling the early SQL          “Structured Query Language.”

​      Here is an example statement that shows the major points about      subquery syntax as specified by the SQL standard and supported in      MySQL:    

```
DELETE FROM t1
WHERE s11 > ANY
 (SELECT COUNT(*) /* no hint */ FROM t2
  WHERE NOT EXISTS
   (SELECT * FROM t3
    WHERE ROW(5*t2.s1,77)=
     (SELECT 50,11*s1 FROM t4 UNION SELECT 50,77 FROM
      (SELECT * FROM t5) AS t5)));

```

​      A subquery can return a scalar (a single value), a single row, a      single column, or a table (one or more rows of one or more      columns). These are called scalar, column, row, and table      subqueries. Subqueries that return a particular kind of result      often can be used only in certain contexts, as described in the      following sections.    

​      There are few restrictions on the type of statements in which      subqueries can be used. A subquery can contain many of the      keywords or clauses that an ordinary      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) can contain:      `DISTINCT`, `GROUP BY`,      `ORDER BY`, `LIMIT`, joins,      index hints, [`UNION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#union) constructs,      comments, functions, and so on.    

​      A subquery's outer statement can be any one of:      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select),      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert),      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update),      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete),      [`SET`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-variable), or      [`DO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#do).    

​      In MySQL, you cannot modify a table and select from the same table      in a subquery. This applies to statements such as      [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete),      [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert),      [`REPLACE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#replace),      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update), and (because subqueries can      be used in the `SET` clause)      [`LOAD DATA      INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data).    

​      For information about how the optimizer handles subqueries, see      [Section 8.2.2, “Subquery Optimization”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#subquery-optimization). For a discussion of      restrictions on subquery use, including performance issues for      certain forms of subquery syntax, see      [Section C.4, “Restrictions on Subqueries”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/restrictions.html#subquery-restrictions).

#### 13.2.10.1 The Subquery as Scalar Operand

​        In its simplest form, a subquery is a scalar subquery that        returns a single value. A scalar subquery is a simple operand,        and you can use it almost anywhere a single column value or        literal is legal, and you can expect it to have those        characteristics that all operands have: a data type, a length,        an indication that it can be `NULL`, and so on.        For example:      

```
CREATE TABLE t1 (s1 INT, s2 CHAR(5) NOT NULL);
INSERT INTO t1 VALUES(100, 'abcde');
SELECT (SELECT s2 FROM t1);

```

​        The subquery in this [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        returns a single value (`'abcde'`) that has a        data type of [`CHAR`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#char), a length of 5,        a character set and collation equal to the defaults in effect at        [`CREATE TABLE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-table) time, and an        indication that the value in the column can be        `NULL`. Nullability of the value selected by a        scalar subquery is not copied because if the subquery result is        empty, the result is `NULL`. For the subquery        just shown, if `t1` were empty, the result        would be `NULL` even though        `s2` is `NOT NULL`.      

​        There are a few contexts in which a scalar subquery cannot be        used. If a statement permits only a literal value, you cannot        use a subquery. For example, `LIMIT` requires        literal integer arguments, and        [`LOAD DATA        INFILE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#load-data) requires a literal string file name. You cannot        use subqueries to supply these values.      

​        When you see examples in the following sections that contain the        rather spartan construct `(SELECT column1 FROM        t1)`, imagine that your own code contains much more        diverse and complex constructions.      

​        Suppose that we make two tables:      

```
CREATE TABLE t1 (s1 INT);
INSERT INTO t1 VALUES (1);
CREATE TABLE t2 (s1 INT);
INSERT INTO t2 VALUES (2);

```

​        Then perform a [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select):      

```
SELECT (SELECT s1 FROM t2) FROM t1;

```

​        The result is `2` because there is a row in        `t2` containing a column `s1`        that has a value of `2`.      

​        A scalar subquery can be part of an expression, but remember the        parentheses, even if the subquery is an operand that provides an        argument for a function. For example:      

```
SELECT UPPER((SELECT s1 FROM t1)) FROM t2;

```

#### 13.2.10.2 Comparisons Using Subqueries

​        The most common use of a subquery is in the form:      

```
non_subquery_operand comparison_operator (subquery)

```

​        Where *comparison_operator* is one of        these operators:      

```
=  >  <  >=  <=  <>  !=  <=>

```

​        For example:      

```
... WHERE 'a' = (SELECT column1 FROM t1)

```

​        MySQL also permits this construct:      

```
non_subquery_operand LIKE (subquery)

```

​        At one time the only legal place for a subquery was on the right        side of a comparison, and you might still find some old DBMSs        that insist on this.      

​        Here is an example of a common-form subquery comparison that you        cannot do with a join. It finds all the rows in table        `t1` for which the `column1`        value is equal to a maximum value in table        `t2`:      

```
SELECT * FROM t1
  WHERE column1 = (SELECT MAX(column2) FROM t2);

```

​        Here is another example, which again is impossible with a join        because it involves aggregating for one of the tables. It finds        all rows in table `t1` containing a value that        occurs twice in a given column:      

```
SELECT * FROM t1 AS t
  WHERE 2 = (SELECT COUNT(*) FROM t1 WHERE t1.id = t.id);

```

​        For a comparison of the subquery to a scalar, the subquery must        return a scalar. For a comparison of the subquery to a row        constructor, the subquery must be a row subquery that returns a        row with the same number of values as the row constructor. See        [Section 13.2.10.5, “Row Subqueries”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#row-subqueries).

#### 13.2.10.3 Subqueries with ANY, IN, or SOME

​        Syntax:      

```
operand comparison_operator ANY (subquery)
operand IN (subquery)
operand comparison_operator SOME (subquery)

```

​        Where *comparison_operator* is one of        these operators:      

```
=  >  <  >=  <=  <>  !=

```

​        The `ANY` keyword, which must follow a        comparison operator, means “return `TRUE`        if the comparison is `TRUE` for        `ANY` of the values in the column that the        subquery returns.” For example:      

```
SELECT s1 FROM t1 WHERE s1 > ANY (SELECT s1 FROM t2);

```

​        Suppose that there is a row in table `t1`        containing `(10)`. The expression is        `TRUE` if table `t2` contains        `(21,14,7)` because there is a value        `7` in `t2` that is less than        `10`. The expression is        `FALSE` if table `t2` contains        `(20,10)`, or if table `t2` is        empty. The expression is *unknown* (that is,        `NULL`) if table `t2` contains        `(NULL,NULL,NULL)`.      

​        When used with a subquery, the word `IN` is an        alias for `= ANY`. Thus, these two statements        are the same:      

```
SELECT s1 FROM t1 WHERE s1 = ANY (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 IN    (SELECT s1 FROM t2);

```

​        `IN` and `= ANY` are not        synonyms when used with an expression list.        `IN` can take an expression list, but        `= ANY` cannot. See        [Section 12.3.2, “Comparison Functions and Operators”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#comparison-operators).      

​        `NOT IN` is not an alias for `<>        ANY`, but for `<> ALL`. See        [Section 13.2.10.4, “Subqueries with ALL”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#all-subqueries).      

​        The word `SOME` is an alias for        `ANY`. Thus, these two statements are the same:      

```
SELECT s1 FROM t1 WHERE s1 <> ANY  (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 <> SOME (SELECT s1 FROM t2);

```

​        Use of the word `SOME` is rare, but this        example shows why it might be useful. To most people, the        English phrase “a is not equal to any b” means        “there is no b which is equal to a,” but that is        not what is meant by the SQL syntax. The syntax means        “there is some b to which a is not equal.” Using        `<> SOME` instead helps ensure that        everyone understands the true meaning of the query.

#### 13.2.10.4 Subqueries with ALL

​        Syntax:      

```
operand comparison_operator ALL (subquery)

```

​        The word `ALL`, which must follow a comparison        operator, means “return `TRUE` if the        comparison is `TRUE` for `ALL`        of the values in the column that the subquery returns.”        For example:      

```
SELECT s1 FROM t1 WHERE s1 > ALL (SELECT s1 FROM t2);

```

​        Suppose that there is a row in table `t1`        containing `(10)`. The expression is        `TRUE` if table `t2` contains        `(-5,0,+5)` because `10` is        greater than all three values in `t2`. The        expression is `FALSE` if table        `t2` contains        `(12,6,NULL,-100)` because there is a single        value `12` in table `t2` that        is greater than `10`. The expression is        *unknown* (that is, `NULL`)        if table `t2` contains        `(0,NULL,1)`.      

​        Finally, the expression is `TRUE` if table        `t2` is empty. So, the following expression is        `TRUE` when table `t2` is        empty:      

```
SELECT * FROM t1 WHERE 1 > ALL (SELECT s1 FROM t2);

```

​        But this expression is `NULL` when table        `t2` is empty:      

```
SELECT * FROM t1 WHERE 1 > (SELECT s1 FROM t2);

```

​        In addition, the following expression is `NULL`        when table `t2` is empty:      

```
SELECT * FROM t1 WHERE 1 > ALL (SELECT MAX(s1) FROM t2);

```

​        In general, *tables containing NULL        values* and *empty tables* are        “edge cases.” When writing subqueries, always        consider whether you have taken those two possibilities into        account.      

​        `NOT IN` is an alias for `<>        ALL`. Thus, these two statements are the same:      

```
SELECT s1 FROM t1 WHERE s1 <> ALL (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 NOT IN (SELECT s1 FROM t2);

```

#### 13.2.10.5 Row Subqueries

​        Scalar or column subqueries return a single value or a column of        values. A *row subquery* is a subquery        variant that returns a single row and can thus return more than        one column value. Legal operators for row subquery comparisons        are:      

```
=  >  <  >=  <=  <>  !=  <=>

```

​        Here are two examples:      

```
SELECT * FROM t1
  WHERE (col1,col2) = (SELECT col3, col4 FROM t2 WHERE id = 10);
SELECT * FROM t1
  WHERE ROW(col1,col2) = (SELECT col3, col4 FROM t2 WHERE id = 10);

```

​        For both queries, if the table `t2` contains a        single row with `id = 10`, the subquery returns        a single row. If this row has `col3` and        `col4` values equal to the        `col1` and `col2` values of        any rows in `t1`, the `WHERE`        expression is `TRUE` and each query returns        those `t1` rows. If the `t2`        row `col3` and `col4` values        are not equal the `col1` and        `col2` values of any `t1` row,        the expression is `FALSE` and the query returns        an empty result set. The expression is        *unknown* (that is, `NULL`)        if the subquery produces no rows. An error occurs if the        subquery produces multiple rows because a row subquery can        return at most one row.      

​        For information about how each operator works for row        comparisons, see [Section 12.3.2, “Comparison Functions and Operators”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#comparison-operators).      

​        The expressions `(1,2)` and        `ROW(1,2)` are sometimes called        row constructors. The two        are equivalent. The row constructor and the row returned by the        subquery must contain the same number of values.      

​        A row constructor is used for comparisons with subqueries that        return two or more columns. When a subquery returns a single        column, this is regarded as a scalar value and not as a row, so        a row constructor cannot be used with a subquery that does not        return at least two columns. Thus, the following query fails        with a syntax error:      

```
SELECT * FROM t1 WHERE ROW(1) = (SELECT column1 FROM t2)

```

​        Row constructors are legal in other contexts. For example, the        following two statements are semantically equivalent (and are        handled in the same way by the optimizer):      

```
SELECT * FROM t1 WHERE (column1,column2) = (1,1);
SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;

```

​        The following query answers the request, “find all rows in        table `t1` that also exist in table        `t2`”:      

```
SELECT column1,column2,column3
  FROM t1
  WHERE (column1,column2,column3) IN
         (SELECT column1,column2,column3 FROM t2);

```

​        For more information about the optimizer and row constructors,        see [Section 8.2.1.15, “Row Constructor Expression Optimization”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#row-constructor-optimization)

#### 13.2.10.6 Subqueries with EXISTS or NOT EXISTS

​        If a subquery returns any rows at all, `EXISTS        *subquery*` is        `TRUE`, and `NOT EXISTS        *subquery*` is        `FALSE`. For example:      

```
SELECT column1 FROM t1 WHERE EXISTS (SELECT * FROM t2);

```

​        Traditionally, an `EXISTS` subquery starts with        `SELECT *`, but it could begin with        `SELECT 5` or `SELECT column1`        or anything at all. MySQL ignores the        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) list in such a subquery,        so it makes no difference.      

​        For the preceding example, if `t2` contains any        rows, even rows with nothing but `NULL` values,        the `EXISTS` condition is        `TRUE`. This is actually an unlikely example        because a `[NOT] EXISTS` subquery almost always        contains correlations. Here are some more realistic examples:

- ​            What kind of store is present in one or more cities?          

  ```
  SELECT DISTINCT store_type FROM stores
    WHERE EXISTS (SELECT * FROM cities_stores
                  WHERE cities_stores.store_type = stores.store_type);

  ```

- ​            What kind of store is present in no cities?          

  ```
  SELECT DISTINCT store_type FROM stores
    WHERE NOT EXISTS (SELECT * FROM cities_stores
                      WHERE cities_stores.store_type = stores.store_type);

  ```

- ​            What kind of store is present in all cities?          

  ```
  SELECT DISTINCT store_type FROM stores s1
    WHERE NOT EXISTS (
      SELECT * FROM cities WHERE NOT EXISTS (
        SELECT * FROM cities_stores
         WHERE cities_stores.city = cities.city
         AND cities_stores.store_type = stores.store_type));

  ```

​        The last example is a double-nested `NOT        EXISTS` query. That is, it has a `NOT        EXISTS` clause within a `NOT EXISTS`        clause. Formally, it answers the question “does a city        exist with a store that is not in        `Stores`”? But it is easier to say that        a nested `NOT EXISTS` answers the question        “is *x* `TRUE`        for all *y*?”

#### 13.2.10.7 Correlated Subqueries

​        A *correlated subquery* is a subquery that        contains a reference to a table that also appears in the outer        query. For example:      

```
SELECT * FROM t1
  WHERE column1 = ANY (SELECT column1 FROM t2
                       WHERE t2.column2 = t1.column2);

```

​        Notice that the subquery contains a reference to a column of        `t1`, even though the subquery's        `FROM` clause does not mention a table        `t1`. So, MySQL looks outside the subquery, and        finds `t1` in the outer query.      

​        Suppose that table `t1` contains a row where        `column1 = 5` and `column2 =        6`; meanwhile, table `t2` contains a        row where `column1 = 5` and `column2 =        7`. The simple expression `... WHERE column1 =        ANY (SELECT column1 FROM t2)` would be        `TRUE`, but in this example, the        `WHERE` clause within the subquery is        `FALSE` (because `(5,6)` is        not equal to `(5,7)`), so the expression as a        whole is `FALSE`.      

​        **Scoping rule:** MySQL evaluates        from inside to outside. For example:      

```
SELECT column1 FROM t1 AS x
  WHERE x.column1 = (SELECT column1 FROM t2 AS x
    WHERE x.column1 = (SELECT column1 FROM t3
      WHERE x.column2 = t3.column1));

```

​        In this statement, `x.column2` must be a column        in table `t2` because `SELECT column1        FROM t2 AS x ...` renames `t2`. It is        not a column in table `t1` because        `SELECT column1 FROM t1 ...` is an outer query        that is *farther out*.      

​        For subqueries in `HAVING` or `ORDER        BY` clauses, MySQL also looks for column names in the        outer select list.      

​        For certain cases, a correlated subquery is optimized. For        example:      

```
val IN (SELECT key_val FROM tbl_name WHERE correlated_condition)

```

​        Otherwise, they are inefficient and likely to be slow. Rewriting        the query as a join might improve performance.      

​        Aggregate functions in correlated subqueries may contain outer        references, provided the function contains nothing but outer        references, and provided the function is not contained in        another function or expression.

#### 13.2.10.8 Derived Tables (Subqueries in the FROM Clause)

​        A derived table is a subquery in a        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statement        `FROM` clause:      

```
SELECT ... FROM (subquery) [AS] tbl_name ...

```

​        The `[AS] *tbl_name*`        clause is mandatory because every table in a        `FROM` clause must have a name. Any columns in        the *subquery* select list must have        unique names.      

​        For the sake of illustration, assume that you have this table:      

```
CREATE TABLE t1 (s1 INT, s2 CHAR(5), s3 FLOAT);

```

​        Here is how to use a subquery in the `FROM`        clause, using the example table:      

```
INSERT INTO t1 VALUES (1,'1',1.0);
INSERT INTO t1 VALUES (2,'2',2.0);
SELECT sb1,sb2,sb3
  FROM (SELECT s1 AS sb1, s2 AS sb2, s3*2 AS sb3 FROM t1) AS sb
  WHERE sb1 > 1;

```

​        Result: `2, '2', 4.0`.      

​        Here is another example: Suppose that you want to know the        average of a set of sums for a grouped table. This does not        work:      

```
SELECT AVG(SUM(column1)) FROM t1 GROUP BY column1;

```

​        However, this query provides the desired information:      

```
SELECT AVG(sum_column1)
  FROM (SELECT SUM(column1) AS sum_column1
        FROM t1 GROUP BY column1) AS t1;

```

​        Notice that the column name used within the subquery        (`sum_column1`) is recognized in the outer        query.      

​        Derived tables can return a scalar, column, row, or table.      

​        Derived tables cannot be correlated subqueries, or contain outer        references or references to other tables of the same        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select).      

​        Subqueries in the `FROM` clause are executed        even for the [`EXPLAIN`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) statement        (that is, derived temporary tables are materialized). This        occurs because upper-level queries need information about all        tables during the optimization phase, and the table represented        by a subquery in the `FROM` clause is        unavailable unless the subquery is executed.      

​        It is possible under certain circumstances that using        [`EXPLAIN        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) will modify table data. This can occur if the        outer query accesses any tables and an inner query invokes a        stored function that changes one or more rows of a table.        Suppose that there are two tables `t1` and        `t2` in database `d1`, and a        stored function `f1` that modifies        `t2`, created as shown here:      

```
CREATE DATABASE d1;
USE d1;
CREATE TABLE t1 (c1 INT);
CREATE TABLE t2 (c1 INT);
CREATE FUNCTION f1(p1 INT) RETURNS INT
  BEGIN
    INSERT INTO t2 VALUES (p1);
    RETURN p1;
  END;

```

​        Referencing the function directly in an        [`EXPLAIN        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) has no effect on `t2`, as        shown here:      

```
mysql> SELECT * FROM t2;
Empty set (0.02 sec)

mysql> EXPLAIN SELECT f1(5)\G
*************************** 1. row ***************************
           id: 1
  select_type: SIMPLE
        table: NULL
         type: NULL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: No tables used
1 row in set (0.01 sec)

mysql> SELECT * FROM t2;
Empty set (0.01 sec)

```

​        This is because the [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        statement did not reference any tables, as can be seen in the        `table` and `Extra` columns of        the output. This is also true of the following nested        [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select):      

```
mysql> EXPLAIN SELECT NOW() AS a1, (SELECT f1(5)) AS a2\G
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: NULL
         type: NULL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
     filtered: NULL
        Extra: No tables used
1 row in set, 1 warning (0.00 sec)

mysql> SHOW WARNINGS;
+-------+------+------------------------------------------+
| Level | Code | Message                                  |
+-------+------+------------------------------------------+
| Note  | 1249 | Select 2 was reduced during optimization |
+-------+------+------------------------------------------+
1 row in set (0.00 sec)

mysql> SELECT * FROM t2;
Empty set (0.00 sec)

```

​        However, if the outer [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select)        references any tables, the optimizer executes the statement in        the subquery as well:      

```
mysql> EXPLAIN SELECT * FROM t1 AS a1, (SELECT f1(5)) AS a2\G
*************************** 1. row ***************************
           id: 1
  select_type: PRIMARY
        table: <derived2>
         type: system
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 1
        Extra: 
*************************** 2. row ***************************
           id: 1
  select_type: PRIMARY
        table: a1
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 1
        Extra: 
*************************** 3. row ***************************
           id: 2
  select_type: DERIVED
        table: NULL
         type: NULL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: No tables used
3 rows in set (0.00 sec)

mysql> SELECT * FROM t2;
+------+
| c1   |
+------+
|    5 |
+------+
1 row in set (0.00 sec)

```

​        This also means that an        [`EXPLAIN        SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) statement such as the one shown here may take a        long time to execute because the        [`BENCHMARK()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_benchmark) function is executed        once for each row in `t1`:      

```
EXPLAIN SELECT * FROM t1 AS a1, (SELECT BENCHMARK(1000000, MD5(NOW())));

```

#### 13.2.10.9 Subquery Errors

​        There are some errors that apply only to subqueries. This        section describes them.

- ​            Unsupported subquery syntax:          

  ```
  ERROR 1235 (ER_NOT_SUPPORTED_YET)
  SQLSTATE = 42000
  Message = "This version of MySQL doesn't yet support
  'LIMIT & IN/ALL/ANY/SOME subquery'"

  ```

  ​            This means that MySQL does not support statements of the            following form:          

  ```
  SELECT * FROM t1 WHERE s1 IN (SELECT s2 FROM t2 ORDER BY s1 LIMIT 1)

  ```

- ​            Incorrect number of columns from subquery:          

  ```
  ERROR 1241 (ER_OPERAND_COL)
  SQLSTATE = 21000
  Message = "Operand should contain 1 column(s)"

  ```

  ​            This error occurs in cases like this:          

  ```
  SELECT (SELECT column1, column2 FROM t2) FROM t1;

  ```

  ​            You may use a subquery that returns multiple columns, if the            purpose is row comparison. In other contexts, the subquery            must be a scalar operand. See            [Section 13.2.10.5, “Row Subqueries”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#row-subqueries).          

- ​            Incorrect number of rows from subquery:          

  ```
  ERROR 1242 (ER_SUBSELECT_NO_1_ROW)
  SQLSTATE = 21000
  Message = "Subquery returns more than 1 row"

  ```

  ​            This error occurs for statements where the subquery must            return at most one row but returns multiple rows. Consider            the following example:          

  ```
  SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);

  ```

  ​            If `SELECT column1 FROM t2` returns just            one row, the previous query will work. If the subquery            returns more than one row, error 1242 will occur. In that            case, the query should be rewritten as:          

  ```
  SELECT * FROM t1 WHERE column1 = ANY (SELECT column1 FROM t2);

  ```

- ​            Incorrectly used table in subquery:          

  ```
  Error 1093 (ER_UPDATE_TABLE_USED)
  SQLSTATE = HY000
  Message = "You can't specify target table 'x'
  for update in FROM clause"

  ```

  ​            This error occurs in cases such as the following, which            attempts to modify a table and select from the same table in            the subquery:          

  ```
  UPDATE t1 SET column2 = (SELECT MAX(column1) FROM t1);

  ```

  ​            You can use a subquery for assignment within an            [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement because            subqueries are legal in            [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) and            [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statements as well as            in [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements.            However, you cannot use the same table (in this case, table            `t1`) for both the subquery            `FROM` clause and the update target.

​        For transactional storage engines, the failure of a subquery        causes the entire statement to fail. For nontransactional        storage engines, data modifications made before the error was        encountered are preserved.

#### 13.2.10.10 Optimizing Subqueries

​        Development is ongoing, so no optimization tip is reliable for        the long term. The following list provides some interesting        tricks that you might want to play with. See also        [Section 8.2.2, “Subquery Optimization”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#subquery-optimization).

- ​            Use subquery clauses that affect the number or order of the            rows in the subquery. For example:          

  ```
  SELECT * FROM t1 WHERE t1.column1 IN
    (SELECT column1 FROM t2 ORDER BY column1);
  SELECT * FROM t1 WHERE t1.column1 IN
    (SELECT DISTINCT column1 FROM t2);
  SELECT * FROM t1 WHERE EXISTS
    (SELECT * FROM t2 LIMIT 1);

  ```

- ​            Replace a join with a subquery. For example, try this:          

  ```
  SELECT DISTINCT column1 FROM t1 WHERE t1.column1 IN (
    SELECT column1 FROM t2);

  ```

  ​            Instead of this:          

  ```
  SELECT DISTINCT t1.column1 FROM t1, t2
    WHERE t1.column1 = t2.column1;

  ```

- ​            Some subqueries can be transformed to joins for            compatibility with older versions of MySQL that do not            support subqueries. However, in some cases, converting a            subquery to a join may improve performance. See            [Section 13.2.10.11, “Rewriting Subqueries as Joins”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#rewriting-subqueries).          

- ​            Move clauses from outside to inside the subquery. For            example, use this query:          

  ```
  SELECT * FROM t1
    WHERE s1 IN (SELECT s1 FROM t1 UNION ALL SELECT s1 FROM t2);

  ```

  ​            Instead of this query:          

  ```
  SELECT * FROM t1
    WHERE s1 IN (SELECT s1 FROM t1) OR s1 IN (SELECT s1 FROM t2);

  ```

  ​            For another example, use this query:          

  ```
  SELECT (SELECT column1 + 5 FROM t1) FROM t2;

  ```

  ​            Instead of this query:          

  ```
  SELECT (SELECT column1 FROM t1) + 5 FROM t2;

  ```

- ​            Use a row subquery instead of a correlated subquery. For            example, use this query:          

  ```
  SELECT * FROM t1
    WHERE (column1,column2) IN (SELECT column1,column2 FROM t2);

  ```

  ​            Instead of this query:          

  ```
  SELECT * FROM t1
    WHERE EXISTS (SELECT * FROM t2 WHERE t2.column1=t1.column1
                  AND t2.column2=t1.column2);

  ```

- ​            Use `NOT (a = ANY (...))` rather than            `a <> ALL (...)`.          

- ​            Use `x = ANY (*table containing            (1,2)*)` rather than `x=1 OR            x=2`.          

- ​            Use `= ANY` rather than            `EXISTS`.          

- ​            For uncorrelated subqueries that always return one row,            `IN` is always slower than            `=`. For example, use this query:          

  ```
  SELECT * FROM t1
    WHERE t1.col_name = (SELECT a FROM t2 WHERE b = some_const);

  ```

  ​            Instead of this query:          

  ```
  SELECT * FROM t1
    WHERE t1.col_name IN (SELECT a FROM t2 WHERE b = some_const);

  ```

​        These tricks might cause programs to go faster or slower. Using        MySQL facilities like the        [`BENCHMARK()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_benchmark) function, you can get        an idea about what helps in your own situation. See        [Section 12.14, “Information Functions”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#information-functions).      

​        Some optimizations that MySQL itself makes are:

- ​            MySQL executes uncorrelated subqueries only once. Use            [`EXPLAIN`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) to make sure that a            given subquery really is uncorrelated.          

- ​            MySQL rewrites `IN`,            `ALL`, `ANY`, and            `SOME` subqueries in an attempt to take            advantage of the possibility that the select-list columns in            the subquery are indexed.          

- ​            MySQL replaces subqueries of the following form with an            index-lookup function, which            [`EXPLAIN`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#explain) describes as a            special join type            ([`unique_subquery`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_unique_subquery) or            [`index_subquery`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#jointype_index_subquery)):          

  ```
  ... IN (SELECT indexed_column FROM single_table ...)

  ```

- ​            MySQL enhances expressions of the following form with an            expression involving [`MIN()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_min) or            [`MAX()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_max), unless            `NULL` values or empty sets are involved:          

  ```
  value {ALL|ANY|SOME} {> | < | >= | <=} (uncorrelated subquery)

  ```

  ​            For example, this `WHERE` clause:          

  ```
  WHERE 5 > ALL (SELECT x FROM t)

  ```

  ​            might be treated by the optimizer like this:          

  ```
  WHERE 5 > (SELECT MAX(x) FROM t)

  ```

​        See also        [MySQL        Internals: How MySQL Transforms Subqueries](http://dev.mysql.com/doc/internals/en/transformations.html).

#### 13.2.10.11 Rewriting Subqueries as Joins

​        Sometimes there are other ways to test membership in a set of        values than by using a subquery. Also, on some occasions, it is        not only possible to rewrite a query without a subquery, but it        can be more efficient to make use of some of these techniques        rather than to use subqueries. One of these is the        `IN()` construct:      

​        For example, this query:      

```
SELECT * FROM t1 WHERE id IN (SELECT id FROM t2);

```

​        Can be rewritten as:      

```
SELECT DISTINCT t1.* FROM t1, t2 WHERE t1.id=t2.id;

```

​        The queries:      

```
SELECT * FROM t1 WHERE id NOT IN (SELECT id FROM t2);
SELECT * FROM t1 WHERE NOT EXISTS (SELECT id FROM t2 WHERE t1.id=t2.id);

```

​        Can be rewritten as:      

```
SELECT table1.*
  FROM table1 LEFT JOIN table2 ON table1.id=table2.id
  WHERE table2.id IS NULL;

```

​        A `LEFT [OUTER] JOIN` can be faster than an        equivalent subquery because the server might be able to optimize        it better—a fact that is not specific to MySQL Server        alone. Prior to SQL-92, outer joins did not exist, so subqueries        were the only way to do certain things. Today, MySQL Server and        many other modern database systems offer a wide range of outer        join types.      

​        MySQL Server supports multiple-table        [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete) statements that can be        used to efficiently delete rows based on information from one        table or even from many tables at the same time. Multiple-table        [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statements are also        supported. See [Section 13.2.2, “DELETE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete), and        [Section 13.2.11, “UPDATE Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update).

### 13.2.11 UPDATE Syntax

​      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) is a DML statement that      modifies rows in a table.    

​      Single-table syntax:    

```
UPDATE [LOW_PRIORITY] [IGNORE] table_reference
    SET assignment_list
    [WHERE where_condition]
    [ORDER BY ...]
    [LIMIT row_count]

value:
    {expr | DEFAULT}

assignment:
    col_name = value

assignment_list:
    assignment [, assignment] ...

```

​      Multiple-table syntax:    

```
UPDATE [LOW_PRIORITY] [IGNORE] table_references
    SET assignment_list
    [WHERE where_condition]

```

​      For the single-table syntax, the      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement updates columns of      existing rows in the named table with new values. The      `SET` clause indicates which columns to modify      and the values they should be given. Each value can be given as an      expression, or the keyword `DEFAULT` to set a      column explicitly to its default value. The      `WHERE` clause, if given, specifies the      conditions that identify which rows to update. With no      `WHERE` clause, all rows are updated. If the      `ORDER BY` clause is specified, the rows are      updated in the order that is specified. The      `LIMIT` clause places a limit on the number of      rows that can be updated.    

​      For the multiple-table syntax,      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) updates rows in each table      named in *table_references* that satisfy      the conditions. Each matching row is updated once, even if it      matches the conditions multiple times. For multiple-table syntax,      `ORDER BY` and `LIMIT` cannot be      used.    

​      *where_condition* is an expression that      evaluates to true for each row to be updated. For expression      syntax, see [Section 9.5, “Expression Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/language-structure.html#expressions).    

​      *table_references* and      *where_condition* are specified as      described in [Section 13.2.9, “SELECT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select).    

​      You need the [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_update) privilege only      for columns referenced in an [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update)      that are actually updated. You need only the      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_select) privilege for any columns      that are read but not modified.    

​      The [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement supports the      following modifiers:

- ​          With the `LOW_PRIORITY` modifier, execution          of the [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) is delayed until          no other clients are reading from the table. This affects only          storage engines that use only table-level locking (such as          `MyISAM`, `MEMORY`, and          `MERGE`).        

  ​

- ​          With the `IGNORE` modifier, the update          statement does not abort even if errors occur during the          update. Rows for which duplicate-key conflicts occur on a          unique key value are not updated. Rows updated to values that          would cause data conversion errors are updated to the closest          valid values instead.

  ​

​      In MySQL 5.5.18 and later,      [`UPDATE IGNORE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update)      statements, including those having an `ORDER BY`      clause, are flagged as unsafe for statement-based replication.      (This is because the order in which the rows are updated      determines which rows are ignored.) Such statements produce a      warning in the error log when using statement-based mode and are      written to the binary log using the row-based format when using      `MIXED` mode. (Bug #11758262, Bug #50439) See      [Section 17.1.2.3, “Determination of Safe and Unsafe Statements in Binary Logging”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/replication.html#replication-rbr-safe-unsafe), for more      information.    

​      If you access a column from the table to be updated in an      expression, [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) uses the current      value of the column. For example, the following statement sets      `col1` to one more than its current value:    

```
UPDATE t1 SET col1 = col1 + 1;

```

​      The second assignment in the following statement sets      `col2` to the current (updated)      `col1` value, not the original      `col1` value. The result is that      `col1` and `col2` have the same      value. This behavior differs from standard SQL.    

```
UPDATE t1 SET col1 = col1 + 1, col2 = col1;

```

​      Single-table [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) assignments are      generally evaluated from left to right. For multiple-table      updates, there is no guarantee that assignments are carried out in      any particular order.    

​      If you set a column to the value it currently has, MySQL notices      this and does not update it.    

​      If you update a column that has been declared `NOT      NULL` by setting to `NULL`, an error      occurs if strict SQL mode is enabled; otherwise, the column is set      to the implicit default value for the column data type and the      warning count is incremented. The implicit default value is      `0` for numeric types, the empty string      (`''`) for string types, and the      “zero” value for date and time types. See      [Section 11.6, “Data Type Default Values”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/data-types.html#data-type-defaults).    

​      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) returns the number of rows      that were actually changed. The      [`mysql_info()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-info) C API function      returns the number of rows that were matched and updated and the      number of warnings that occurred during the      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update).    

​      You can use `LIMIT      *row_count*` to restrict the      scope of the [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update). A      `LIMIT` clause is a rows-matched restriction. The      statement stops as soon as it has found      *row_count* rows that satisfy the      `WHERE` clause, whether or not they actually were      changed.    

​      If an [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statement includes an      `ORDER BY` clause, the rows are updated in the      order specified by the clause. This can be useful in certain      situations that might otherwise result in an error. Suppose that a      table `t` contains a column `id`      that has a unique index. The following statement could fail with a      duplicate-key error, depending on the order in which rows are      updated:    

```
UPDATE t SET id = id + 1;

```

​      For example, if the table contains 1 and 2 in the      `id` column and 1 is updated to 2 before 2 is      updated to 3, an error occurs. To avoid this problem, add an      `ORDER BY` clause to cause the rows with larger      `id` values to be updated before those with      smaller values:    

```
UPDATE t SET id = id + 1 ORDER BY id DESC;

```

​      You can also perform [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update)      operations covering multiple tables. However, you cannot use      `ORDER BY` or `LIMIT` with a      multiple-table [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update). The      *table_references* clause lists the      tables involved in the join. Its syntax is described in      [Section 13.2.9.2, “JOIN Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#join). Here is an example:    

```
UPDATE items,month SET items.price=month.price
WHERE items.id=month.id;

```

​      The preceding example shows an inner join that uses the comma      operator, but multiple-table [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update)      statements can use any type of join permitted in      [`SELECT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#select) statements, such as      `LEFT JOIN`.    

​      If you use a multiple-table [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update)      statement involving `InnoDB` tables for which      there are foreign key constraints, the MySQL optimizer might      process tables in an order that differs from that of their      parent/child relationship. In this case, the statement fails and      rolls back. Instead, update a single table and rely on the      `ON UPDATE` capabilities that      `InnoDB` provides to cause the other tables to be      modified accordingly. See      [Section 14.11.1.6, “InnoDB and FOREIGN KEY Constraints”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html#innodb-foreign-key-constraints).    

​      You cannot update a table and select from the same table in a      subquery.    

​      Index hints (see [Section 8.9.3, “Index Hints”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/optimization.html#index-hints)) are accepted for      [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update) statements, but are ignored      prior to MySQL 5.5.6.    

​      An `UPDATE` on a partitioned table using a      storage engine such as [`MyISAM`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/storage-engines.html#myisam-storage-engine) that      employs table-level locks locks all partitions of the table. This      does not occur with tables using storage engines such as      [`InnoDB`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/innodb-storage-engine.html) that employ row-level locking.      This issue is resolved in MySQL 5.6. For more information, see      [Section 19.5.4, “Partitioning and Table-Level Locking”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/partitioning.html#partitioning-limitations-locking).