## 6.3 MySQL User Account Management

- [6.3.1 User Names and Passwords](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#user-names)
- [6.3.2 Adding User Accounts](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#adding-users)
- [6.3.3 Removing User Accounts](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#removing-users)
- [6.3.4 Setting Account Resource Limits](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#user-resources)
- [6.3.5 Assigning Account Passwords](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#assigning-passwords)
- [6.3.6 Pluggable Authentication](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#pluggable-authentication)
- [6.3.7 Proxy Users](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users)
- [6.3.8 SQL-Based MySQL Account Activity Auditing](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#account-activity-auditing)

​    This section describes how to set up accounts for clients of your    MySQL server. It discusses the following topics:

- ​        The meaning of account names and passwords as used in MySQL and        how that compares to names and passwords used by your operating        system      
- ​        How to set up new accounts and remove existing accounts      
- ​        How to change passwords      
- ​        Guidelines for using passwords securely

​    See also [Section 13.7.1, “Account Management Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#account-management-sql), which describes    the syntax and use for all user-management SQL statements.

### 6.3.1 User Names and Passwords

​      MySQL stores accounts in the `user` table of the      `mysql` system database. An account is defined in      terms of a user name and the client host or hosts from which the      user can connect to the server. For information about account      representation in the `user` table, see      [Section 6.2.2, “Grant Tables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#grant-tables).    

​      The account may also have a password. MySQL supports      authentication plugins, so it is possible that an account      authenticates using some external authentication method. See      [Section 6.3.6, “Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#pluggable-authentication).    

​      There are several distinctions between the way user names and      passwords are used by MySQL and your operating system:

- ​          User names, as used by MySQL for authentication purposes, have          nothing to do with user names (login names) as used by Windows          or Unix. On Unix, most MySQL clients by default try to log in          using the current Unix user name as the MySQL user name, but          that is for convenience only. The default can be overridden          easily, because client programs permit any user name to be          specified with a `-u` or          `--user` option. This means that anyone can          attempt to connect to the server using any user name, so you          cannot make a database secure in any way unless all MySQL          accounts have passwords. Anyone who specifies a user name for          an account that has no password is able to connect          successfully to the server.        

- ​          MySQL user names can be up to 16 characters long. Operating          system user names may be of a different maximum length. For          example, Unix user names typically are limited to eight          characters.

  Warning

  ​            The limit on MySQL user name length is hardcoded in MySQL            servers and clients, and trying to circumvent it by            modifying the definitions of the tables in the            `mysql` database *does not            work*.          

  ​            You should never alter the structure of tables in the            `mysql` database in any manner whatsoever            except by means of the procedure that is described in            [Section 4.4.7, “**mysql_upgrade** — Check and Upgrade MySQL Tables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql-upgrade). Attempting to redefine            MySQL's system tables in any other fashion results in            undefined (and unsupported!) behavior. The server is free to            ignore rows that become malformed as a result of such            modifications.

- ​          To authenticate client connections for accounts that use MySQL          native authentication (implemented by the          `mysql_native_password` authentication          plugin), the server uses passwords stored in the          `user` table. These passwords are distinct          from passwords for logging in to your operating system. There          is no necessary connection between the “external”          password you use to log in to a Windows or Unix machine and          the password you use to access the MySQL server on that          machine.        

  ​          If the server authenticates a client using some other plugin,          the authentication method that the plugin implements may or          may not use a password stored in the `user`          table. In this case, it is possible that an external password          is also used to authenticate to the MySQL server.        

- ​          Passwords stored in the `user` table are          encrypted using plugin-specific algorithms. For information          about MySQL native password hashing, see          [Section 6.1.2.4, “Password Hashing in MySQL”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#password-hashing).        

- ​          If the user name and password contain only ASCII characters,          it is possible to connect to the server regardless of          character set settings. To connect when the user name or          password contain non-ASCII characters, the client should call          the [`mysql_options()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-options) C API          function with the `MYSQL_SET_CHARSET_NAME`          option and appropriate character set name as arguments. This          causes authentication to take place using the specified          character set. Otherwise, authentication will fail unless the          server default character set is the same as the encoding in          the authentication defaults.        

  ​          Standard MySQL client programs support a          `--default-character-set` option that causes          [`mysql_options()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-options) to be called          as just described. In addition, character set autodetection is          supported as described in          [Section 10.1.4, “Connection Character Sets and Collations”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/globalization.html#charset-connection). For programs that use a          connector that is not based on the C API, the connector may          provide an equivalent to          [`mysql_options()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/connectors-apis.html#mysql-options) that can be          used instead. Check the connector documentation.        

  ​          The preceding notes do not apply for `ucs2`,          `utf16`, and `utf32`, which          are not permitted as client character sets.

​      The MySQL installation process populates the grant tables with an      initial account or accounts. The names and access privileges for      these accounts are described in      [Section 2.10.4, “Securing the Initial MySQL Accounts”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/installing.html#default-privileges), which also discusses how to      assign passwords to them. Thereafter, you normally set up, modify,      and remove MySQL accounts using statements such as      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user),      [`DROP USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#drop-user),      [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant), and      [`REVOKE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#revoke). See      [Section 13.7.1, “Account Management Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#account-management-sql).    

​      To connect to a MySQL server with a command-line client, specify      user name and password options as necessary for the account that      you want to use:    

```
shell> mysql --user=finley --password db_name

```

​      If you prefer short options, the command looks like this:    

```
shell> mysql -u finley -p db_name

```

​      If you omit the password value following the      [`--password`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_general_password) or `-p`      option on the command line (as just shown), the client prompts for      one. Alternatively, the password can be specified on the command      line:    

```
shell> mysql --user=finley --password=password db_name
shell> mysql -u finley -ppassword db_name

```

​      If you use the `-p` option, there must be      *no space* between `-p` and the      following password value.    

​      Specifying a password on the command line should be considered      insecure. See [Section 6.1.2.1, “End-User Guidelines for Password Security”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#password-security-user). You can      use an option file to avoid giving the password on the command      line. See [Section 4.2.6, “Using Option Files”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option-files).    

​      For additional information about specifying user names, passwords,      and other connection parameters, see [Section 4.2.2, “Connecting to the MySQL Server”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#connecting).

### 6.3.2 Adding User Accounts

​      You can create MySQL accounts two ways:

- ​          By using account-management statements intended for creating          accounts and establishing their privileges, such as          [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) and          [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant). These statements cause          the server to make appropriate modifications to the underlying          grant tables.        
- ​          By manipulating the MySQL grant tables directly with          statements such as [`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#insert),          [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#update), or          [`DELETE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#delete).

​      The preferred method is to use account-management statements      because they are more concise and less error-prone than      manipulating the grant tables directly. All such statements are      described in [Section 13.7.1, “Account Management Statements”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#account-management-sql). Direct      grant table manipulation is discouraged, and is not described      here. The server is free to ignore rows that become malformed as a      result of such modifications.    

​      Another option for creating accounts is to use the GUI tool      MySQL Workbench. Also, several third-party programs offer capabilities      for MySQL account administration. `phpMyAdmin` is      one such program.    

​      The following examples show how to use the      [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) client program to set up new accounts.      These examples assume that privileges have been set up according      to the defaults described in [Section 2.10.4, “Securing the Initial MySQL Accounts”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/installing.html#default-privileges).      This means that to make changes, you must connect to the MySQL      server as the MySQL `root` user, which has the      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_create-user) privilege.    

​      First, use the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) program to connect to the      server as the MySQL `root` user:    

```
shell> mysql --user=root mysql

```

​      If you have assigned a password to the `root`      account, you must also supply a `--password` or      `-p` option.    

​      After connecting to the server as `root`, you can      add new accounts. The following example uses      [`CREATE USER `](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) and      [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statements to set up four      accounts:    

```
mysql> CREATE USER 'finley'@'localhost' IDENTIFIED BY 'password';
mysql> GRANT ALL PRIVILEGES ON *.* TO 'finley'@'localhost'
    ->     WITH GRANT OPTION;
mysql> CREATE USER 'finley'@'%' IDENTIFIED BY 'password';
mysql> GRANT ALL PRIVILEGES ON *.* TO 'finley'@'%'
    ->     WITH GRANT OPTION;
mysql> CREATE USER 'admin'@'localhost' IDENTIFIED BY 'password';
mysql> GRANT RELOAD,PROCESS ON *.* TO 'admin'@'localhost';
mysql> CREATE USER 'dummy'@'localhost';

```

​      The accounts created by those statements have the following      properties:

- ​          Two accounts have a user name of `finley`.          Both are superuser accounts with full privileges to do          anything. The `'finley'@'localhost'` account          can be used only when connecting from the local host. The          `'finley'@'%'` account uses the          `'%'` wildcard for the host part, so it can          be used to connect from any host.        

  ​          The `'finley'@'localhost'` account is          necessary if there is an anonymous-user account for          `localhost`. Without the          `'finley'@'localhost'` account, that          anonymous-user account takes precedence when          `finley` connects from the local host and          `finley` is treated as an anonymous user. The          reason for this is that the anonymous-user account has a more          specific `Host` column value than the          `'finley'@'%'` account and thus comes earlier          in the `user` table sort order.          (`user` table sorting is discussed in          [Section 6.2.4, “Access Control, Stage 1: Connection Verification”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#connection-access).)        

- ​          The `'admin'@'localhost'` account can be used          only by `admin` to connect from the local          host. It is granted the [`RELOAD`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_reload)          and [`PROCESS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_process) administrative          privileges. These privileges enable the          `admin` user to execute the          [**mysqladmin reload**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin), [**mysqladmin          refresh**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin), and [**mysqladmin          flush-xxx**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin) commands, as          well as [**mysqladmin processlist**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin) . No          privileges are granted for accessing any databases. You could          add such privileges using [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant)          statements.        

- ​          The `'dummy'@'localhost'` account has no          password (which is insecure and not recommended). This account          can be used only to connect from the local host. No privileges          are granted. It is assumed that you will grant specific          privileges to the account using          [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statements.

​      To see the privileges for an account, use      [`SHOW GRANTS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#show-grants):    

```
mysql> SHOW GRANTS FOR 'admin'@'localhost';
+-----------------------------------------------------+
| Grants for admin@localhost                          |
+-----------------------------------------------------+
| GRANT RELOAD, PROCESS ON *.* TO 'admin'@'localhost' |
+-----------------------------------------------------+

```

​      The next examples create three accounts and grant them access to      specific databases. Each of them has a user name of      `custom` and password of      *password*:    

```
mysql> CREATE USER 'custom'@'localhost' IDENTIFIED BY 'password';
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON bankaccount.*
    ->     TO 'custom'@'localhost';
mysql> CREATE USER 'custom'@'host47.example.com' IDENTIFIED BY 'password';
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON expenses.*
    ->     TO 'custom'@'host47.example.com';
mysql> CREATE USER 'custom'@'%.example.com' IDENTIFIED BY 'password';
mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    ->     ON customer.*
    ->     TO 'custom'@'%.example.com';

```

​      The three accounts can be used as follows:

- ​          The first account can access the          `bankaccount` database, but only from the          local host.        
- ​          The second account can access the `expenses`          database, but only from the host          `host47.example.com`.        
- ​          The third account can access the `customer`          database, from any host in the `example.com`          domain. This account has access from all machines in the          domain due to use of the `%` wildcard          character in the host part of the account name.

### 6.3.3 Removing User Accounts

​      To remove an account, use the [`DROP      USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#drop-user) statement, which is described in      [Section 13.7.1.2, “DROP USER Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#drop-user). For example:    

```
mysql> DROP USER 'jeffrey'@'localhost';

```

### 6.3.4 Setting Account Resource Limits

​      One means of restricting client use of MySQL server resources is      to set the global      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) system      variable to a nonzero value. This limits the number of      simultaneous connections that can be made by any given account,      but places no limits on what a client can do once connected. In      addition, setting      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) does not      enable management of individual accounts. Both types of control      are of interest to MySQL administrators.    

​      To address such concerns, MySQL permits limits for individual      accounts on use of these server resources:

- ​          The number of queries an account can issue per hour        
- ​          The number of updates an account can issue per hour        
- ​          The number of times an account can connect to the server per          hour        
- ​          The number of simultaneous connections to the server by an          account

​      Any statement that a client can issue counts against the query      limit, unless its results are served from the query cache. Only      statements that modify databases or tables count against the      update limit.    

​      An “account” in this context corresponds to a row in      the `mysql.user` table. That is, a connection is      assessed against the `User` and      `Host` values in the `user`      table row that applies to the connection. For example, an account      `'usera'@'%.example.com'` corresponds to a row in      the `user` table that has `User`      and `Host` values of `usera` and      `%.example.com`, to permit      `usera` to connect from any host in the      `example.com` domain. In this case, the server      applies resource limits in this row collectively to all      connections by `usera` from any host in the      `example.com` domain because all such connections      use the same account.    

​      Before MySQL 5.0.3, an “account” was assessed against      the actual host from which a user connects. This older method of      accounting may be selected by starting the server with the      [`--old-style-user-limits`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#option_mysqld_old-style-user-limits) option. In      this case, if `usera` connects simultaneously      from `host1.example.com` and      `host2.example.com`, the server applies the      account resource limits separately to each connection. If      `usera` connects again from      `host1.example.com`, the server applies the      limits for that connection together with the existing connection      from that host.    

​      To establish resource limits for an account, use the      [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statement (see      [Section 13.7.1.3, “GRANT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant)). Provide a `WITH` clause      that names each resource to be limited. The default value for each      limit is zero (no limit). For example, to create a new account      that can access the `customer` database, but only      in a limited fashion, issue these statements:    

```
mysql> CREATE USER 'francis'@'localhost' IDENTIFIED BY 'frank';
mysql> GRANT ALL ON customer.* TO 'francis'@'localhost'
    ->     WITH MAX_QUERIES_PER_HOUR 20
    ->          MAX_UPDATES_PER_HOUR 10
    ->          MAX_CONNECTIONS_PER_HOUR 5
    ->          MAX_USER_CONNECTIONS 2;

```

​      The limit types need not all be named in the      `WITH` clause, but those named can be present in      any order. The value for each per-hour limit should be an integer      representing a count per hour. For      `MAX_USER_CONNECTIONS`, the limit is an integer      representing the maximum number of simultaneous connections by the      account. If this limit is set to zero, the global      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) system      variable value determines the number of simultaneous connections.      If [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) is also      zero, there is no limit for the account.    

​      To modify limits for an existing account, use a      [`GRANT USAGE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant)      statement at the global level (`ON *.*`). The      following statement changes the query limit for      `francis` to 100:    

```
mysql> GRANT USAGE ON *.* TO 'francis'@'localhost'
    ->     WITH MAX_QUERIES_PER_HOUR 100;

```

​      The statement modifies only the limit value specified and leaves      the account otherwise unchanged.    

​      To remove a limit, set its value to zero. For example, to remove      the limit on how many times per hour `francis`      can connect, use this statement:    

```
mysql> GRANT USAGE ON *.* TO 'francis'@'localhost'
    ->     WITH MAX_CONNECTIONS_PER_HOUR 0;

```

​      As mentioned previously, the simultaneous-connection limit for an      account is determined from the      `MAX_USER_CONNECTIONS` limit and the      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) system      variable. Suppose that the global      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) value is 10      and three accounts have individual resource limits specified as      follows:    

```
GRANT ... TO 'user1'@'localhost' WITH MAX_USER_CONNECTIONS 0;
GRANT ... TO 'user2'@'localhost' WITH MAX_USER_CONNECTIONS 5;
GRANT ... TO 'user3'@'localhost' WITH MAX_USER_CONNECTIONS 20;

```

​      `user1` has a connection limit of 10 (the global      [`max_user_connections`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_max_user_connections) value)      because it has a `MAX_USER_CONNECTIONS` limit of      zero. `user2` and `user3` have      connection limits of 5 and 20, respectively, because they have      nonzero `MAX_USER_CONNECTIONS` limits.    

​      The server stores resource limits for an account in the      `user` table row corresponding to the account.      The `max_questions`,      `max_updates`, and      `max_connections` columns store the per-hour      limits, and the `max_user_connections` column      stores the `MAX_USER_CONNECTIONS` limit. (See      [Section 6.2.2, “Grant Tables”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#grant-tables).)    

​      Resource-use counting takes place when any account has a nonzero      limit placed on its use of any of the resources.    

​      As the server runs, it counts the number of times each account      uses resources. If an account reaches its limit on number of      connections within the last hour, the server rejects further      connections for the account until that hour is up. Similarly, if      the account reaches its limit on the number of queries or updates,      the server rejects further queries or updates until the hour is      up. In all such cases, the server issues appropriate error      messages.    

​      Resource counting occurs per account, not per client. For example,      if your account has a query limit of 50, you cannot increase your      limit to 100 by making two simultaneous client connections to the      server. Queries issued on both connections are counted together.    

​      The current per-hour resource-use counts can be reset globally for      all accounts, or individually for a given account:

- ​          To reset the current counts to zero for all accounts, issue a          [`FLUSH USER_RESOURCES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-user-resources) statement.          The counts also can be reset by reloading the grant tables          (for example, with a [`FLUSH          PRIVILEGES`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#flush-privileges) statement or a [**mysqladmin          reload**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin) command).        
- ​          The counts for an individual account can be reset to zero by          setting any of its limits again. Specify a limit value equal          to the value currently assigned to the account.

​      Per-hour counter resets do not affect the      `MAX_USER_CONNECTIONS` limit.    

​      All counts begin at zero when the server starts. Counts do not      carry over through server restarts.    

​      For the `MAX_USER_CONNECTIONS` limit, an edge      case can occur if the account currently has open the maximum      number of connections permitted to it: A disconnect followed      quickly by a connect can result in an error      ([`ER_TOO_MANY_USER_CONNECTIONS`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/error-handling.html#error_er_too_many_user_connections) or      [`ER_USER_LIMIT_REACHED`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/error-handling.html#error_er_user_limit_reached)) if the      server has not fully processed the disconnect by the time the      connect occurs. When the server finishes disconnect processing,      another connection will once more be permitted.

### 6.3.5 Assigning Account Passwords

​      Required credentials for clients that connect to the MySQL server      can include a password. This section describes how to assign      passwords for MySQL accounts.    

​      MySQL stores credentials in the `user` table in      the `mysql` system database. Operations that      assign or modify passwords are permitted only to users with the      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_create-user) privilege, or,      alternatively, privileges for the `mysql`      database ([`INSERT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_insert) privilege to      create new accounts, [`UPDATE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_update)      privilege to modify existing accounts). If the      [`read_only`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_read_only) system variable is      enabled, use of account-modification statements such as      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) or      [`SET PASSWORD`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password) additionally requires      the [`SUPER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_super) privilege.    

​      The discussion here summarizes syntax only for the most common      password-assignment statements. For complete details on other      possibilities, see [Section 13.7.1.1, “CREATE USER Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user),      [Section 13.7.1.3, “GRANT Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant), and [Section 13.7.1.6, “SET PASSWORD Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password).    

​      MySQL uses plugins to perform client authentication; see      [Section 6.3.6, “Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#pluggable-authentication). In password-assigning      statements, the authentication plugin associated with an account      performs any hashing required of a cleartext password specified.      This enables MySQL to obfuscate passwords prior to storing them in      the `mysql.user` table. For most statements      described here, MySQL automatically hashes the password specified.      An exception is [`SET      PASSWORD ... =      PASSWORD('*auth_string*')`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password), for      which you use the [`PASSWORD()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_password)      function explicitly to hash the password. There are also syntaxes      for [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user),      [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant), and [`SET      PASSWORD`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password) that permit hashed values to be specified      literally. For details, see the descriptions of those statements.    

​      To assign a password when you create a new account, use      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) and include an      `IDENTIFIED BY` clause:    

```
CREATE USER 'jeffrey'@'localhost' IDENTIFIED BY 'password';

```

​      [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) also supports syntax      for specifying the account authentication plugin. See      [Section 13.7.1.1, “CREATE USER Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user).    

​      To assign or change a password for an existing account, use      [`SET PASSWORD`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password) with the      [`PASSWORD()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_password) function:    

```
SET PASSWORD FOR 'jeffrey'@'localhost' = PASSWORD('password');

```

​      If you are not connected as an anonymous user, you can change your      own password by omitting the `FOR` clause:    

```
SET PASSWORD = PASSWORD('password');

```

​      The [`PASSWORD()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_password) function hashes the      password using the hashing method determined by the value of the      [`old_passwords`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_old_passwords) system variable      value. If [`SET PASSWORD`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password) rejects the      hashed password value returned by      [`PASSWORD()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_password) as not being in the      correct format, it may be necessary to change      [`old_passwords`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_old_passwords) to change the      hashing method. See [Section 13.7.1.6, “SET PASSWORD Syntax”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#set-password).    

​      Use a [`GRANT USAGE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant)      statement at the global level (`ON *.*`) to      change an account password without affecting the account's current      privileges:    

```
GRANT USAGE ON *.* TO 'jeffrey'@'localhost' IDENTIFIED BY 'password';

```

​      To change an account password from the command line, use the      [**mysqladmin**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin) command:    

```
mysqladmin -u user_name -h host_name password "password"

```

​      The account for which this command sets the password is the one      with a `mysql.user` table row that matches      *user_name* in the      `User` column and the client host *from      which you connect* in the `Host`      column.

Warning

​        Setting a password using [**mysqladmin**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysqladmin) should be        considered *insecure*. On some systems, your        password becomes visible to system status programs such as        **ps** that may be invoked by other users to        display command lines. MySQL clients typically overwrite the        command-line password argument with zeros during their        initialization sequence. However, there is still a brief        interval during which the value is visible. Also, on some        systems this overwriting strategy is ineffective and the        password remains visible to **ps**. (SystemV Unix        systems and perhaps others are subject to this problem.)

​      If you are using MySQL Replication, be aware that, currently, a      password used by a replication slave as part of a      [`CHANGE MASTER TO`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#change-master-to) statement is      effectively limited to 32 characters in length; if the password is      longer, any excess characters are truncated. This is not due to      any limit imposed by the MySQL Server generally, but rather is an      issue specific to MySQL Replication. (For more information, see      Bug #43439.)

### 6.3.6 Pluggable Authentication

​      When a client connects to the MySQL server, the server uses the      user name provided by the client and the client host to select the      appropriate account row from the `mysql.user`      table. The server then consults this row to authenticate the      client.    

​      Before MySQL 5.5.7, the server authenticates the password provided      by the client against the `Password` column of      the account row.    

​      As of MySQL 5.5.7, the server authenticates clients using a      plugin. Selection of the proper account row from the      `mysql.user` table is based on the user name and      client host, as before, but the server authenticates the client by      determining from the account row which authentication plugin      applies to the client:

- ​          If the account row specifies a plugin, the server invokes it          to authenticate the user. If the server cannot find the          plugin, an error occurs and the connection attempt is          rejected.        
- ​          If the account row specifies no plugin name, the server          authenticates the account using either the          `mysql_native_password` or          `mysql_old_password` plugin, depending on          whether the password hash value in the          `Password` column used native hashing or the          older pre-4.1 hashing method. Clients must match the password          in the `Password` column of the account row.

​      The plugin returns a status to the server indicating whether the      user is permitted to connect.    

​      Pluggable authentication enables two important capabilities:

- ​          **External authentication:**          Pluggable authentication makes it possible for clients to          connect to the MySQL server with credentials that are          appropriate for authentication methods that store credentials          elsewhere than in the `mysql.user` table. For          example, plugins can be created to use external authentication          methods such as PAM, Windows login IDs, LDAP, or Kerberos.        
- ​          **Proxy users:** If a user is          permitted to connect, an authentication plugin can return to          the server a user name different from the name of the          connecting user, to indicate that the connecting user is a          proxy for another user (the proxied user). While the          connection lasts, the proxy user is treated, for purposes of          access control, as having the privileges of the proxied user.          In effect, one user impersonates another. For more          information, see [Section 6.3.7, “Proxy Users”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users).

​      Several authentication plugins are available in MySQL:

- ​          Plugins that perform native authentication; that is,          authentication based on the password hashing methods in use          from before the introduction of pluggable authentication in          MySQL. The `mysql_native_password` plugin          implements authentication based on the native password hashing          method. The `mysql_old_password` plugin          implements native authentication based on the older (pre-4.1)          password hashing method. See          [Section 6.5.1.1, “Native Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#native-pluggable-authentication), and          [Section 6.5.1.2, “Old Native Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#old-native-pluggable-authentication). Native          authentication using `mysql_native_password`          is the default for accounts that have no plugin named          explicitly in their account row.        
- ​          A client-side plugin that sends the password to the server          without hashing or encryption. This plugin is used in          conjunction with server-side plugins that require access to          the password exactly as provided by the client user. See          [Section 6.5.1.3, “Client-Side Cleartext Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#cleartext-pluggable-authentication).        
- ​          A plugin that performs external authentication using PAM          (Pluggable Authentication Modules), enabling MySQL Server to          use PAM to authenticate MySQL users. This plugin supports          proxy users as well. See          [Section 6.5.1.4, “PAM Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#pam-pluggable-authentication).        
- ​          A plugin that performs external authentication on Windows,          enabling MySQL Server to use native Windows services to          authenticate client connections. Users who have logged in to          Windows can connect from MySQL client programs to the server          based on the information in their environment without          specifying an additional password. This plugin supports proxy          users as well. See          [Section 6.5.1.5, “Windows Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#windows-pluggable-authentication).        
- ​          A plugin that authenticates clients that connect from the          local host through the Unix socket file. See          [Section 6.5.1.6, “Socket Peer-Credential Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#socket-pluggable-authentication).        
- ​          A test plugin that checks account credentials and logs success          or failure to the server error log. This plugin is intended          for testing and development purposes, and as an example of how          to write an authentication plugin. See          [Section 6.5.1.7, “Test Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#test-pluggable-authentication).

Note

​        For information about current restrictions on the use of        pluggable authentication, including which connectors support        which plugins, see        [Section C.9, “Restrictions on Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/restrictions.html#pluggable-authentication-restrictions).      

​        Third-party connector developers should read that section to        determine the extent to which a connector can take advantage of        pluggable authentication capabilities and what steps to take to        become more compliant.

​      If you are interested in writing your own authentication plugins,      see [Section 24.2.4.9, “Writing Authentication Plugins”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/extending-mysql.html#writing-authentication-plugins).

#### Authentication Plugin Usage Instructions

​      This section provides general instructions for installing and      using authentication plugins. For instructions specific to a given      plugin, see the section that describes that plugin.    

​      In general, pluggable authentication uses corresponding plugins on      the server and client sides, so you use a given authentication      method like this:

- ​          If necessary, install the plugin library or libraries          containing the appropriate plugins. On the server host,          install the library containing the server-side plugin, so that          the server can use it to authenticate client connections.          Similarly, on each client host, install the library containing          the client-side plugin for use by client programs.          Authentication plugins that are built in need not be          installed.        
- ​          For each MySQL account that you create, specify the          appropriate server-side plugin to use for authentication.        
- ​          When a client connects, the server-side plugin tells the          client program which client-side plugin to use for          authentication.

​      In the case that an account uses an authentication method that is      the default for both the server and the client program, the server      need not communicate to the client which client-side plugin to      use, and a round trip in client/server negotiation can be avoided.      This is true for accounts that use native MySQL authentication      (`mysql_native_password` or      `mysql_old_password`).    

​      The      [`--default-auth=*plugin_name*`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_default-auth)      option can be specified on the [**mysql**](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#mysql) command      line as a hint about which client-side plugin the program can      expect to use, although the server will override this if the      server-side plugin associated with the user account requires a      different client-side plugin.    

​      If the client program does not find the client-side plugin,      specify a      [`--plugin-dir=*dir_name*`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/programs.html#option_mysql_plugin-dir)      option to indicate where the plugin is located.

Note

​        If you start the server with the        [`--skip-grant-tables`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#option_mysqld_skip-grant-tables) option,        authentication plugins are not used even if loaded because the        server performs no client authentication and permits any client        to connect. Because this is insecure, you might want to use        [`--skip-grant-tables`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#option_mysqld_skip-grant-tables) in        conjunction with        [`--skip-networking`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#option_mysqld_skip-networking) to prevent        remote clients from connecting.

### 6.3.7 Proxy Users

​      The MySQL server authenticates client connections using      authentication plugins. The plugin that authenticates a given      connection may request that the connecting (external) user be      treated as a different user for privilege-checking purposes. This      enables the external user to be a proxy for the second user; that      is, to assume the privileges of the second user:

- ​          The external user is a “proxy user” (a user who          can impersonate or become known as another user).        
- ​          The second user is a “proxied user” (a user whose          identity and privileges can be assumed by a proxy user).

​      This section describes how the proxy user capability works. For      general information about authentication plugins, see      [Section 6.3.6, “Pluggable Authentication”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#pluggable-authentication). For information about      specific plugins, see [Section 6.5.1, “Authentication Plugins”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#authentication-plugins).      For information about writing authentication plugins that support      proxy users, see      [Section 24.2.4.9.4, “Implementing Proxy User Support in Authentication Plugins”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/extending-mysql.html#writing-authentication-plugins-proxy-users).

- [Requirements for Proxy User Support](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users-support-requirements)
- [Granting the Proxy Privilege](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users-granting-proxy-privilege)
- [Default Proxy Users](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#default-proxy-users)
- [Default Proxy User and Anonymous User Conflicts](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users-conflicts)
- [Proxy User System Variables](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#proxy-users-system-variables)

#### Requirements for Proxy User Support

​        For proxying to occur for a given authentication plugin, these        conditions must be satisfied:

- ​            The plugin must support proxying.          
- ​            The proxy user account must be set up to be authenticated by            the plugin. Use the [`CREATE            USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) or [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant)            statement to associate an account with an authentication            plugin.          
- ​            The proxied user account must be created and granted the            privileges to be assumed by the proxy user. Use the            [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) and            [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statements for this.          
- ​            The proxy user account must have the            [`PROXY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege for the            proxied account. Use the            [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statement for this.          
- ​            For a client connecting to the proxy account to be treated            as a proxy user, the authentication plugin must return a            user name different from the client user name, to indicate            the user name of the proxied account that defines the            privileges to be assumed by the proxy user.

​        The proxy mechanism permits mapping only the client user name to        the proxied user name. There is no provision for mapping host        names. When a connecting client matches a proxy account, the        server attempts to find a match for a proxied account using the        user name returned by the authentication plugin and the host        name of the proxy account.      

​        Consider the following account definitions:      

```
-- create proxy account
CREATE USER 'employee_ext'@'localhost'
  IDENTIFIED WITH my_auth_plugin AS 'my_auth_string';

-- create proxied account and grant its privileges
CREATE USER 'employee'@'localhost'
  IDENTIFIED BY 'employee_pass';
GRANT ALL ON employees.*
  TO 'employee'@'localhost';

-- grant PROXY privilege to proxy account for proxied account
GRANT PROXY
  ON 'employee'@'localhost'
  TO 'employee_ext'@'localhost';

```

​        When a client connects as `employee_ext` from        the local host, MySQL uses the plugin named        `my_auth_plugin` to perform authentication.        Suppose that `my_auth_plugin` returns a user        name of `employee` to the server, based on the        content of `'my_auth_string'` and perhaps by        consulting some external authentication system. The name        `employee` differs from        `employee_ext`, so returning        `employee` serves as a request to the server to        treat the `employee_ext` client, for purposes        of privilege checking, as the `employee` local        user.      

​        In this case, `employee_ext` is the proxy user        and `employee` is the proxied user.      

​        The server verifies that proxy authentication for        `employee` is possible for the        `employee_ext` user by checking whether        `employee_ext` (the proxy user) has the        [`PROXY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege for        `employee` (the proxied user). If this        privilege has not been granted, an error occurs. Otherwise,        `employee_ext` assumes the privileges of        `employee`. The server checks statements        executed during the client session by        `employee_ext` against the privileges granted        to `employee`. In this case,        `employee_ext` can access tables in the        `employees` database.      

​        When proxying occurs, the [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user)        and [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) functions can        be used to see the difference between the connecting user (the        proxy user) and the account whose privileges apply during the        current session (the proxied user). For the example just        described, those functions return these values:      

```
mysql> SELECT USER(), CURRENT_USER();
+------------------------+--------------------+
| USER()                 | CURRENT_USER()     |
+------------------------+--------------------+
| employee_ext@localhost | employee@localhost |
+------------------------+--------------------+

```

​        In the [`CREATE USER`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#create-user) statement that        creates the proxy user account, the `IDENTIFIED        WITH` clause that names the authentication plugin is        optionally followed by an `AS        '*auth_string*'` clause        specifying a string that the server passes to the plugin when        the user connects. If present, the string provides information        that helps the plugin determine how to map the external client        user name to a proxied user name. It is up to each plugin        whether it requires the `AS` clause. If so, the        format of the authentication string depends on how the plugin        intends to use it. Consult the documentation for a given plugin        for information about the authentication string values it        accepts.

#### Granting the Proxy Privilege

​        The [`PROXY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege is needed to        enable an external user to connect as and have the privileges of        another user. To grant this privilege, use the        [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) statement. For example:      

```
GRANT PROXY ON 'proxied_user' TO 'proxy_user';

```

​        The statement creates a row in the        `mysql.proxies_priv` grant table.      

​        At connection time, *proxy_user* must        represent a valid externally authenticated MySQL user, and        *proxied_user* must represent a valid        locally authenticated user. Otherwise, the connection attempt        fails.      

​        The corresponding [`REVOKE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#revoke) syntax        is:      

```
REVOKE PROXY ON 'proxied_user' FROM 'proxy_user';

```

​        MySQL [`GRANT`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#grant) and        [`REVOKE`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/sql-syntax.html#revoke) syntax extensions work as        usual. For example:      

```
GRANT PROXY ON 'a' TO 'b', 'c', 'd';
GRANT PROXY ON 'a' TO 'd' IDENTIFIED BY ...;
GRANT PROXY ON 'a' TO 'd' WITH GRANT OPTION;
GRANT PROXY ON 'a' TO ''@'';
REVOKE PROXY ON 'a' FROM 'b', 'c', 'd';

```

​        The [`PROXY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege can be        granted in these cases:

- ​            By a user that has `GRANT PROXY ... WITH GRANT            OPTION` for            *proxied_user*.          
- ​            By *proxied_user* for itself: The            value of [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) must exactly            match [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) and            *proxied_user*, for both the user            name and host name parts of the account name.

​        The initial `root` account created during MySQL        installation has the        [`PROXY ... WITH GRANT        OPTION`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege for `''@''`, that        is, for all users and all hosts. This enables        `root` to set up proxy users, as well as to        delegate to other accounts the authority to set up proxy users.        For example, `root` can do this:      

```
CREATE USER 'admin'@'localhost' IDENTIFIED BY 'test';
GRANT PROXY ON ''@'' TO 'admin'@'localhost' WITH GRANT OPTION;

```

​        Those statements create an `admin` user that        can manage all `GRANT PROXY` mappings. For        example, `admin` can do this:      

```
GRANT PROXY ON sally TO joe;

```

#### Default Proxy Users

​        To specify that some or all users should connect using a given        authentication plugin, create a “blank” MySQL        account (`''@''`), associate it with that        plugin, and let the plugin return the real authenticated user        name (if different from the blank user). For example, suppose        that there exists a plugin named `ldap_auth`        that implements LDAP authentication and maps connecting users        onto either a developer or manager account. To set up proxying        of users onto these accounts, use the following statements:      

```
-- create default proxy account
CREATE USER ''@'' IDENTIFIED WITH ldap_auth AS 'O=Oracle, OU=MySQL';

-- create proxied accounts
CREATE USER 'developer'@'localhost' IDENTIFIED BY 'developer_pass';
CREATE USER 'manager'@'localhost' IDENTIFIED BY 'manager_pass';

-- grant PROXY privilege to default proxy account for proxied accounts
GRANT PROXY ON 'manager'@'localhost' TO ''@'';
GRANT PROXY ON 'developer'@'localhost' TO ''@'';

```

​        Now assume that a client connects as follows:      

```
shell> mysql --user=myuser --password ...
Enter password: myuser_pass

```

​        The server will not find `myuser` defined as a        MySQL user. But because there is a blank user account        (`''@''`) that matches the client user name and        host name, the server authenticates the client against that        account: The server invokes the `ldap_auth`        authentication plugin and passes `myuser` and        `myuser_pass` to it as the user name and        password.      

​        If the `ldap_auth` plugin finds in the LDAP        directory that `myuser_pass` is not the correct        password for `myuser`, authentication fails and        the server rejects the connection.      

​        If the password is correct and `ldap_auth`        finds that `myuser` is a developer, it returns        the user name `developer` to the MySQL server,        rather than `myuser`. Returning a user name        different from the client user name of `myuser`        signals to the server that it should treat        `myuser` as a proxy. The server verifies that        `''@''` can authenticate as        `developer` (because that account has the        [`PROXY`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#priv_proxy) privilege to do so) and        accepts the connection. The session proceeds with        `myuser` having the privileges of        `developer`, the proxied user. (These        privileges should be set up by the DBA using        `GRANT` statements, not shown.) The        [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) and        [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) functions return        these values:      

```
mysql> SELECT USER(), CURRENT_USER();
+------------------+---------------------+
| USER()           | CURRENT_USER()      |
+------------------+---------------------+
| myuser@localhost | developer@localhost |
+------------------+---------------------+

```

​        If the plugin instead finds in the LDAP directory that        `myuser` is a manager, it returns        `manager` as the user name and the session        proceeds with `myuser` having the privileges of        `manager`.      

```
mysql> SELECT USER(), CURRENT_USER();
+------------------+-------------------+
| USER()           | CURRENT_USER()    |
+------------------+-------------------+
| myuser@localhost | manager@localhost |
+------------------+-------------------+

```

​        For simplicity, external authentication cannot be multilevel:        Neither the credentials for `developer` nor        those for `manager` are taken into account in        the preceding example. However, they are still used if a client        tries to connect and authenticate directly as the        `developer` or `manager`        account, which is why those accounts should be assigned        passwords.

#### Default Proxy User and Anonymous User Conflicts

​        If you intend to create a default proxy user, check for other        existing “match any user” accounts that take        precedence over the default proxy user because they can prevent        that user from working as intended.      

​        In the preceding discussion, the default proxy user account has        `''` in the host part, which matches any host.        If you set up a default proxy user, take care to also check        whether nonproxy accounts exist with the same user part and        `'%'` in the host part, because        `'%'` also matches any host, but has precedence        over `''` by the rules that the server uses to        sort account rows internally (see        [Section 6.2.4, “Access Control, Stage 1: Connection Verification”](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/security.html#connection-access)).      

​        Suppose that a MySQL installation includes these two accounts:      

```
-- create default proxy account
CREATE USER ''@''
  IDENTIFIED WITH some_plugin AS 'some_auth_string';
-- create anonymous account
CREATE USER ''@'%'
  IDENTIFIED BY 'some_password';

```

​        The first account (`''@''`) is intended as the        default proxy user, used to authenticate connections for users        who do not otherwise match a more-specific account. The second        account (`''@'%'`) is an anonymous-user        account, which might have been created, for example, to enable        users without their own account to connect anonymously.      

​        Both accounts have the same user part (`''`),        which matches any user. And each account has a host part that        matches any host. Nevertheless, there is a priority in account        matching for connection attempts because the matching rules sort        a host of `'%'` ahead of `''`.        For accounts that do not match any more-specific account, the        server attempts to authenticate them against        `''@'%'` (the anonymous user) rather than        `''@''` (the default proxy user). The result is        that the default proxy account is never used.      

​        To avoid this problem, use one of the following strategies:

- ​            Remove the anonymous account so that it does not conflict            with the default proxy user. This might be a good idea            anyway if you want to associate every connection with a            named user.          

- ​            Use a more-specific default proxy user that matches ahead of            the anonymous user. For example, to permit only            `localhost` proxy connections, use            `''@'localhost'`:          

  ```
  CREATE USER ''@'localhost'
    IDENTIFIED WITH some_plugin AS 'some_auth_string';

  ```

  ​            In addition, modify any `GRANT PROXY`            statements to name `''@'localhost'` rather            than `''@''` as the proxy user.          

  ​            Be aware that this strategy prevents anonymous-user            connections from `localhost`.          

- ​            Create multiple proxy users, one for local connections and            one for “everything else” (remote connections).            This can be useful particularly when local users should have            different privileges from remote users.          

  ​            Create the proxy users:          

  ```
  -- create proxy user for local connections
  CREATE USER ''@'localhost'
    IDENTIFIED WITH some_plugin AS 'some_auth_string';
  -- create proxy user for remote connections
  CREATE USER ''@'%'
    IDENTIFIED WITH some_plugin AS 'some_auth_string';

  ```

  ​            Create the proxied users:          

  ```
  -- create proxied user for local connections
  CREATE USER 'developer'@'localhost'
    IDENTIFIED BY 'some_password';
  -- create proxied user for remote connections
  CREATE USER 'developer'@'%'
    IDENTIFIED BY 'some_password';

  ```

  ​            Grant the proxy privilege to each proxy user for the            corresponding proxied user:          

  ```
  GRANT PROXY ON 'developer'@'localhost' TO ''@'localhost';
  GRANT PROXY ON 'developer'@'%' TO ''@'%';

  ```

  ​            Finally, grant appropriate privileges to the local and            remote proxied users (not shown).          

  ​            Assume that the            `some_plugin`/`'some_auth_string'`            combination causes `some_plugin` to map the            client user name to `developer`. Local            connections match the `''@'localhost'`            proxy user, which maps to the            `'developer'@'localhost'` proxied user.            Remote connections match the `''@'%'` proxy            user, which maps to the `'developer'@'%'`            proxied user.

#### Proxy User System Variables

​        Two system variables help trace the proxy login process:

- ​            [`proxy_user`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_proxy_user): This value is            `NULL` if proxying is not used. Otherwise,            it indicates the proxy user account. For example, if a            client authenticates through the `''@''`            proxy account, this variable is set as follows:          

  ```
  mysql> SELECT @@proxy_user;
  +--------------+
  | @@proxy_user |
  +--------------+
  | ''@''        |
  +--------------+

  ```

- ​            [`external_user`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/server-administration.html#sysvar_external_user): Sometimes            the authentication plugin may use an external user to            authenticate to the MySQL server. For example, when using            Windows native authentication, a plugin that authenticates            using the windows API does not need the login ID passed to            it. However, it still uses a Windows user ID to            authenticate. The plugin may return this external user ID            (or the first 512 UTF-8 bytes of it) to the server using the            `external_user` read-only session variable.            If the plugin does not set this variable, its value is            `NULL`.

### 6.3.8 SQL-Based MySQL Account Activity Auditing

​      Applications can use the following guidelines to perform SQL-based      auditing that ties database activity to MySQL accounts.    

​      MySQL accounts correspond to rows in the      `mysql.user` table. When a client connects      successfully, the server authenticates the client to a particular      row in this table. The `User` and      `Host` column values in this row uniquely      identify the account and correspond to the      `'*user_name*'@'*host_name*'`      format in which account names are written in SQL statements.    

​      The account used to authenticate a client determines which      privileges the client has. Normally, the      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) function can be      invoked to determine which account this is for the client user.      Its value is constructed from the `User` and      `Host` columns of the `user`      table row for the account.    

​      However, there are circumstances under which the      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) value corresponds      not to the client user but to a different account. This occurs in      contexts when privilege checking is not based the client's      account:

- ​          Stored routines (procedures and functions) defined with the          `SQL SECURITY DEFINER` characteristic        
- ​          Views defined with the `SQL SECURITY DEFINER`          characteristic        
- ​          Triggers and events

​      In those contexts, privilege checking is done against the      `DEFINER` account and      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) refers to that      account, not to the account for the client who invoked the stored      routine or view or who caused the trigger to activate. To      determine the invoking user, you can call the      [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) function, which returns a      value indicating the actual user name provided by the client and      the host from which the client connected. However, this value does      not necessarily correspond directly to an account in the      `user` table, because the      [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) value never contains      wildcards, whereas account values (as returned by      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user)) may contain user      name and host name wildcards.    

​      For example, a blank user name matches any user, so an account of      `''@'localhost'` enables clients to connect as an      anonymous user from the local host with any user name. In this      case, if a client connects as `user1` from the      local host, [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) and      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) return different      values:    

```
mysql> SELECT USER(), CURRENT_USER();
+-----------------+----------------+
| USER()          | CURRENT_USER() |
+-----------------+----------------+
| user1@localhost | @localhost     |
+-----------------+----------------+

```

​      The host name part of an account can contain wildcards, too. If      the host name contains a `'%'` or      `'_'` pattern character or uses netmask notation,      the account can be used for clients connecting from multiple hosts      and the [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) value will      not indicate which one. For example, the account      `'user2'@'%.example.com'` can be used by      `user2` to connect from any host in the      `example.com` domain. If `user2`      connects from `remote.example.com`,      [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) and      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) return different      values:    

```
mysql> SELECT USER(), CURRENT_USER();
+--------------------------+---------------------+
| USER()                   | CURRENT_USER()      |
+--------------------------+---------------------+
| user2@remote.example.com | user2@%.example.com |
+--------------------------+---------------------+

```

​      If an application must invoke      [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) for user auditing (for      example, if it does auditing from within triggers) but must also      be able to associate the [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user)      value with an account in the `user` table, it is      necessary to avoid accounts that contain wildcards in the      `User` or `Host` column.      Specifically, do not permit `User` to be empty      (which creates an anonymous-user account), and do not permit      pattern characters or netmask notation in `Host`      values. All accounts must have a nonempty `User`      value and literal `Host` value.    

​      With respect to the previous examples, the      `''@'localhost'` and      `'user2'@'%.example.com'` accounts should be      changed not to use wildcards:    

```
RENAME USER ''@'localhost' TO 'user1'@'localhost';
RENAME USER 'user2'@'%.example.com' TO 'user2'@'remote.example.com';

```

​      If `user2` must be able to connect from several      hosts in the `example.com` domain, there should      be a separate account for each host.    

​      To extract the user name or host name part from a      [`CURRENT_USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_current-user) or      [`USER()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_user) value, use the      [`SUBSTRING_INDEX()`](file:///F:/Tech_doc/Mysql/refman-5.5-en.html-chapter/functions.html#function_substring-index) function:    

```
mysql> SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',1);
+---------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',1) |
+---------------------------------------+
| user1                                 |
+---------------------------------------+

mysql> SELECT SUBSTRING_INDEX(CURRENT_USER(),'@',-1);
+----------------------------------------+
| SUBSTRING_INDEX(CURRENT_USER(),'@',-1) |
+----------------------------------------+
| localhost                              |
+----------------------------------------+

```